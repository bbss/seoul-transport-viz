{
"version":3,
"file":"module$node_modules$$deck_DOT_gl$mesh_layers$dist$es5$scenegraph_layer$scenegraph_layer.js",
"lineCount":16,
"mappings":"AAAAA,cAAA,wFAAA,CAA4G,QAAQ,CAACC,MAAD,CAAQC,OAAR,CAAgBC,MAAhB,CAAuBC,OAAvB,CAAgC,CAGhJC,MAAAA,CAAyBH,OAAA,CAAQ,kEAAR,CAE7BI,OAAAC,eAAA,CAAsBH,OAAtB,CAA+B,YAA/B,CAA6C,CAC3CI,MAAO,CAAA,CADoC,CAA7C,CAGAJ,QAAA,CAAQ,SAAR,CAAA,CAAqB,IAAK,EAE1B,KAAIK,iBAAmBJ,MAAA,CAAuBH,OAAA,CAAQ,2DAAR,CAAvB,CAAvB,CAEIQ,cAAgBL,MAAA,CAAuBH,OAAA,CAAQ,wDAAR,CAAvB,CAFpB,CAIIS;AAA8BN,MAAA,CAAuBH,OAAA,CAAQ,sEAAR,CAAvB,CAJlC,CAMIU,iBAAmBP,MAAA,CAAuBH,OAAA,CAAQ,2DAAR,CAAvB,CANvB,CAQIW,MAAQR,MAAA,CAAuBH,OAAA,CAAQ,gDAAR,CAAvB,CARZ,CAUIY,WAAaT,MAAA,CAAuBH,OAAA,CAAQ,qDAAR,CAAvB,CAVjB,CAYIa,SAAWV,MAAA,CAAuBH,OAAA,CAAQ,mDAAR,CAAvB,CAZf,CAcIc,MAAQd,OAAA,CAAQ,sDAAR,CAdZ,CAgBIe,OAASf,OAAA,CAAQ,sDAAR,CAhBb;AAkBIgB,aAAehB,OAAA,CAAQ,6DAAR,CAlBnB,CAoBIiB,cAAgBjB,OAAA,CAAQ,8DAAR,CApBpB,CAsBIkB,WAAalB,OAAA,CAAQ,mFAAR,CAtBjB,CAwBImB,QAAUnB,OAAA,CAAQ,oEAAR,CAxBd,CA0BIoB,uBAAyBjB,MAAA,CAAuBH,OAAA,CAAQ,qGAAR,CAAvB,CA1B7B;AA4BIqB,yBAA2BlB,MAAA,CAAuBH,OAAA,CAAQ,uGAAR,CAAvB,CA5B/B,CA8BIsB,cAAgB,CAAC,GAAD,CAAM,GAAN,CAAW,GAAX,CAAgB,GAAhB,CAChBC,QAAAA,CAAe,CACjBC,WAAY,CACVC,KAAM,QADI,CAEVnB,MAAO,IAFG,CAGVoB,MAAO,CAAA,CAHG,CADK,CAMjBC,SAAUA,QAAiB,CAACC,IAAD,CAAO,CAChC,MAAIA,KAAJ,EAAYA,IAAAC,OAAZ,CACkD,QAAzC,GAAA,CAAC,CAAA,CAAGhB,QAAA,CAAS,SAAT,CAAJ,EAAyBe,IAAAE,MAAzB,CAAA,CAAoDF,IAAAE,MAApD,CAAiEF,IAAAC,OAAA,CAAYD,IAAAE,MAAZ,EAA0B,CAA1B,CAD1E,CAIOF,IALyB,CANjB,CAajBG,YAAaA,QAAoB,CAACP,UAAD,CAAa,CAC5C,MAAOA,WAAP,EAAqBA,UAAAQ,SADuB,CAb7B,CAgBjBC,YAAa,IAhBI,CAiBjBC,UAAW,CACTT,KAAM,QADG,CAETnB,MAAO,CAFE,CAGT6B,IAAK,CAHI,CAjBM;AAsBjBC,cAAe,CACbX,KAAM,QADO,CAEbU,IAAK,CAFQ,CAGb7B,MAAO,CAHM,CAtBE,CA2BjB+B,cAAe,CACbZ,KAAM,QADO,CAEbU,IAAK,CAFQ,CAGb7B,MAAOgC,MAAAC,iBAHM,CA3BE,CAgCjBC,YAAa,CACXf,KAAM,UADK,CAEXnB,MAAOA,QAAc,CAACmC,CAAD,CAAI,CACvB,MAAOA,EAAAC,SADgB,CAFd,CAhCI,CAsCjBC,SAAU,CACRlB,KAAM,UADE,CAERnB,MAAOgB,aAFC,CAtCO,CA0CjBsB,UAAW,MA1CM,CA2CjBC,+BAAgC,IA3Cf,CA4CjBC,eAAgB,CACdrB,KAAM,UADQ,CAEdnB,MAAO,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAFO,CA5CC,CAgDjByC,SAAU,CACRtB,KAAM,UADE,CAERnB,MAAO,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAFC,CAhDO,CAoDjB0C,eAAgB,CACdvB,KAAM,UADQ,CAEdnB,MAAO,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAFO,CApDC,CAwDjB2C,mBAAoB,CAClBxB,KAAM,UADY,CAElBnB,MAAO,EAFW,CAxDH,CA8Df4C,OAAAA,CAAkB,QAAS,CAACC,MAAD,CAAS,CAGtCD,QAASA,gBAAe,EAAG,CACzB,CAAC,CAAA;AAAG3C,gBAAA,CAAiB,SAAjB,CAAJ,EAAiC,IAAjC,CAAuC2C,eAAvC,CACA,OAAO,CAAC,CAAA,CAAGzC,2BAAA,CAA4B,SAA5B,CAAJ,EAA4C,IAA5C,CAAkD,CAAC,CAAA,CAAGC,gBAAA,CAAiB,SAAjB,CAAJ,EAAiCwC,eAAjC,CAAAE,MAAA,CAAwD,IAAxD,CAA8DC,SAA9D,CAAlD,CAFkB,CAF3B,CAAC,CAAA,CAAGzC,UAAA,CAAW,SAAX,CAAJ,EAA2BsC,eAA3B,CAA4CC,MAA5C,CAOA,EAAC,CAAA,CAAG3C,aAAA,CAAc,SAAd,CAAJ,EAA8B0C,eAA9B,CAA+C,CAAC,CAC9CI,IAAK,iBADyC,CAE9ChD,MAAOiD,QAAwB,EAAG,CACT,IAAAC,oBAAAC,EACvBC,aAAA,CAA8B,CAC5BC,kBAAmB,CACjBC,KAAM,CADW,CAEjBnC,KAAM,IAFW,CAGjBoC,KAAM,IAAAC,kBAAA,EAHW,CAIjBC,SAAU,aAJO,CAKjBC,WAAY,CAAA,CALK,CADS,CAQ5BC,eAAgB,CACdxC,KAAM,IADQ,CAEdmC,KAAM,IAAAM,MAAAC,YAAAC,OAFQ;AAGdL,SAAU,UAHI,CAIdM,WAAY,CAAA,CAJE,CAKdC,aAAchD,aALA,CAMd0C,WAAY,CAAA,CANE,CARY,CAgB5BO,oBAAqBpD,OAAAqD,kBAhBO,CAA9B,CAFgC,CAFY,CAAD,CAuB5C,CACDlB,IAAK,aADJ,CAEDhD,MAAOmE,QAAoB,CAACC,MAAD,CAAS,CAClC,CAAC,CAAA,CAAG/D,KAAA,CAAM,SAAN,CAAJ,EAAsB,CAAC,CAAA,CAAGD,gBAAA,CAAiB,SAAjB,CAAJ,EAAiCwC,eAAAyB,UAAjC,CAAtB,CAAmF,aAAnF,CAAkG,IAAlG,CAAAC,KAAA,CAA6G,IAA7G,CAAmHF,MAAnH,CADkC,KAE9BR,MAAQQ,MAAAR,MACRW,OAAAA,CAAWH,MAAAG,SAEXX,MAAA1C,WAAJ,GAAyBqD,MAAArD,WAAzB,CACE,IAAAsD,kBAAA,CAAuBZ,KAAvB,CADF,CAEWA,KAAAjC,YAFX,GAEiC4C,MAAA5C,YAFjC,EAGE,IAAA8C,qBAAA,CAA0B,IAAAC,MAAAxD,WAA1B,CAAiD,IAAAwD,MAAAhD,SAAjD;AAAsEkC,KAAAjC,YAAtE,CARgC,CAFnC,CAvB4C,CAoC5C,CACDqB,IAAK,eADJ,CAEDhD,MAAO2E,QAAsB,EAAG,CAC9B,CAAC,CAAA,CAAGtE,KAAA,CAAM,SAAN,CAAJ,EAAsB,CAAC,CAAA,CAAGD,gBAAA,CAAiB,SAAjB,CAAJ,EAAiCwC,eAAAyB,UAAjC,CAAtB,CAAmF,eAAnF,CAAoG,IAApG,CAAAC,KAAA,CAA+G,IAA/G,CAEA,KAAAM,kBAAA,EAH8B,CAF/B,CApC4C,CA2C5C,CACD5B,IAAK,mBADJ,CAEDhD,MAAOwE,QAA0B,CAACZ,KAAD,CAAQ,CACvC,IAAIiB,MAAQ,IAAZ,CAEIC,GAAK,IAAAC,QAAAD,GAGT,IAAIlB,KAAA1C,WAAJ,WAAgCP,cAAAqE,eAAhC,CACE,IAAAC,eAAiB,CACf1D,OAAQ,CAACqC,KAAA1C,WAAD,CADO,CADnB,KAIO,IAAI0C,KAAA1C,WAAJ,EAAwB,CAAC0C,KAAA1C,WAAAI,KAAzB,CAAgD,CACjDA,cAAAA,CAAOsC,KAAA1C,WACX,KAAIgE,YAAc,CAAC,CAAA,CAAGvE,aAAAwE,kBAAJ,EAAqCL,EAArC;AAAyCxD,cAAzC,CAA+C,IAAA8D,eAAA,EAA/C,CAClBH,eAAA,CAAiBnF,MAAAuF,OAAA,CAAc,CAC7B/D,KAAMA,cADuB,CAAd,CAEd4D,WAFc,CAGjB,EAAC,CAAA,CAAGtE,UAAA0E,kBAAJ,EAAkCJ,WAAlC,CAAAK,KAAA,CAAoD,QAAS,EAAG,CAC9D,MAAOV,MAAAW,eAAA,EADuD,CAAhE,CANqD,CAAhD,IAULhF,MAAAiF,IAAAC,WAAA,CAAqB,kCAArB,CAAyD,gDAAzD,CAAA,EAEA,CAAAT,cAAA,CAAiBrB,KAAA1C,WAGfyE,YAAAA,CAAU,CACZC,MAAO,IADK,CAEZd,GAAIA,EAFQ,CAIV5D,GAAAA,CAAa0C,KAAAvC,SAAA,CAAe4D,cAAf,CAA+BU,WAA/B,CACbjE,eAAAA,CAAWkC,KAAAnC,YAAA,CAAkBwD,cAAlB,CAAkCU,WAAlC,CAEXzE,GAAJ,WAA0BP,cAAAqE,eAA1B;CACE,IAAAJ,kBAAA,EAMA,CAJA,IAAAiB,oBAAA,CAAyB3E,EAAzB,CAIA,CAFA,IAAAuD,qBAAA,CAA0BvD,EAA1B,CAAsCQ,cAAtC,CAAgDkC,KAAAjC,YAAhD,CAEA,CAAA,IAAAmE,SAAA,CAAc,CACZ5E,WAAYA,EADA,CAEZQ,SAAUA,cAFE,CAAd,CAPF,EAW0B,IAX1B,GAWWR,EAXX,EAYEV,KAAAiF,IAAAM,KAAA,CAAe,qBAAf,CAAsC7E,EAAtC,CAAA,EA5CqC,CAFxC,CA3C4C,CA4F5C,CACD8B,IAAK,qBADJ,CAEDhD,MAAO6F,QAA4B,CAAC3E,UAAD,CAAa,CAC9C,IAAI8E,OAAS,IAEb,IAAI,IAAAtB,MAAAuB,oBAAJ,CAAoC,CAClC,IAAIC,cAAgB,IAAAhD,oBAAA,EAAAiD,cAAA,EACpBjF,WAAAkF,SAAA,CAAoB,QAAS,CAACC,KAAD,CAAQ,CACnCL,MAAAM,oBAAA,CAA2BD,KAAAA,MAA3B,CAAwCH,aAAxC,CADmC,CAArC,CAFkC,CAHU,CAF/C,CA5F4C,CAwG5C,CACDlD,IAAK,sBADJ;AAEDhD,MAAOyE,QAA6B,CAACvD,UAAD,CAAaQ,QAAb,CAAuB6E,cAAvB,CAAuC,CACzE,GAAKrF,UAAL,EAAoBQ,QAApB,EAAiC6E,cAAjC,CAAA,CAIA,IAAIC,WAAa9E,QAAA+E,cAAA,EACjB3G,OAAA4G,KAAA,CAAYH,cAAZ,CAAAI,KAAA,EAAAC,QAAA,CAA2C,QAAS,CAAC5D,GAAD,CAAM,CACxD,IAAIhD,MAAQuG,cAAA,CAAevD,GAAf,CAEZ,IAAY,GAAZ,GAAIA,GAAJ,CACEwD,UAAAI,QAAA,CAAmB,QAAS,CAACC,SAAD,CAAY,CACtC/G,MAAAuF,OAAA,CAAcwB,SAAd,CAAyB7G,KAAzB,CADsC,CAAxC,CADF,KAIO,IAAIgC,MAAA8E,SAAA,CAAgB9E,MAAA,CAAOgB,GAAP,CAAhB,CAAJ,CAAkC,CACvC,IAAI+D,OAAS/E,MAAA,CAAOgB,GAAP,CAEC,EAAd,EAAI+D,MAAJ,EAAmBA,MAAnB,CAA4BP,UAAA1C,OAA5B,CACEhE,MAAAuF,OAAA,CAAcmB,UAAA,CAAWO,MAAX,CAAd,CAAkC/G,KAAlC,CADF,CAGEQ,KAAAiF,IAAAM,KAAA,CAAe,YAAAiB,OAAA,CAAoBhE,GAApB,CAAyB,YAAzB,CAAf,CAAA,EANqC,CAAlC,IAcL,CALIiE,MAKJ;AALiBT,UAAAU,KAAA,CAAgB,QAAS,CAACC,IAAD,CAAO,CAE/C,MADWA,KAAAC,KACX,GAAgBpE,GAF+B,CAAhC,CAKjB,EACElD,MAAAuF,OAAA,CAAc4B,MAAd,CAA0BjH,KAA1B,CADF,CAGEQ,KAAAiF,IAAAM,KAAA,CAAe,YAAAiB,OAAA,CAAoBhE,GAApB,CAAyB,YAAzB,CAAf,CAAA,EAxBoD,CAA1D,CALA,CADyE,CAF1E,CAxG4C,CA6I5C,CACDA,IAAK,mBADJ,CAEDhD,MAAO4E,QAA0B,EAAG,CAClC,IAAI1D,WAAa,IAAAwD,MAAAxD,WAEjB,IAAIA,UAAJ,WAA0BP,cAAAqE,eAA1B,CACE9D,UAAA,CAAW,QAAX,CAAA,EAJgC,CAFnC,CA7I4C,CAsJ5C,CACD8B,IAAK,gBADJ,CAEDhD,MAAOoF,QAAuB,EAAG,CAC/B,IAAIiC,QAAU,CAAC7G,KAAA8G,UAAD,CAAkB9G,KAAA+G,QAAlB,CAAd,CACIC,YAAc,IAAA5D,MADlB,CAGIrB,+BAAiCiF,WAAAjF,+BAEnB,MAAlB,GAHgBiF,WAAAlF,UAGhB;AACE+E,OAAAI,KAAA,CAAa/G,YAAAgH,IAAb,CAGEC,YAAAA,CAAM,IAENpF,+BAAJ,GAEIoF,WAFJ,CACgD,UAA9C,GAAI,MAAOpF,+BAAX,CACQA,8BAAA,CAA+B,CACnCuC,GAAI,IAAAC,QAAAD,GAD+B,CAEnCc,MAAO,IAF4B,CAA/B,CADR,CAMQrD,8BAPV,CAWA,OAAO,CACLuC,GAAI,IAAAC,QAAAD,GADC,CAEL8C,gBAAiB,CAAA,CAFZ,CAGLC,8BAA+BF,WAH1B,CAILG,aAAc,CACZC,GAAIjH,sBAAA,CAAuB,SAAvB,CADQ,CAEZkH,GAAIjH,wBAAA,CAAyB,SAAzB,CAFQ,CAGZsG,QAASA,OAHG,CAIZY,YAAa,CAAA,CAJD,CAKZC,mBAAoB,CAAC,CAAC,CAAA,CAAGzH,MAAA0H,SAAJ,EAAqB,IAAApD,QAAAD,GAArB,CALT,CAJT;AAWLsD,YAAa,CAAA,CAXR,CAvBwB,CAFhC,CAtJ4C,CA6L5C,CACDpF,IAAK,kBADJ,CAEDhD,MAAOqI,QAAyB,CAACC,iBAAD,CAAoB,CAClD,IAAIC,OAAS,IAEb,KAAAzC,SAAA,CAAc,CACZG,oBAAqB,CAAA,CADT,CAAd,CAGK,KAAAvB,MAAAxD,WAAL,EACA,IAAAwD,MAAAxD,WAAAkF,SAAA,CAA+B,QAAS,CAACC,KAAD,CAAQ,CAC9CkC,MAAAjC,oBAAA,CAA2BD,KAAAA,MAA3B,CAAwCiC,iBAAxC,CAD8C,CAAhD,CAPkD,CAFnD,CA7L4C,CA0M5C,CACDtF,IAAK,MADJ,CAEDhD,MAAOwI,QAAa,CAACC,KAAD,CAAQ,CAAA,IACtBC,sBAAwBD,KAAAE,iBADF,CAEtBA,iBAA6C,IAAK,EAA/B,GAAAD,qBAAA,CAAmC,IAAnC,CAA0CA,qBAC7DE,sBAAAA,CAAmBH,KAAAI,WAHG,KAItBA,WAAkC,IAAK,EAA1B,GAAAD,qBAAA;AAA8B,EAA9B,CAAmCA,qBAChD7D,MAAAA,CAAU0D,KAAA1D,QACd,IAAK,IAAAL,MAAAxD,WAAL,CAAA,CAEI,IAAA0C,MAAAjC,YAAJ,EAA8B,IAAA+C,MAAAhD,SAA9B,EACE,IAAAgD,MAAAhD,SAAAoH,QAAA,CAA4B/D,KAAAgE,eAAAC,KAA5B,CAGF,KAAIC,SAAW,IAAAlE,QAAAkE,SACXC,MAAAA,CAAe,IAAAtF,MAbO,KActBhC,UAAYsH,KAAAtH,UAdU,CAetBE,cAAgBoH,KAAApH,cAfM,CAgBtBC,cAAgBmH,KAAAnH,cAhBM,CAiBtBoH,QAAUD,KAAAC,QAjBY,CAkBtBC,iBAAmBF,KAAAE,iBAlBG,CAmBtBC,aAAe,IAAAC,gBAAA,EACnB,KAAA5E,MAAAxD,WAAAkF,SAAA,CAA+B,QAAS,CAACC,KAAD,CAAQkD,KAAR,CAAe,CACjDC,KAAAA,CAAcD,KAAAC,YAClBnD,MAAAA,MAAAoD,iBAAA,CAA6BJ,YAA7B,CACAhD;KAAAqD,qBAAA,CAA2Bf,gBAA3B,CACAtC,MAAAmC,KAAA,CAAW,CACTK,WAAYA,UADH,CAETc,SAAU,CACR/H,UAAWA,SADH,CAERuH,QAASA,OAFD,CAGRrH,cAAeA,aAHP,CAIRC,cAAeA,aAJP,CAKR6H,mBAAoB,CAAC,CAAA,CAAG/I,OAAAgJ,yBAAJ,EAAsCZ,QAAtC,CAAgDG,gBAAhD,CALZ,CAMRU,iBAAkBN,KANV,CAORO,SAAU1D,KAAAA,MAAA2D,YAAA,EAAAC,wBAPF,CAFD,CAAX,CAJqD,CAAvD,CAdA,CAN0B,CAF3B,CA1M4C,CAA/C,CAmPA,OAAOrH,gBA3P+B,CAAlB,CA4PpBpC,KAAA0J,MA5PoB,CA8PtBtK,QAAA,CAAQ,SAAR,CAAA,CAAqBgD,MACrBA,OAAAuH,UAAA,CAA4B,iBAC5BvH,OAAA3B,aAAA,CAA+BA,OAvWqH;",
"sources":["node_modules/@deck_DOT_gl/mesh-layers/dist/es5/scenegraph-layer/scenegraph-layer.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$deck_DOT_gl$mesh_layers$dist$es5$scenegraph_layer$scenegraph_layer\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _get2 = _interopRequireDefault(require(\"@babel/runtime/helpers/get\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _core = require(\"@deck.gl/core\");\n\nvar _core2 = require(\"@luma.gl/core\");\n\nvar _shadertools = require(\"@luma.gl/shadertools\");\n\nvar _experimental = require(\"@luma.gl/experimental\");\n\nvar _gltfUtils = require(\"./gltf-utils\");\n\nvar _matrix = require(\"../utils/matrix\");\n\nvar _scenegraphLayerVertex = _interopRequireDefault(require(\"./scenegraph-layer-vertex.glsl\"));\n\nvar _scenegraphLayerFragment = _interopRequireDefault(require(\"./scenegraph-layer-fragment.glsl\"));\n\nvar DEFAULT_COLOR = [255, 255, 255, 255];\nvar defaultProps = {\n  scenegraph: {\n    type: 'object',\n    value: null,\n    async: true\n  },\n  getScene: function getScene(gltf) {\n    if (gltf && gltf.scenes) {\n      return (0, _typeof2[\"default\"])(gltf.scene) === 'object' ? gltf.scene : gltf.scenes[gltf.scene || 0];\n    }\n\n    return gltf;\n  },\n  getAnimator: function getAnimator(scenegraph) {\n    return scenegraph && scenegraph.animator;\n  },\n  _animations: null,\n  sizeScale: {\n    type: 'number',\n    value: 1,\n    min: 0\n  },\n  sizeMinPixels: {\n    type: 'number',\n    min: 0,\n    value: 0\n  },\n  sizeMaxPixels: {\n    type: 'number',\n    min: 0,\n    value: Number.MAX_SAFE_INTEGER\n  },\n  getPosition: {\n    type: 'accessor',\n    value: function value(x) {\n      return x.position;\n    }\n  },\n  getColor: {\n    type: 'accessor',\n    value: DEFAULT_COLOR\n  },\n  _lighting: 'flat',\n  _imageBasedLightingEnvironment: null,\n  getOrientation: {\n    type: 'accessor',\n    value: [0, 0, 0]\n  },\n  getScale: {\n    type: 'accessor',\n    value: [1, 1, 1]\n  },\n  getTranslation: {\n    type: 'accessor',\n    value: [0, 0, 0]\n  },\n  getTransformMatrix: {\n    type: 'accessor',\n    value: []\n  }\n};\n\nvar ScenegraphLayer = function (_Layer) {\n  (0, _inherits2[\"default\"])(ScenegraphLayer, _Layer);\n\n  function ScenegraphLayer() {\n    (0, _classCallCheck2[\"default\"])(this, ScenegraphLayer);\n    return (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(ScenegraphLayer).apply(this, arguments));\n  }\n\n  (0, _createClass2[\"default\"])(ScenegraphLayer, [{\n    key: \"initializeState\",\n    value: function initializeState() {\n      var attributeManager = this.getAttributeManager();\n      attributeManager.addInstanced({\n        instancePositions: {\n          size: 3,\n          type: 5130,\n          fp64: this.use64bitPositions(),\n          accessor: 'getPosition',\n          transition: true\n        },\n        instanceColors: {\n          type: 5121,\n          size: this.props.colorFormat.length,\n          accessor: 'getColor',\n          normalized: true,\n          defaultValue: DEFAULT_COLOR,\n          transition: true\n        },\n        instanceModelMatrix: _matrix.MATRIX_ATTRIBUTES\n      });\n    }\n  }, {\n    key: \"updateState\",\n    value: function updateState(params) {\n      (0, _get2[\"default\"])((0, _getPrototypeOf2[\"default\"])(ScenegraphLayer.prototype), \"updateState\", this).call(this, params);\n      var props = params.props,\n          oldProps = params.oldProps;\n\n      if (props.scenegraph !== oldProps.scenegraph) {\n        this._updateScenegraph(props);\n      } else if (props._animations !== oldProps._animations) {\n        this._applyAnimationsProp(this.state.scenegraph, this.state.animator, props._animations);\n      }\n    }\n  }, {\n    key: \"finalizeState\",\n    value: function finalizeState() {\n      (0, _get2[\"default\"])((0, _getPrototypeOf2[\"default\"])(ScenegraphLayer.prototype), \"finalizeState\", this).call(this);\n\n      this._deleteScenegraph();\n    }\n  }, {\n    key: \"_updateScenegraph\",\n    value: function _updateScenegraph(props) {\n      var _this = this;\n\n      var gl = this.context.gl;\n      var scenegraphData;\n\n      if (props.scenegraph instanceof _experimental.ScenegraphNode) {\n        scenegraphData = {\n          scenes: [props.scenegraph]\n        };\n      } else if (props.scenegraph && !props.scenegraph.gltf) {\n        var gltf = props.scenegraph;\n        var gltfObjects = (0, _experimental.createGLTFObjects)(gl, gltf, this.getLoadOptions());\n        scenegraphData = Object.assign({\n          gltf: gltf\n        }, gltfObjects);\n        (0, _gltfUtils.waitForGLTFAssets)(gltfObjects).then(function () {\n          return _this.setNeedsRedraw();\n        });\n      } else {\n        _core.log.deprecated('ScenegraphLayer.props.scenegraph', 'Use GLTFLoader instead of GLTFScenegraphLoader')();\n\n        scenegraphData = props.scenegraph;\n      }\n\n      var options = {\n        layer: this,\n        gl: gl\n      };\n      var scenegraph = props.getScene(scenegraphData, options);\n      var animator = props.getAnimator(scenegraphData, options);\n\n      if (scenegraph instanceof _experimental.ScenegraphNode) {\n        this._deleteScenegraph();\n\n        this._applyAllAttributes(scenegraph);\n\n        this._applyAnimationsProp(scenegraph, animator, props._animations);\n\n        this.setState({\n          scenegraph: scenegraph,\n          animator: animator\n        });\n      } else if (scenegraph !== null) {\n        _core.log.warn('invalid scenegraph:', scenegraph)();\n      }\n    }\n  }, {\n    key: \"_applyAllAttributes\",\n    value: function _applyAllAttributes(scenegraph) {\n      var _this2 = this;\n\n      if (this.state.attributesAvailable) {\n        var allAttributes = this.getAttributeManager().getAttributes();\n        scenegraph.traverse(function (model) {\n          _this2._setModelAttributes(model.model, allAttributes);\n        });\n      }\n    }\n  }, {\n    key: \"_applyAnimationsProp\",\n    value: function _applyAnimationsProp(scenegraph, animator, animationsProp) {\n      if (!scenegraph || !animator || !animationsProp) {\n        return;\n      }\n\n      var animations = animator.getAnimations();\n      Object.keys(animationsProp).sort().forEach(function (key) {\n        var value = animationsProp[key];\n\n        if (key === '*') {\n          animations.forEach(function (animation) {\n            Object.assign(animation, value);\n          });\n        } else if (Number.isFinite(Number(key))) {\n          var number = Number(key);\n\n          if (number >= 0 && number < animations.length) {\n            Object.assign(animations[number], value);\n          } else {\n            _core.log.warn(\"animation \".concat(key, \" not found\"))();\n          }\n        } else {\n          var findResult = animations.find(function (_ref) {\n            var name = _ref.name;\n            return name === key;\n          });\n\n          if (findResult) {\n            Object.assign(findResult, value);\n          } else {\n            _core.log.warn(\"animation \".concat(key, \" not found\"))();\n          }\n        }\n      });\n    }\n  }, {\n    key: \"_deleteScenegraph\",\n    value: function _deleteScenegraph() {\n      var scenegraph = this.state.scenegraph;\n\n      if (scenegraph instanceof _experimental.ScenegraphNode) {\n        scenegraph[\"delete\"]();\n      }\n    }\n  }, {\n    key: \"getLoadOptions\",\n    value: function getLoadOptions() {\n      var modules = [_core.project32, _core.picking];\n      var _this$props = this.props,\n          _lighting = _this$props._lighting,\n          _imageBasedLightingEnvironment = _this$props._imageBasedLightingEnvironment;\n\n      if (_lighting === 'pbr') {\n        modules.push(_shadertools.pbr);\n      }\n\n      var env = null;\n\n      if (_imageBasedLightingEnvironment) {\n        if (typeof _imageBasedLightingEnvironment === 'function') {\n          env = _imageBasedLightingEnvironment({\n            gl: this.context.gl,\n            layer: this\n          });\n        } else {\n          env = _imageBasedLightingEnvironment;\n        }\n      }\n\n      return {\n        gl: this.context.gl,\n        waitForFullLoad: true,\n        imageBasedLightingEnvironment: env,\n        modelOptions: {\n          vs: _scenegraphLayerVertex[\"default\"],\n          fs: _scenegraphLayerFragment[\"default\"],\n          modules: modules,\n          isInstanced: true,\n          transpileToGLSL100: !(0, _core2.isWebGL2)(this.context.gl)\n        },\n        useTangents: false\n      };\n    }\n  }, {\n    key: \"updateAttributes\",\n    value: function updateAttributes(changedAttributes) {\n      var _this3 = this;\n\n      this.setState({\n        attributesAvailable: true\n      });\n      if (!this.state.scenegraph) return;\n      this.state.scenegraph.traverse(function (model) {\n        _this3._setModelAttributes(model.model, changedAttributes);\n      });\n    }\n  }, {\n    key: \"draw\",\n    value: function draw(_ref2) {\n      var _ref2$moduleParameter = _ref2.moduleParameters,\n          moduleParameters = _ref2$moduleParameter === void 0 ? null : _ref2$moduleParameter,\n          _ref2$parameters = _ref2.parameters,\n          parameters = _ref2$parameters === void 0 ? {} : _ref2$parameters,\n          context = _ref2.context;\n      if (!this.state.scenegraph) return;\n\n      if (this.props._animations && this.state.animator) {\n        this.state.animator.animate(context.animationProps.time);\n      }\n\n      var viewport = this.context.viewport;\n      var _this$props2 = this.props,\n          sizeScale = _this$props2.sizeScale,\n          sizeMinPixels = _this$props2.sizeMinPixels,\n          sizeMaxPixels = _this$props2.sizeMaxPixels,\n          opacity = _this$props2.opacity,\n          coordinateSystem = _this$props2.coordinateSystem;\n      var numInstances = this.getNumInstances();\n      this.state.scenegraph.traverse(function (model, _ref3) {\n        var worldMatrix = _ref3.worldMatrix;\n        model.model.setInstanceCount(numInstances);\n        model.updateModuleSettings(moduleParameters);\n        model.draw({\n          parameters: parameters,\n          uniforms: {\n            sizeScale: sizeScale,\n            opacity: opacity,\n            sizeMinPixels: sizeMinPixels,\n            sizeMaxPixels: sizeMaxPixels,\n            composeModelMatrix: (0, _matrix.shouldComposeModelMatrix)(viewport, coordinateSystem),\n            sceneModelMatrix: worldMatrix,\n            u_Camera: model.model.getUniforms().project_uCameraPosition\n          }\n        });\n      });\n    }\n  }]);\n  return ScenegraphLayer;\n}(_core.Layer);\n\nexports[\"default\"] = ScenegraphLayer;\nScenegraphLayer.layerName = 'ScenegraphLayer';\nScenegraphLayer.defaultProps = defaultProps;\n//# sourceMappingURL=scenegraph-layer.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","_interopRequireDefault","Object","defineProperty","value","_classCallCheck2","_createClass2","_possibleConstructorReturn2","_getPrototypeOf2","_get2","_inherits2","_typeof2","_core","_core2","_shadertools","_experimental","_gltfUtils","_matrix","_scenegraphLayerVertex","_scenegraphLayerFragment","DEFAULT_COLOR","defaultProps","scenegraph","type","async","getScene","gltf","scenes","scene","getAnimator","animator","_animations","sizeScale","min","sizeMinPixels","sizeMaxPixels","Number","MAX_SAFE_INTEGER","getPosition","x","position","getColor","_lighting","_imageBasedLightingEnvironment","getOrientation","getScale","getTranslation","getTransformMatrix","ScenegraphLayer","_Layer","apply","arguments","key","initializeState","getAttributeManager","attributeManager","addInstanced","instancePositions","size","fp64","use64bitPositions","accessor","transition","instanceColors","props","colorFormat","length","normalized","defaultValue","instanceModelMatrix","MATRIX_ATTRIBUTES","updateState","params","prototype","call","oldProps","_updateScenegraph","_applyAnimationsProp","state","finalizeState","_deleteScenegraph","_this","gl","context","ScenegraphNode","scenegraphData","gltfObjects","createGLTFObjects","getLoadOptions","assign","waitForGLTFAssets","then","setNeedsRedraw","log","deprecated","options","layer","_applyAllAttributes","setState","warn","_this2","attributesAvailable","allAttributes","getAttributes","traverse","model","_setModelAttributes","animationsProp","animations","getAnimations","keys","sort","forEach","animation","isFinite","number","concat","findResult","find","_ref","name","modules","project32","picking","_this$props","push","pbr","env","waitForFullLoad","imageBasedLightingEnvironment","modelOptions","vs","fs","isInstanced","transpileToGLSL100","isWebGL2","useTangents","updateAttributes","changedAttributes","_this3","draw","_ref2","_ref2$moduleParameter","moduleParameters","_ref2$parameters","parameters","animate","animationProps","time","viewport","_this$props2","opacity","coordinateSystem","numInstances","getNumInstances","_ref3","worldMatrix","setInstanceCount","updateModuleSettings","uniforms","composeModelMatrix","shouldComposeModelMatrix","sceneModelMatrix","u_Camera","getUniforms","project_uCameraPosition","Layer","layerName"]
}
