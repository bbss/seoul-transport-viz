{
"version":3,
"file":"module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$helpers$tiles_3d_lod.js",
"lineCount":8,
"mappings":"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",
"sources":["node_modules/@loaders_DOT_gl/tiles/dist/es5/tileset/helpers/tiles-3d-lod.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$helpers$tiles_3d_lod\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.calculateDynamicScreenSpaceError = calculateDynamicScreenSpaceError;\nexports.fog = fog;\nexports.getDynamicScreenSpaceError = getDynamicScreenSpaceError;\nexports.getTiles3DScreenSpaceError = getTiles3DScreenSpaceError;\n\nvar _core = require(\"@math.gl/core\");\n\nvar scratchPositionNormal = new _core.Vector3();\nvar scratchCartographic = new _core.Vector3();\nvar scratchMatrix = new _core.Matrix4();\nvar scratchCenter = new _core.Vector3();\nvar scratchPosition = new _core.Vector3();\nvar scratchDirection = new _core.Vector3();\n\nfunction calculateDynamicScreenSpaceError(root, _ref) {\n  var camera = _ref.camera,\n      mapProjection = _ref.mapProjection;\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var _options$dynamicScree = options.dynamicScreenSpaceErrorHeightFalloff,\n      dynamicScreenSpaceErrorHeightFalloff = _options$dynamicScree === void 0 ? 0.25 : _options$dynamicScree,\n      _options$dynamicScree2 = options.dynamicScreenSpaceErrorDensity,\n      dynamicScreenSpaceErrorDensity = _options$dynamicScree2 === void 0 ? 0.00278 : _options$dynamicScree2;\n  var up;\n  var direction;\n  var height;\n  var minimumHeight;\n  var maximumHeight;\n  var tileBoundingVolume = root.contentBoundingVolume;\n\n  if (tileBoundingVolume instanceof TileBoundingRegion) {\n    up = Cartesian3.normalize(camera.positionWC, scratchPositionNormal);\n    direction = camera.directionWC;\n    height = camera.positionCartographic.height;\n    minimumHeight = tileBoundingVolume.minimumHeight;\n    maximumHeight = tileBoundingVolume.maximumHeight;\n  } else {\n    var transformLocal = _core.Matrix4.inverseTransformation(root.computedTransform, scratchMatrix);\n\n    var ellipsoid = mapProjection.ellipsoid;\n    var boundingVolume = tileBoundingVolume.boundingVolume;\n\n    var centerLocal = _core.Matrix4.multiplyByPoint(transformLocal, boundingVolume.center, scratchCenter);\n\n    if (Cartesian3.magnitude(centerLocal) > ellipsoid.minimumRadius) {\n      var centerCartographic = Cartographic.fromCartesian(centerLocal, ellipsoid, scratchCartographic);\n      up = Cartesian3.normalize(camera.positionWC, scratchPositionNormal);\n      direction = camera.directionWC;\n      height = camera.positionCartographic.height;\n      minimumHeight = 0.0;\n      maximumHeight = centerCartographic.height * 2.0;\n    } else {\n      var positionLocal = _core.Matrix4.multiplyByPoint(transformLocal, camera.positionWC, scratchPosition);\n\n      up = Cartesian3.UNIT_Z;\n      direction = _core.Matrix4.multiplyByPointAsVector(transformLocal, camera.directionWC, scratchDirection);\n      direction = Cartesian3.normalize(direction, direction);\n      height = positionLocal.z;\n\n      if (tileBoundingVolume instanceof TileOrientedBoundingBox) {\n        var boxHeight = root._header.boundingVolume.box[11];\n        minimumHeight = centerLocal.z - boxHeight;\n        maximumHeight = centerLocal.z + boxHeight;\n      } else if (tileBoundingVolume instanceof TileBoundingSphere) {\n        var radius = boundingVolume.radius;\n        minimumHeight = centerLocal.z - radius;\n        maximumHeight = centerLocal.z + radius;\n      }\n    }\n  }\n\n  var heightFalloff = dynamicScreenSpaceErrorHeightFalloff;\n  var heightClose = minimumHeight + (maximumHeight - minimumHeight) * heightFalloff;\n  var heightFar = maximumHeight;\n  var t = (0, _core.clamp)((height - heightClose) / (heightFar - heightClose), 0.0, 1.0);\n  var dot = Math.abs(Cartesian3.dot(direction, up));\n  var horizonFactor = 1.0 - dot;\n  horizonFactor = horizonFactor * (1.0 - t);\n  return dynamicScreenSpaceErrorDensity * horizonFactor;\n}\n\nfunction fog(distanceToCamera, density) {\n  var scalar = distanceToCamera * density;\n  return 1.0 - Math.exp(-(scalar * scalar));\n}\n\nfunction getDynamicScreenSpaceError(tileset, distanceToCamera) {\n  if (tileset.dynamicScreenSpaceError && tileset._dynamicScreenSpaceErrorComputedDensity) {\n    var density = tileset._dynamicScreenSpaceErrorComputedDensity;\n    var factor = tileset.dynamicScreenSpaceErrorFactor;\n    var dynamicError = fog(distanceToCamera, density) * factor;\n    return dynamicError;\n  }\n\n  return 0;\n}\n\nfunction getTiles3DScreenSpaceError(tile, frameState, useParentLodMetric) {\n  var tileset = tile.tileset;\n  var parentLodMetricValue = tile.parent && tile.parent.lodMetricValue || tile.lodMetricValue;\n  var lodMetricValue = useParentLodMetric ? parentLodMetricValue : tile.lodMetricValue;\n\n  if (lodMetricValue === 0.0) {\n    return 0.0;\n  }\n\n  var distance = Math.max(tile._distanceToCamera, 1e-7);\n  var height = frameState.height,\n      sseDenominator = frameState.sseDenominator;\n  var error = lodMetricValue * height / (distance * sseDenominator);\n  error -= getDynamicScreenSpaceError(tileset, distance);\n  return error;\n}\n//# sourceMappingURL=tiles-3d-lod.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","fog","distanceToCamera","density","scalar","Math","exp","getDynamicScreenSpaceError","tileset","dynamicScreenSpaceError","_dynamicScreenSpaceErrorComputedDensity","factor","dynamicScreenSpaceErrorFactor","Object","defineProperty","value","calculateDynamicScreenSpaceError","root","_ref","camera","mapProjection","options","arguments","length","undefined","_options$dynamicScree","dynamicScreenSpaceErrorHeightFalloff","_options$dynamicScree2","dynamicScreenSpaceErrorDensity","tileBoundingVolume","contentBoundingVolume","TileBoundingRegion","up","Cartesian3","normalize","positionWC","scratchPositionNormal","direction","directionWC","height","positionCartographic","minimumHeight","maximumHeight","transformLocal","_core","Matrix4","inverseTransformation","computedTransform","scratchMatrix","ellipsoid","boundingVolume","centerLocal","multiplyByPoint","center","scratchCenter","magnitude","minimumRadius","centerCartographic","Cartographic","fromCartesian","scratchCartographic","positionLocal","scratchPosition","UNIT_Z","multiplyByPointAsVector","scratchDirection","z","TileOrientedBoundingBox","boxHeight","_header","box","TileBoundingSphere","radius","heightClose","heightFar","t","clamp","horizonFactor","abs","dot","getTiles3DScreenSpaceError","tile","frameState","useParentLodMetric","parentLodMetricValue","parent","lodMetricValue","distance","max","_distanceToCamera","sseDenominator","Vector3"]
}
