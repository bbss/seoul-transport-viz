{"version":3,"sources":["deck/base.cljs"],"mappings":"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","names":["js/console.log","deck.base/mapbox-token","cljs.core.atom","deck.base/active-layers","deck.base/assoc-cljs-data","o","data","goog.object/set","cljs.core/to-array","var_args","G__82154","deck.base/set-tooltip","js/Error","p__82155","vec__82156","cljs.core.nth","p__82159","p__82160","vec__82161","map__82164","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","x","y","label","deck.base.set_tooltip","font-color","tooltip","js/document","el","new-el","helix.core/get-react","helix.impl.props/merge-obj","obj82211","helix.impl.props._native_props","deck.base/window-resolve","symbol","p1__82166#","p2__82167#","cljs.core.reduce","js/window","cljs.core.conj","clojure.string.split","clojure.string/replace","cljs.core/namespace","cljs.core/name","p__82168","vec__82169","deck.base/set-hiccup-tooltip","hiccup","js/module$node_modules$react_dom$server_browser.renderToStaticMarkup","deck.base/compile-and-add-layer","layer-props","compiled-layer-props","cljs.core.doall","cljs.core.keep","p__82172","vec__82173","k","v","cognitect.transit/tagged-value?","sci.core.eval_string","cljs.core.sequence","cljs.core/seq","cljs.core.concat","cljs.core/List","cljs.core.pr_str","cljs.core.into","uses-functions?","cljs.core/some","p__82176","vec__82177","cljs.core.swap_BANG_","cljs.core/assoc","G__82180","deck.layers/key->class","cljs-bean.core/->js","cljs.core.merge","deck.base/rerender","G__82181","js/deck","js/deck.base","js/deck.base.default-view-state","deck.base/default-view-state","cljs.core/clj->js","goog.object/get","js/module$node_modules$react_dom$index.render","deck.layers/deck","cljs.core/deref","cljs.core/vals","deck.layers/static-map","p__82182","map__82183","deck.base/handler","id","type","payload","command","G__82185","cljs.core/Keyword","cljs.core/reset!","cljs.core/dissoc","deck.base/set-path-value","deck.base/compile","form","deck.base/compile-layer-props","p__82186","vec__82187","p__82190","vec__82191","G__82194","G__82195","args__4742__auto__","len__4736__auto__","i__4737__auto__","argseq__4743__auto__","cljs.core/IndexedSeq","deck.base/embed-component","seq82196","self__4724__auto__","config-or-layers","layers","cljs.core.filter","config","or__4126__auto__","cljs.core/identity","cljs.core/map?","c","cljs.core.map","G__82199","props__80828__auto__","maybe-ref__80829__auto__","vec__82200","helix.core/extract-cljs-props","goog/DEBUG","G__82216","deck.base/deck-component","props","map__82203","use-path-sub","dep-values","p__82204","vec__82205","dep-name","dep-path","view-state","G__82208","data->layers","cljs.core.mapcat","p__82212","vec__82213","layer-type","layer","cljs.core.assoc"],"sourcesContent":["(ns deck.base\n  (:require\n   [deck.layers :refer [key->class]]\n   [react :as react]\n   [react-dom :refer [render]]\n   [\"react-dom/server\" :as ReactDOMServer]\n   [goog.object :as gobj]\n   [cognitect.transit :as transit]\n   [cljs-bean.core :refer [bean ->clj ->js]]\n   [helix.core :refer [$ defnc <>]]\n   [helix.dom :refer [div]]\n   [sci.core :as sci]))\n\n(js/console.log \"LOADED CLJS DECK BASE APP\")\n\n(def mapbox-token (atom nil))\n\n(def active-layers (atom {}))\n\n(declare rerender)\n\n(defn assoc-cljs-data [o data]\n  (gobj/set o \"data\" (to-array data))\n  o)\n\n(defn set-tooltip\n  ([[x y] label] (set-tooltip [x y] label {}))\n  ([[x y] label {:keys [font-color]\n                 :or {font-color \"white\"}}]\n   (let [tooltip (.getElementById js/document \"tooltip\")\n         el (if tooltip\n              tooltip\n              (let [new-el (.createElement js/document \"div\")]\n                (.setAttribute new-el \"id\" \"tooltip\")\n                (.append (.-body js/document) new-el)\n                new-el))]\n     (if label\n       (do (set! (.-innerHTML el) label)\n           (set! (.. el -style -display) \"block\")\n           (set! (.. el -style -position) \"absolute\")\n           (set! (.. el -style -zIndex) 10)\n           (set! (.. el -style -left) (str (+ x 20) \"px\"))\n           (set! (.. el -style -top) (str (+ y 20) \"px\"))\n           (set! (.. el -style -color) font-color))\n       (set! (.. el -style -display) \"none\")))))\n\n(defn window-resolve [symbol]\n  (reduce #(aget %1 %2)\n          js/window\n          (conj (clojure.string/split (clojure.string/replace (namespace symbol) \"-\" \"_\")\n                                      \".\")\n                (clojure.string/replace (name symbol) \"-\" \"_\"))))\n\n(defn set-hiccup-tooltip [[x y] hiccup]\n  (let [tooltip (.getElementById js/document \"tooltip\")\n        el (if tooltip\n             tooltip\n             (let [new-el (.createElement js/document \"div\")]\n               (.setAttribute new-el \"id\" \"tooltip\")\n               (.append (.-body js/document) new-el)\n               new-el))]\n    (if hiccup\n      (do (set! (.-innerHTML el)\n                (ReactDOMServer/renderToStaticMarkup\n                 (apply (window-resolve 'sablono.interpreter/element) [hiccup])))\n          (set! (.. el -style -display) \"block\")\n          (set! (.. el -style -position) \"absolute\")\n          (set! (.. el -style -zIndex) 10)\n          (set! (.. el -style -left) (str (+ x 20) \"px\"))\n          (set! (.. el -style -top) (str (+ y 20) \"px\")))\n      (set! (.. el -style -display) \"none\"))))\n\n(defn compile-and-add-layer [layer-props]\n  (let [compiled-layer-props\n        (doall (->> layer-props\n                    (keep (fn [[k v]]\n                            (when (transit/tagged-value? v)\n                              [k (sci/eval-string\n                                  (pr-str `(comp clj->js ~(aget v \"rep\")))\n                                  {:bindings {'js/console.log js/console.log\n                                              'js/document    js/document\n                                              'set-tooltip    set-tooltip\n                                              'set-hiccup-tooltip set-hiccup-tooltip}\n                                   :classes {:allow :all}})])))\n                    (into {})))\n        uses-functions? (some (fn [[k v]]\n                                (transit/tagged-value? v))\n                              layer-props)]\n    (if uses-functions?\n      (do (swap! active-layers assoc (:id layer-props)\n                 (apply (key->class (:layer-type layer-props))\n                        [(assoc-cljs-data (->js (merge layer-props compiled-layer-props))\n                                          (:data layer-props))]))\n          (rerender))\n      (do (swap! active-layers assoc (:id layer-props)\n                 (apply (key->class (:layer-type layer-props))\n                        [(->js layer-props)]))\n          (rerender)))))\n\n(defonce default-view-state\n  (clj->js\n   {:latitude 37.618889\n    :longitude -122.375\n    :zoom   10\n    :bearing 0\n    :pitch  0\n    :width  (gobj/get js/window \"innerWidth\")\n    :height (gobj/get js/window \"innerHeight\")}))\n\n(defn rerender []\n  (render\n   (deck.layers/deck\n    {:key \"deck\"\n     :controller true\n     :pickingRadius 10\n     :initialViewState default-view-state\n     :layers (to-array (vals @active-layers))\n     :children [(when @mapbox-token\n                  (deck.layers/static-map\n                   {:key \"map\"\n                    :mapboxApiAccessToken @mapbox-token\n                    :reuseMaps true\n                    :mapStyle \"mapbox://styles/mapbox/dark-v9\"\n                    :preventStyleDiffing true}))]})\n   (. js/document getElementById \"app\")))\n\n(defn handler [{:keys [id type payload] :as command}]\n  (js/console.log \"deck handler command: \" command)\n  (case type\n    :mapbox-token (when-not @mapbox-token\n                    (reset! mapbox-token payload))\n    :register-plugin (when (:mapbox-token payload) (reset! mapbox-token (:mapbox-token payload)))\n    :visualize (compile-and-add-layer payload)\n    :erase (do (swap! active-layers dissoc payload)\n                     (rerender)))\n  (rerender))\n\n(def set-path-value (window-resolve 'browjure.state/set-path-value))\n\n(defn compile [form]\n  (sci/eval-string\n   (pr-str form)\n   {:bindings {'js/console.log js/console.log\n               'js/document    js/document\n               'set-tooltip set-tooltip\n               'set-path-value set-path-value}\n    :classes {:allow :all}}))\n\n(defn compile-layer-props [layer-props]\n  (let [compiled-layer-props\n        (doall (->> layer-props\n                    (keep (fn [[k v]]\n                            (when (transit/tagged-value? v)\n                              [k (sci/eval-string\n                                  (pr-str `(comp clj->js ~(aget v \"rep\")))\n                                  {:bindings {'js/console.log js/console.log\n                                              'js/document    js/document\n                                              'set-tooltip set-tooltip\n                                              'set-path-value set-path-value}\n                                   :classes {:allow :all}})])))\n                    (into {})))\n        uses-functions? (some (fn [[k v]]\n                                (transit/tagged-value? v))\n                              layer-props)]\n    (if uses-functions?\n      (apply (key->class (:layer-type layer-props))\n             [(assoc-cljs-data (->js (merge layer-props compiled-layer-props))\n                               (:data layer-props))])\n      (apply (key->class (:layer-type layer-props))\n             [(->js layer-props)]))))\n\n(defn embed-component [& config-or-layers]\n  (let [layers (filter :layer-type config-or-layers)\n        config (or (some identity (filter map? config-or-layers)) {})]\n    [:div\n     (merge {:style {:width \"600px\" :height \"600px\"}\n             :ref (fn [c]\n                    (when c\n                      (render\n                       (deck.layers/deck\n                        {:key \"deck\"\n                         :style {:position \"relative\"}\n                         :controller true\n                         :container c\n                         :pickingRadius 10\n                         :initialViewState default-view-state\n                         :layers (to-array (map compile-layer-props layers))\n                         :children [(when (or @mapbox-token (:mapbox-token config))\n                                      (deck.layers/static-map\n                                       {:key \"map\"\n                                        :mapboxApiAccessToken (or @mapbox-token (:mapbox-token config))\n                                        :reuseMaps true\n                                        :mapStyle \"mapbox://styles/mapbox/dark-v9\"\n                                        :preventStyleDiffing true}))]})\n                       c)))}\n            (:container-props config))]))\n\n(defnc deck-component [props]\n  (let [use-path-sub (window-resolve 'browjure.state/use-path-sub)\n        dep-values (doall (->> (:dataset/dependencies props)\n                               (map (fn [[dep-name dep-path]]\n                                      [dep-name (use-path-sub dep-path)]))\n                               (into {})))\n        view-state (use-path-sub [:view-state])\n        {:deck/keys [data->layers]} props\n        data->layers (compile (aget data->layers \"rep\"))]\n    (js/console.log \"view state\" view-state)\n    ($ \"div\"\n       {:key (str \"deck\" (:id props))\n        :ref (fn [c]\n               (when c\n                 (render\n                  (deck.layers/deck\n                   {:key \"deck\"\n                    :style {:position \"relative\"}\n                    :controller true\n                    :container c\n                    :pickingRadius 10\n                    :initialViewState (or (clj->js view-state) default-view-state)\n                    :layers (->> (data->layers dep-values)\n                                 (mapcat (fn [[layer-type layers]]\n                                           (doall\n                                            (map (fn [layer]\n                                                   (compile-layer-props\n                                                    (assoc layer :layer-type layer-type)))\n                                                 layers))))\n                                 to-array)\n                    :children [(when (or @mapbox-token (:mapbox-token props))\n                                 (deck.layers/static-map\n                                  {:key \"map\"\n                                   :mapboxApiAccessToken (or @mapbox-token (:mapbox-token props))\n                                   :reuseMaps true\n                                   :mapStyle \"mapbox://styles/mapbox/dark-v9\"\n                                   :preventStyleDiffing true}))]})\n                  c)))\n        & (:container-props props)})))\n"]}