shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$lib$attribute$attribute=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard");module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _defineProperty2=module(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_slicedToArray2=module(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),
_classCallCheck2=module(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=module(require("module$node_modules$$babel$runtime$helpers$createClass")),_possibleConstructorReturn2=module(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),_getPrototypeOf2=module(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),_get2=module(require("module$node_modules$$babel$runtime$helpers$get")),_inherits2=module(require("module$node_modules$$babel$runtime$helpers$inherits")),
_dataColumn=module(require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$attribute$data_column")),_assert=module(require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$assert")),_iterableUtils=require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$iterable_utils"),_flatten=require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$flatten"),range=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$range")),_attributeTransitionUtils=require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$attribute$attribute_transition_utils");
require=function(_DataColumn){function Attribute(gl){var opts=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2["default"])(this,Attribute);var _this=(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(Attribute).call(this,gl,opts));var _opts$transition=opts.transition,_opts$noAlloc=opts.noAlloc,_opts$update=opts.update,_opts$accessor=opts.accessor;_opts$accessor=void 0===_opts$accessor?null:_opts$accessor;var _opts$transform=opts.transform;
opts=opts.startIndices;opts=void 0===opts?null:opts;Object.assign(_this.settings,{transition:void 0===_opts$transition?!1:_opts$transition,noAlloc:void 0===_opts$noAlloc?!1:_opts$noAlloc,update:(void 0===_opts$update?null:_opts$update)||_opts$accessor&&_this._autoUpdater,accessor:_opts$accessor,transform:void 0===_opts$transform?null:_opts$transform});Object.assign(_this.state,{lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:range.FULL,startIndices:opts});
Object.seal(_this.settings);Object.seal(_this.state);_this._validateAttributeUpdaters();return _this}(0,_inherits2["default"])(Attribute,_DataColumn);(0,_createClass2["default"])(Attribute,[{key:"needsUpdate",value:function(){return this.state.needsUpdate}},{key:"needsRedraw",value:function(){var _ref$clearChangedFlag=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).clearChangedFlags,needsRedraw=this.state.needsRedraw;this.state.needsRedraw=needsRedraw&&!(void 0===_ref$clearChangedFlag?
0:_ref$clearChangedFlag);return needsRedraw}},{key:"getUpdateTriggers",value:function(){var accessor=this.settings.accessor;return[this.id].concat("function"!==typeof accessor&&accessor||[])}},{key:"supportsTransition",value:function(){return!!this.settings.transition}},{key:"getTransitionSetting",value:function(opts){var accessor=this.settings.accessor,layerSettings=this.settings.transition;if(!this.supportsTransition())return null;accessor=Array.isArray(accessor)?opts[accessor.find(function(a){return opts[a]})]:
opts[accessor];return(0,_attributeTransitionUtils.normalizeTransitionSettings)(accessor,layerSettings)}},{key:"setNeedsUpdate",value:function(){var reason=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.id,dataRange=1<arguments.length?arguments[1]:void 0;this.state.needsUpdate=this.state.needsUpdate||reason;this.setNeedsRedraw(reason);dataRange?(reason=dataRange.startRow,dataRange=dataRange.endRow,this.state.updateRanges=range.add(this.state.updateRanges,[void 0===reason?0:reason,void 0===
dataRange?Infinity:dataRange])):this.state.updateRanges=range.FULL}},{key:"clearNeedsUpdate",value:function(){this.state.needsUpdate=!1;this.state.updateRanges=range.EMPTY}},{key:"setNeedsRedraw",value:function(){var reason=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||reason}},{key:"update",value:function(opts){this.setData(opts)}},{key:"allocate",value:function(numInstances){var state=this.state,settings=this.settings;return settings.noAlloc?
!1:settings.update?((0,_assert["default"])(Number.isFinite(numInstances)),(0,_get2["default"])((0,_getPrototypeOf2["default"])(Attribute.prototype),"allocate",this).call(this,{numInstances:numInstances,copy:state.updateRanges!==range.FULL}),!0):!1}},{key:"updateBuffer",value:function(_ref2){var numInstances=_ref2.numInstances,data=_ref2.data,props=_ref2.props,context=_ref2.context;if(!this.needsUpdate())return!1;_ref2=this.state.updateRanges;var _this$settings=this.settings,update=_this$settings.update;
_this$settings=_this$settings.noAlloc;var updated=!0;if(update){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=_ref2[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=(0,_slicedToArray2["default"])(_step.value,2);update.call(context,this,{data:data,startRow:_step$value[0],endRow:_step$value[1],props:props,numInstances:numInstances})}}catch(err){_didIteratorError=!0,_iteratorError=
err}finally{try{if(!_iteratorNormalCompletion&&null!=_iterator["return"])_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError;}}if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant});else{data=!0;props=!1;_iterator=void 0;try{for(var _iterator2=_ref2[Symbol.iterator](),_step2;!(data=(_step2=_iterator2.next()).done);data=!0){var _step2$value=(0,_slicedToArray2["default"])(_step2.value,2),
startRow=_step2$value[0],endRow=_step2$value[1],startOffset=Number.isFinite(startRow)?this.getVertexOffset(startRow):0,endOffset=Number.isFinite(endRow)?this.getVertexOffset(endRow):_this$settings||!Number.isFinite(numInstances)?this.value.length:numInstances*this.size;(0,_get2["default"])((0,_getPrototypeOf2["default"])(Attribute.prototype),"updateSubBuffer",this).call(this,{startOffset:startOffset,endOffset:endOffset})}}catch(err$417){props=!0,_iterator=err$417}finally{try{if(!data&&null!=_iterator2["return"])_iterator2["return"]()}finally{if(props)throw _iterator;
}}}this._checkAttributeArray()}else updated=!1;this.clearNeedsUpdate();this.setNeedsRedraw();return updated}},{key:"setConstantValue",value:function(value){if(void 0===value||"function"===typeof value)return!1;this.setData({constant:!0,value:value})&&this.setNeedsRedraw();this.clearNeedsUpdate();return!0}},{key:"setExternalBuffer",value:function(buffer){var state=this.state;if(!buffer)return state.lastExternalBuffer=null,!1;this.clearNeedsUpdate();if(state.lastExternalBuffer===buffer)return!0;state.lastExternalBuffer=
buffer;this.setNeedsRedraw();this.setData(buffer);return!0}},{key:"setBinaryValue",value:function(buffer){var startIndices=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,state=this.state,settings=this.settings;if(!buffer)return state.binaryValue=null,state.binaryAccessor=null,!1;if(settings.noAlloc)return!1;if(state.binaryValue===buffer)return this.clearNeedsUpdate(),!0;state.binaryValue=buffer;this.setNeedsRedraw();ArrayBuffer.isView(buffer)&&(buffer={value:buffer});if(settings.transform||
startIndices!==this.startIndices)return(0,_assert["default"])(ArrayBuffer.isView(buffer.value),"invalid ".concat(settings.accessor)),settings=buffer.size&&buffer.size!==this.size,state.binaryAccessor=(0,_iterableUtils.getAccessorFromBuffer)(buffer.value,{size:buffer.size||this.size,stride:buffer.stride,offset:buffer.offset,startIndices:startIndices,nested:settings}),!1;this.clearNeedsUpdate();this.setData(buffer);return!0}},{key:"getVertexOffset",value:function(row){var startIndices=this.startIndices;
return(startIndices?startIndices[row]:row)*this.size}},{key:"getShaderAttributes",value:function(){var shaderAttributeDefs=this.settings.shaderAttributes||(0,_defineProperty2["default"])({},this.id,null),shaderAttributes={},shaderAttributeName;for(shaderAttributeName in shaderAttributeDefs)Object.assign(shaderAttributes,(0,_get2["default"])((0,_getPrototypeOf2["default"])(Attribute.prototype),"getShaderAttributes",this).call(this,shaderAttributeName,shaderAttributeDefs[shaderAttributeName]));return shaderAttributes}},
{key:"_autoUpdater",value:function(attribute,_ref4){var data=_ref4.data,startRow=_ref4.startRow,endRow=_ref4.endRow,props=_ref4.props;_ref4=_ref4.numInstances;var settings=attribute.settings,value=attribute.value,size=attribute.size,startIndices=attribute.startIndices,accessor=settings.accessor;settings=settings.transform;props=attribute.state.binaryAccessor||("function"===typeof accessor?accessor:props[accessor]);(0,_assert["default"])("function"===typeof props,'accessor "'.concat(accessor,'" is not a function'));
accessor=attribute.getVertexOffset(startRow);data=(0,_iterableUtils.createIterable)(data,startRow,endRow);var iterable=data.iterable;data=data.objectInfo;startRow=!0;endRow=!1;var _iteratorError3=void 0;try{for(var _iterator3=iterable[Symbol.iterator](),_step3;!(startRow=(_step3=_iterator3.next()).done);startRow=!0){var object=_step3.value;data.index++;var objectValue=props(object,data);settings&&(objectValue=settings.call(this,objectValue));if(startIndices){var numVertices=(startIndices[data.index+
1]||_ref4)-startIndices[data.index];if(objectValue&&Array.isArray(objectValue[0])){iterable=accessor;var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _iterator4=objectValue[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0)attribute._normalizeValue(_step4.value,value,iterable),iterable+=size}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&null!=
_iterator4["return"])_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4;}}}else objectValue&&objectValue.length>size?value.set(objectValue,accessor):(attribute._normalizeValue(objectValue,data.target,0),(0,_flatten.fillArray)({target:value,source:data.target,start:accessor,count:numVertices}));accessor+=numVertices*size}else attribute._normalizeValue(objectValue,value,accessor),accessor+=size}}catch(err$418){endRow=!0,_iteratorError3=err$418}finally{try{if(!startRow&&null!=
_iterator3["return"])_iterator3["return"]()}finally{if(endRow)throw _iteratorError3;}}attribute.constant=!1}},{key:"_validateAttributeUpdaters",value:function(){var settings=this.settings;if(!settings.noAlloc&&"function"!==typeof settings.update)throw Error("Attribute ".concat(this.id," missing update or accessor"));}},{key:"_checkAttributeArray",value:function(){var value=this.value,limit=Math.min(4,this.size);if(value&&value.length>=limit){var valid=!0;switch(limit){case 4:valid=valid&&Number.isFinite(value[3]);
case 3:valid=valid&&Number.isFinite(value[2]);case 2:valid=valid&&Number.isFinite(value[1]);case 1:valid=valid&&Number.isFinite(value[0]);break;default:valid=!1}if(!valid)throw Error("Illegal attribute generated for ".concat(this.id));}}},{key:"startIndices",get:function(){return this.state.startIndices},set:function(layout){this.state.startIndices=layout}}]);return Attribute}(_dataColumn["default"]);exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$lib$attribute$attribute.js.map
