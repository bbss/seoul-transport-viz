{
"version":3,
"file":"module$node_modules$$loaders_DOT_gl$3d_tiles$dist$es5$lib$classes$tile_3d_batch_table_hierarchy.js",
"lineCount":11,
"mappings":"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",
"sources":["node_modules/@loaders_DOT_gl/3d-tiles/dist/es5/lib/classes/tile-3d-batch-table-hierarchy.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$loaders_DOT_gl$3d_tiles$dist$es5$lib$classes$tile_3d_batch_table_hierarchy\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.initializeHierarchy = initializeHierarchy;\nexports.traverseHierarchy = traverseHierarchy;\n\nvar _readOnlyError2 = _interopRequireDefault(require(\"@babel/runtime/helpers/readOnlyError\"));\n\nvar defined = function defined(x) {\n  return x !== undefined;\n};\n\nfunction initializeHierarchy(batchTable, jsonHeader, binaryBody) {\n  if (!jsonHeader) {\n    return null;\n  }\n\n  var hierarchy = batchTable.getExtension('3DTILES_batch_table_hierarchy');\n  var legacyHierarchy = jsonHeader.HIERARCHY;\n\n  if (legacyHierarchy) {\n    console.warn('3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy.');\n    jsonHeader.extensions = jsonHeader.extensions || {};\n    jsonHeader.extensions['3DTILES_batch_table_hierarchy'] = legacyHierarchy;\n    hierarchy = legacyHierarchy;\n  }\n\n  if (!hierarchy) {\n    return null;\n  }\n\n  return initializeHierarchyValues(hierarchy, binaryBody);\n}\n\nfunction initializeHierarchyValues(hierarchyJson, binaryBody) {\n  var i;\n  var classId;\n  var binaryAccessor;\n  var instancesLength = hierarchyJson.instancesLength;\n  var classes = hierarchyJson.classes;\n  var classIds = hierarchyJson.classIds;\n  var parentCounts = hierarchyJson.parentCounts;\n  var parentIds = hierarchyJson.parentIds;\n  var parentIdsLength = instancesLength;\n\n  if (defined(classIds.byteOffset)) {\n    classIds.componentType = defaultValue(classIds.componentType, GL.UNSIGNED_SHORT);\n    classIds.type = AttributeType.SCALAR;\n    binaryAccessor = getBinaryAccessor(classIds);\n    classIds = ((0, _readOnlyError2[\"default\"])(\"classIds\"), binaryAccessor.createArrayBufferView(binaryBody.buffer, binaryBody.byteOffset + classIds.byteOffset, instancesLength));\n  }\n\n  var parentIndexes;\n\n  if (defined(parentCounts)) {\n    if (defined(parentCounts.byteOffset)) {\n      parentCounts.componentType = defaultValue(parentCounts.componentType, GL.UNSIGNED_SHORT);\n      parentCounts.type = AttributeType.SCALAR;\n      binaryAccessor = getBinaryAccessor(parentCounts);\n      parentCounts = ((0, _readOnlyError2[\"default\"])(\"parentCounts\"), binaryAccessor.createArrayBufferView(binaryBody.buffer, binaryBody.byteOffset + parentCounts.byteOffset, instancesLength));\n    }\n\n    parentIndexes = new Uint16Array(instancesLength);\n    parentIdsLength = ((0, _readOnlyError2[\"default\"])(\"parentIdsLength\"), 0);\n\n    for (i = 0; i < instancesLength; ++i) {\n      parentIndexes[i] = parentIdsLength;\n      parentIdsLength += ((0, _readOnlyError2[\"default\"])(\"parentIdsLength\"), parentCounts[i]);\n    }\n  }\n\n  if (defined(parentIds) && defined(parentIds.byteOffset)) {\n    parentIds.componentType = defaultValue(parentIds.componentType, GL.UNSIGNED_SHORT);\n    parentIds.type = AttributeType.SCALAR;\n    binaryAccessor = getBinaryAccessor(parentIds);\n    parentIds = ((0, _readOnlyError2[\"default\"])(\"parentIds\"), binaryAccessor.createArrayBufferView(binaryBody.buffer, binaryBody.byteOffset + parentIds.byteOffset, parentIdsLength));\n  }\n\n  var classesLength = classes.length;\n\n  for (i = 0; i < classesLength; ++i) {\n    var classInstancesLength = classes[i].length;\n    var properties = classes[i].instances;\n    var binaryProperties = getBinaryProperties(classInstancesLength, properties, binaryBody);\n    classes[i].instances = combine(binaryProperties, properties);\n  }\n\n  var classCounts = new Array(classesLength).fill(0);\n  var classIndexes = new Uint16Array(instancesLength);\n\n  for (i = 0; i < instancesLength; ++i) {\n    classId = classIds[i];\n    classIndexes[i] = classCounts[classId];\n    ++classCounts[classId];\n  }\n\n  var hierarchy = {\n    classes: classes,\n    classIds: classIds,\n    classIndexes: classIndexes,\n    parentCounts: parentCounts,\n    parentIndexes: parentIndexes,\n    parentIds: parentIds\n  };\n  validateHierarchy(hierarchy);\n  return hierarchy;\n}\n\nfunction traverseHierarchy(hierarchy, instanceIndex, endConditionCallback) {\n  if (!hierarchy) {\n    return;\n  }\n\n  var parentCounts = hierarchy.parentCounts;\n  var parentIds = hierarchy.parentIds;\n\n  if (parentIds) {\n    return endConditionCallback(hierarchy, instanceIndex);\n  }\n\n  if (parentCounts > 0) {\n    return traverseHierarchyMultipleParents(hierarchy, instanceIndex, endConditionCallback);\n  }\n\n  return traverseHierarchySingleParent(hierarchy, instanceIndex, endConditionCallback);\n}\n\nfunction traverseHierarchyMultipleParents(hierarchy, instanceIndex, endConditionCallback) {\n  var classIds = hierarchy.classIds;\n  var parentCounts = hierarchy.parentCounts;\n  var parentIds = hierarchy.parentIds;\n  var parentIndexes = hierarchy.parentIndexes;\n  var instancesLength = classIds.length;\n  var visited = scratchVisited;\n  visited.length = Math.max(visited.length, instancesLength);\n  var visitedMarker = ++marker;\n  var stack = scratchStack;\n  stack.length = 0;\n  stack.push(instanceIndex);\n\n  while (stack.length > 0) {\n    instanceIndex = stack.pop();\n\n    if (visited[instanceIndex] === visitedMarker) {\n      continue;\n    }\n\n    visited[instanceIndex] = visitedMarker;\n    var result = endConditionCallback(hierarchy, instanceIndex);\n\n    if (defined(result)) {\n      return result;\n    }\n\n    var parentCount = parentCounts[instanceIndex];\n    var parentIndex = parentIndexes[instanceIndex];\n\n    for (var i = 0; i < parentCount; ++i) {\n      var parentId = parentIds[parentIndex + i];\n\n      if (parentId !== instanceIndex) {\n        stack.push(parentId);\n      }\n    }\n  }\n\n  return null;\n}\n\nfunction traverseHierarchySingleParent(hierarchy, instanceIndex, endConditionCallback) {\n  var hasParent = true;\n\n  while (hasParent) {\n    var result = endConditionCallback(hierarchy, instanceIndex);\n\n    if (defined(result)) {\n      return result;\n    }\n\n    var parentId = hierarchy.parentIds[instanceIndex];\n    hasParent = parentId !== instanceIndex;\n    instanceIndex = parentId;\n  }\n\n  throw new Error('traverseHierarchySingleParent');\n}\n\nfunction validateHierarchy(hierarchy) {\n  var scratchValidateStack = [];\n  var classIds = hierarchy.classIds;\n  var instancesLength = classIds.length;\n\n  for (var i = 0; i < instancesLength; ++i) {\n    validateInstance(hierarchy, i, stack);\n  }\n}\n\nfunction validateInstance(hierarchy, instanceIndex, stack) {\n  var parentCounts = hierarchy.parentCounts;\n  var parentIds = hierarchy.parentIds;\n  var parentIndexes = hierarchy.parentIndexes;\n  var classIds = hierarchy.classIds;\n  var instancesLength = classIds.length;\n\n  if (!defined(parentIds)) {\n    return;\n  }\n\n  assert(instanceIndex < instancesLength, \"Parent index \".concat(instanceIndex, \" exceeds the total number of instances: \").concat(instancesLength));\n  assert(stack.indexOf(instanceIndex) === -1, 'Circular dependency detected in the batch table hierarchy.');\n  stack.push(instanceIndex);\n  var parentCount = defined(parentCounts) ? parentCounts[instanceIndex] : 1;\n  var parentIndex = defined(parentCounts) ? parentIndexes[instanceIndex] : instanceIndex;\n\n  for (var i = 0; i < parentCount; ++i) {\n    var parentId = parentIds[parentIndex + i];\n\n    if (parentId !== instanceIndex) {\n      validateInstance(hierarchy, parentId, stack);\n    }\n  }\n\n  stack.pop(instanceIndex);\n}\n//# sourceMappingURL=tile-3d-batch-table-hierarchy.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","validateInstance","hierarchy","instanceIndex","stack","parentCounts","parentIds","parentIndexes","instancesLength","classIds","length","defined","assert","concat","indexOf","push","parentCount","parentIndex","i","parentId","pop","_interopRequireDefault","Object","defineProperty","value","initializeHierarchy","batchTable","jsonHeader","binaryBody","getExtension","legacyHierarchy","HIERARCHY","console","warn","extensions","classes","parentIdsLength","byteOffset","componentType","defaultValue","GL","UNSIGNED_SHORT","type","AttributeType","SCALAR","binaryAccessor","getBinaryAccessor","_readOnlyError2","createArrayBufferView","buffer","Uint16Array","classesLength","properties","instances","binaryProperties","getBinaryProperties","combine","classCounts","Array","fill","classIndexes","classId","traverseHierarchy","endConditionCallback","visited","scratchVisited","Math","max","visitedMarker","marker","scratchStack","result","hasParent","Error","x","undefined"]
}
