shadow$provide.module$node_modules$$deck_DOT_gl$layers$dist$es5$text_layer$text_layer=function(global,require,module,exports){function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=
null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard");module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");
Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _slicedToArray2=module(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),_defineProperty2=module(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_classCallCheck2=module(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=module(require("module$node_modules$$babel$runtime$helpers$createClass")),_possibleConstructorReturn2=module(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),
_getPrototypeOf2=module(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),_get2=module(require("module$node_modules$$babel$runtime$helpers$get")),_inherits2=module(require("module$node_modules$$babel$runtime$helpers$inherits")),_core=require("module$node_modules$$deck_DOT_gl$core$dist$es5$index"),_multiIconLayer=module(require("module$node_modules$$deck_DOT_gl$layers$dist$es5$text_layer$multi_icon_layer$multi_icon_layer")),_fontAtlasManager=global(require("module$node_modules$$deck_DOT_gl$layers$dist$es5$text_layer$font_atlas_manager")),
_utils=require("module$node_modules$$deck_DOT_gl$layers$dist$es5$text_layer$utils"),DEFAULT_FONT_SETTINGS={fontSize:_fontAtlasManager.DEFAULT_FONT_SIZE,buffer:_fontAtlasManager.DEFAULT_BUFFER,sdf:!1,radius:_fontAtlasManager.DEFAULT_RADIUS,cutoff:_fontAtlasManager.DEFAULT_CUTOFF},TEXT_ANCHOR={start:1,middle:0,end:-1},ALIGNMENT_BASELINE={top:1,center:0,bottom:-1},FONT_SETTINGS_PROPS=["fontSize","buffer","sdf","radius","cutoff"];require={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,
backgroundColor:{type:"color",value:null,optional:!0},characterSet:_fontAtlasManager.DEFAULT_CHAR_SET,fontFamily:_fontAtlasManager.DEFAULT_FONT_FAMILY,fontWeight:_fontAtlasManager.DEFAULT_FONT_WEIGHT,lineHeight:1,fontSettings:{},wordBreak:"word-break",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:function(x){return x.text}},getPosition:{type:"accessor",value:function(x){return x.position}},getColor:{type:"accessor",value:[0,0,0,255]},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",
value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]}};global=function(_CompositeLayer){function TextLayer(){(0,_classCallCheck2["default"])(this,TextLayer);return(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(TextLayer).apply(this,arguments))}(0,_inherits2["default"])(TextLayer,_CompositeLayer);(0,_createClass2["default"])(TextLayer,[{key:"initializeState",value:function(){this.state=
{styleVersion:0,fontAtlasManager:new _fontAtlasManager["default"](this.context.gl)}}},{key:"updateState",value:function(_ref){var props=_ref.props,oldProps=_ref.oldProps;_ref=_ref.changeFlags;var fontChanged=this._fontChanged(oldProps,props);fontChanged&&this._updateFontAtlas(oldProps,props);props=fontChanged||props.lineHeight!==oldProps.lineHeight||props.wordBreak!==oldProps.wordBreak||props.maxWidth!==oldProps.maxWidth;(_ref.dataChanged||_ref.updateTriggersChanged&&(_ref.updateTriggersChanged.all||
_ref.updateTriggersChanged.getText))&&this._updateText();props&&this.setState({styleVersion:this.state.styleVersion+1})}},{key:"finalizeState",value:function(){(0,_get2["default"])((0,_getPrototypeOf2["default"])(TextLayer.prototype),"finalizeState",this).call(this);this.state.fontAtlasManager.finalize()}},{key:"getPickingInfo",value:function(_ref2){_ref2=_ref2.info;return Object.assign(_ref2,{object:0<=_ref2.index?this.props.data[_ref2.index]:null})}},{key:"_updateFontAtlas",value:function(oldProps,
props){this.state.fontAtlasManager.setProps(Object.assign({},DEFAULT_FONT_SETTINGS,props.fontSettings,{characterSet:props.characterSet,fontFamily:props.fontFamily,fontWeight:props.fontWeight}));this.setNeedsRedraw(!0)}},{key:"_fontChanged",value:function(oldProps,props){if(oldProps.fontFamily!==props.fontFamily||oldProps.characterSet!==props.characterSet||oldProps.fontWeight!==props.fontWeight)return!0;if(oldProps.fontSettings===props.fontSettings)return!1;var oldFontSettings=oldProps.fontSettings||
{},fontSettings=props.fontSettings||{};return FONT_SETTINGS_PROPS.some(function(prop){return oldFontSettings[prop]!==fontSettings[prop]})}},{key:"_updateText",value:function(){var data=this.props.data,textBuffer=data.attributes&&data.attributes.getText,getText=this.props.getText,startIndices=data.startIndices;if(textBuffer&&startIndices){getText=(0,_utils.getTextFromBuffer)(_objectSpread({},ArrayBuffer.isView(textBuffer)?{value:textBuffer}:textBuffer,{length:data.length,startIndices:startIndices}));
var texts=getText.texts;textBuffer=getText.characterCount;getText=function(_,_ref3){return texts[_ref3.index]}}else{startIndices=(0,_core.createIterable)(data);data=startIndices.iterable;var objectInfo=startIndices.objectInfo;startIndices=[0];textBuffer=0;var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var object=_step.value;objectInfo.index++;
var text=getText(object,objectInfo)||"";textBuffer+=text.length;startIndices.push(textBuffer)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&null!=_iterator["return"])_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError;}}}this.setState({getText:getText,startIndices:startIndices,numInstances:textBuffer})}},{key:"getIconOffsets",value:function(object,objectInfo){var iconMapping=this.state.fontAtlasManager.mapping,getText=this.state.getText,
_this$props=this.props,wordBreak=_this$props.wordBreak,maxWidth=_this$props.maxWidth,lineHeight=_this$props.lineHeight,getTextAnchor=_this$props.getTextAnchor;_this$props=_this$props.getAlignmentBaseline;getText=getText(object,objectInfo)||"";wordBreak=(0,_utils.transformParagraph)(getText,lineHeight,wordBreak,maxWidth,iconMapping);iconMapping=wordBreak.characters;maxWidth=(0,_slicedToArray2["default"])(wordBreak.size,2);wordBreak=maxWidth[0];maxWidth=maxWidth[1];getTextAnchor=TEXT_ANCHOR["function"===
typeof getTextAnchor?getTextAnchor(object,objectInfo):getTextAnchor];object=ALIGNMENT_BASELINE["function"===typeof _this$props?_this$props(object,objectInfo):_this$props];objectInfo=Array(2*getText.length);_this$props=0;getText=!0;lineHeight=!1;var _iteratorError2=void 0;try{for(var _iterator2=iconMapping[Symbol.iterator](),_step2;!(getText=(_step2=_iterator2.next()).done);getText=!0){var _step2$value=_step2.value,x=_step2$value.x,y=_step2$value.y,rowOffset=(1-getTextAnchor)*(wordBreak-_step2$value.rowWidth)/
2;objectInfo[_this$props++]=(getTextAnchor-1)*wordBreak/2+rowOffset+x;objectInfo[_this$props++]=(object-1)*maxWidth/2+y}}catch(err){lineHeight=!0,_iteratorError2=err}finally{try{if(!getText&&null!=_iterator2["return"])_iterator2["return"]()}finally{if(lineHeight)throw _iteratorError2;}}return objectInfo}},{key:"renderLayers",value:function(){var _this$state=this.state,startIndices=_this$state.startIndices,numInstances=_this$state.numInstances,getText=_this$state.getText,_this$state$fontAtlas=_this$state.fontAtlasManager,
scale=_this$state$fontAtlas.scale,texture=_this$state$fontAtlas.texture;_this$state$fontAtlas=_this$state$fontAtlas.mapping;_this$state=_this$state.styleVersion;var _this$props2=this.props,data=_this$props2.data,_dataDiff=_this$props2._dataDiff,backgroundColor=_this$props2.backgroundColor,getPosition=_this$props2.getPosition,getColor=_this$props2.getColor,getSize=_this$props2.getSize,getAngle=_this$props2.getAngle,getPixelOffset=_this$props2.getPixelOffset,billboard=_this$props2.billboard,sdf=_this$props2.sdf,
sizeScale=_this$props2.sizeScale,sizeUnits=_this$props2.sizeUnits,sizeMinPixels=_this$props2.sizeMinPixels,sizeMaxPixels=_this$props2.sizeMaxPixels,transitions=_this$props2.transitions;_this$props2=_this$props2.updateTriggers;var getIconOffsets=this.getIconOffsets.bind(this);return new (this.getSubLayerClass("characters",_multiIconLayer["default"]))({sdf:sdf,iconAtlas:texture,iconMapping:_this$state$fontAtlas,backgroundColor:backgroundColor,getPosition:getPosition,getColor:getColor,getSize:getSize,
getAngle:getAngle,getPixelOffset:getPixelOffset,billboard:billboard,sizeScale:sizeScale*scale,sizeUnits:sizeUnits,sizeMinPixels:sizeMinPixels*scale,sizeMaxPixels:sizeMaxPixels*scale,transitions:transitions&&{getPosition:transitions.getPosition,getAngle:transitions.getAngle,getColor:transitions.getColor,getSize:transitions.getSize,getPixelOffset:_this$props2.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getPosition:_this$props2.getPosition,getAngle:_this$props2.getAngle,getColor:_this$props2.getColor,
getSize:_this$props2.getSize,getPixelOffset:_this$props2.getPixelOffset,getIconOffsets:{getText:_this$props2.getText,getTextAnchor:_this$props2.getTextAnchor,getAlignmentBaseline:_this$props2.getAlignmentBaseline,styleVersion:_this$state}}}),{data:data,_dataDiff:_dataDiff,startIndices:startIndices,numInstances:numInstances,getIconOffsets:getIconOffsets,getIcon:getText})}}]);return TextLayer}(_core.CompositeLayer);exports["default"]=global;global.layerName="TextLayer";global.defaultProps=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$layers$dist$es5$text_layer$text_layer.js.map
