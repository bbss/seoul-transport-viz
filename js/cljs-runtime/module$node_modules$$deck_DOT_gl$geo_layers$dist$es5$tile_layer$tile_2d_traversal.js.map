{
"version":3,
"file":"module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_layer$tile_2d_traversal.js",
"lineCount":8,
"mappings":"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",
"sources":["node_modules/@deck_DOT_gl/geo-layers/dist/es5/tile-layer/tile-2d-traversal.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_layer$tile_2d_traversal\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getOSMTileIndices = getOSMTileIndices;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _culling = require(\"@math.gl/culling\");\n\nvar TILE_SIZE = 512;\nvar MAX_MAPS = 3;\n\nvar OSMNode = function () {\n  function OSMNode(x, y, z) {\n    (0, _classCallCheck2[\"default\"])(this, OSMNode);\n    this.x = x;\n    this.y = y;\n    this.z = z;\n  }\n\n  (0, _createClass2[\"default\"])(OSMNode, [{\n    key: \"update\",\n    value: function update(params) {\n      var viewport = params.viewport,\n          cullingVolume = params.cullingVolume,\n          elevationBounds = params.elevationBounds,\n          minZ = params.minZ,\n          maxZ = params.maxZ,\n          offset = params.offset;\n      var boundingVolume = this.getBoundingVolume(elevationBounds, offset);\n      var isInside = cullingVolume.computeVisibility(boundingVolume);\n\n      if (isInside < 0) {\n        return false;\n      }\n\n      if (!this.childVisible) {\n        var z = this.z;\n\n        if (z < maxZ && z >= minZ) {\n          var distance = boundingVolume.distanceTo(viewport.cameraPosition) * viewport.scale / viewport.height;\n          z += Math.floor(Math.log2(distance));\n        }\n\n        if (z >= maxZ) {\n          this.selected = true;\n          return true;\n        }\n      }\n\n      this.selected = false;\n      this.childVisible = true;\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.children[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var child = _step.value;\n          child.update(params);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n            _iterator[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"getSelected\",\n    value: function getSelected() {\n      var result = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n      if (this.selected) {\n        result.push(this);\n      }\n\n      if (this._children) {\n        var _iteratorNormalCompletion2 = true;\n        var _didIteratorError2 = false;\n        var _iteratorError2 = undefined;\n\n        try {\n          for (var _iterator2 = this._children[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n            var node = _step2.value;\n            node.getSelected(result);\n          }\n        } catch (err) {\n          _didIteratorError2 = true;\n          _iteratorError2 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion2 && _iterator2[\"return\"] != null) {\n              _iterator2[\"return\"]();\n            }\n          } finally {\n            if (_didIteratorError2) {\n              throw _iteratorError2;\n            }\n          }\n        }\n      }\n\n      return result;\n    }\n  }, {\n    key: \"getBoundingVolume\",\n    value: function getBoundingVolume(zRange, worldOffset) {\n      var scale = Math.pow(2, this.z);\n      var extent = TILE_SIZE / scale;\n      var originX = this.x * extent + worldOffset * TILE_SIZE;\n      var originY = TILE_SIZE - (this.y + 1) * extent;\n      return new _culling.AxisAlignedBoundingBox([originX, originY, zRange[0]], [originX + extent, originY + extent, zRange[1]]);\n    }\n  }, {\n    key: \"children\",\n    get: function get() {\n      if (!this._children) {\n        var x = this.x * 2;\n        var y = this.y * 2;\n        var z = this.z + 1;\n        this._children = [new OSMNode(x, y, z), new OSMNode(x, y + 1, z), new OSMNode(x + 1, y, z), new OSMNode(x + 1, y + 1, z)];\n      }\n\n      return this._children;\n    }\n  }]);\n  return OSMNode;\n}();\n\nfunction getOSMTileIndices(viewport, maxZ, zRange) {\n  var planes = Object.values(viewport.getFrustumPlanes()).map(function (_ref) {\n    var normal = _ref.normal,\n        distance = _ref.distance;\n    return new _culling.Plane(normal.clone().negate(), distance);\n  });\n  var cullingVolume = new _culling.CullingVolume(planes);\n  var unitsPerMeter = viewport.distanceScales.unitsPerMeter[2];\n  var elevationMin = zRange && zRange[0] * unitsPerMeter || 0;\n  var elevationMax = zRange && zRange[1] * unitsPerMeter || 0;\n  var minZ = viewport.pitch <= 60 ? maxZ : 0;\n  var root = new OSMNode(0, 0, 0);\n  var traversalParams = {\n    viewport: viewport,\n    cullingVolume: cullingVolume,\n    elevationBounds: [elevationMin, elevationMax],\n    minZ: minZ,\n    maxZ: maxZ,\n    offset: 0\n  };\n  root.update(traversalParams);\n\n  if (viewport.subViewports && viewport.subViewports.length > 1) {\n    traversalParams.offset = -1;\n\n    while (root.update(traversalParams)) {\n      if (--traversalParams.offset < -MAX_MAPS) {\n        break;\n      }\n    }\n\n    traversalParams.offset = 1;\n\n    while (root.update(traversalParams)) {\n      if (++traversalParams.offset > MAX_MAPS) {\n        break;\n      }\n    }\n  }\n\n  return root.getSelected();\n}\n//# sourceMappingURL=tile-2d-traversal.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","_interopRequireDefault","Object","defineProperty","value","getOSMTileIndices","viewport","maxZ","zRange","planes","values","getFrustumPlanes","map","_ref","distance","_culling","Plane","normal","clone","negate","cullingVolume","CullingVolume","unitsPerMeter","distanceScales","elevationMin","elevationMax","minZ","pitch","root","OSMNode","traversalParams","elevationBounds","offset","update","subViewports","length","MAX_MAPS","getSelected","_classCallCheck2","_createClass2","x","y","z","key","params","boundingVolume","getBoundingVolume","computeVisibility","isInside","childVisible","distanceTo","cameraPosition","scale","height","Math","floor","log2","selected","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","children","Symbol","iterator","_step","done","next","err","result","arguments","push","_children","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","worldOffset","extent","TILE_SIZE","pow","originX","originY","AxisAlignedBoundingBox","get"]
}
