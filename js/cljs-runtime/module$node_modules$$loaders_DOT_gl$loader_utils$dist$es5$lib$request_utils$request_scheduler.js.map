{
"version":3,
"file":"module$node_modules$$loaders_DOT_gl$loader_utils$dist$es5$lib$request_utils$request_scheduler.js",
"lineCount":8,
"mappings":"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",
"sources":["node_modules/@loaders_DOT_gl/loader-utils/dist/es5/lib/request-utils/request-scheduler.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$loaders_DOT_gl$loader_utils$dist$es5$lib$request_utils$request_scheduler\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _stats = require(\"@probe.gl/stats\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar STAT_QUEUED_REQUESTS = 'Queued Requests';\nvar STAT_ACTIVE_REQUESTS = 'Active Requests';\nvar STAT_CANCELLED_REQUESTS = 'Cancelled Requests';\nvar STAT_QUEUED_REQUESTS_EVER = 'Queued Requests Ever';\nvar STAT_ACTIVE_REQUESTS_EVER = 'Active Requests Ever';\nvar DEFAULT_PROPS = {\n  id: 'request-scheduler',\n  throttleRequests: true,\n  maxRequests: 6\n};\n\nvar RequestScheduler = function () {\n  function RequestScheduler() {\n    var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    (0, _classCallCheck2[\"default\"])(this, RequestScheduler);\n    this.props = _objectSpread(_objectSpread({}, DEFAULT_PROPS), props);\n    this.requestQueue = [];\n    this.activeRequestCount = 0;\n    this.requestMap = new Map();\n    this.stats = new _stats.Stats({\n      id: props.id\n    });\n    this.stats.get(STAT_QUEUED_REQUESTS);\n    this.stats.get(STAT_ACTIVE_REQUESTS);\n    this.stats.get(STAT_CANCELLED_REQUESTS);\n    this.stats.get(STAT_QUEUED_REQUESTS_EVER);\n    this.stats.get(STAT_ACTIVE_REQUESTS_EVER);\n    this._deferredUpdate = null;\n  }\n\n  (0, _createClass2[\"default\"])(RequestScheduler, [{\n    key: \"scheduleRequest\",\n    value: function scheduleRequest(handle) {\n      var getPriority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return 0;\n      };\n\n      if (!this.props.throttleRequests) {\n        return Promise.resolve({\n          done: function done() {}\n        });\n      }\n\n      if (this.requestMap.has(handle)) {\n        return this.requestMap.get(handle);\n      }\n\n      var request = {\n        handle: handle,\n        getPriority: getPriority\n      };\n      var promise = new Promise(function (resolve) {\n        request.resolve = resolve;\n        return request;\n      });\n      this.requestQueue.push(request);\n      this.requestMap.set(handle, promise);\n\n      this._issueNewRequests();\n\n      return promise;\n    }\n  }, {\n    key: \"_issueRequest\",\n    value: function _issueRequest(request) {\n      var _this = this;\n\n      var handle = request.handle,\n          resolve = request.resolve;\n      var isDone = false;\n\n      var done = function done() {\n        if (!isDone) {\n          isDone = true;\n\n          _this.requestMap[\"delete\"](handle);\n\n          _this.activeRequestCount--;\n\n          _this._issueNewRequests();\n        }\n      };\n\n      this.activeRequestCount++;\n      return resolve ? resolve({\n        done: done\n      }) : Promise.resolve({\n        done: done\n      });\n    }\n  }, {\n    key: \"_issueNewRequests\",\n    value: function _issueNewRequests() {\n      var _this2 = this;\n\n      if (!this._deferredUpdate) {\n        this._deferredUpdate = setTimeout(function () {\n          return _this2._issueNewRequestsAsync();\n        }, 0);\n      }\n    }\n  }, {\n    key: \"_issueNewRequestsAsync\",\n    value: function _issueNewRequestsAsync() {\n      this._deferredUpdate = null;\n      var freeSlots = Math.max(this.props.maxRequests - this.activeRequestCount, 0);\n\n      if (freeSlots === 0) {\n        return;\n      }\n\n      this._updateAllRequests();\n\n      for (var i = 0; i < freeSlots; ++i) {\n        if (this.requestQueue.length > 0) {\n          var request = this.requestQueue.shift();\n\n          this._issueRequest(request);\n        }\n      }\n    }\n  }, {\n    key: \"_updateAllRequests\",\n    value: function _updateAllRequests() {\n      var requestQueue = this.requestQueue;\n\n      for (var i = 0; i < requestQueue.length; ++i) {\n        var request = requestQueue[i];\n\n        if (!this._updateRequest(request)) {\n          requestQueue.splice(i, 1);\n          this.requestMap[\"delete\"](request.handle);\n          i--;\n        }\n      }\n\n      requestQueue.sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n    }\n  }, {\n    key: \"_updateRequest\",\n    value: function _updateRequest(request) {\n      request.priority = request.getPriority(request.handle);\n\n      if (request.priority < 0) {\n        request.resolve(null);\n        return false;\n      }\n\n      return true;\n    }\n  }]);\n  return RequestScheduler;\n}();\n\nexports[\"default\"] = RequestScheduler;\n//# sourceMappingURL=request-scheduler.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","_interopRequireDefault","value","_classCallCheck2","_createClass2","_stats","DEFAULT_PROPS","id","throttleRequests","maxRequests","RequestScheduler","props","undefined","requestQueue","activeRequestCount","requestMap","Map","stats","Stats","get","STAT_QUEUED_REQUESTS","STAT_ACTIVE_REQUESTS","STAT_CANCELLED_REQUESTS","STAT_QUEUED_REQUESTS_EVER","STAT_ACTIVE_REQUESTS_EVER","_deferredUpdate","scheduleRequest","handle","getPriority","Promise","resolve","done","has","request","promise","set","_issueNewRequests","_issueRequest","_this","isDone","_this2","setTimeout","_issueNewRequestsAsync","freeSlots","Math","max","_updateAllRequests","shift","_updateRequest","splice","sort","a","b","priority"]
}
