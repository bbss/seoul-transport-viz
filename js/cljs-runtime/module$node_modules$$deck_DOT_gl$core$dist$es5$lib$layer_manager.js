shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$lib$layer_manager=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_assert=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$assert")),
_core=require("module$node_modules$$luma_DOT_gl$core$dist$es5$index"),_layer=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$layer")),_constants=require("module$node_modules$$deck_DOT_gl$core$dist$es5$lifecycle$constants"),_log=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$log")),_debug=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$debug$index")),_flatten=require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$flatten"),_probe=require("module$node_modules$probe_DOT_gl$dist$es5$index"),
_resourceManager=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$resource$resource_manager")),_viewport=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$viewports$viewport")),_shaderlib=require("module$node_modules$$deck_DOT_gl$core$dist$es5$shaderlib$index"),INITIAL_CONTEXT=Object.seal({layerManager:null,resourceManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}}),layerName=function(layer){return layer instanceof
_layer["default"]?"".concat(layer):layer?"invalid":"null"};require=function(){function LayerManager(gl){var _ref=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},deck=_ref.deck,stats=_ref.stats,viewport=_ref.viewport;_ref=_ref.timeline;(0,_classCallCheck2["default"])(this,LayerManager);this.lastRenderedLayers=[];this.layers=[];this.resourceManager=new _resourceManager["default"]({gl:gl,protocol:"deck://"});this.context=Object.assign({},INITIAL_CONTEXT,{layerManager:this,gl:gl,deck:deck,programManager:gl&&
(0,_shaderlib.createProgramManager)(gl),stats:stats||new _probe.Stats({id:"deck.gl"}),viewport:viewport||new _viewport["default"]({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:_ref||new _core.Timeline,resourceManager:this.resourceManager});this._needsRedraw="Initial render";this._debug=this._needsUpdate=!1;this._onError=null;this.activateViewport=this.activateViewport.bind(this);Object.seal(this)}(0,_createClass2["default"])(LayerManager,[{key:"finalize",value:function(){this.resourceManager.finalize();
var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=this.layers[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)this._finalizeLayer(_step.value)}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&null!=_iterator["return"])_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError;}}}},{key:"needsRedraw",value:function(){var opts=0<arguments.length&&
void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},redraw=this._needsRedraw;opts.clearRedrawFlags&&(this._needsRedraw=!1);var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=this.layers[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var layerNeedsRedraw=_step2.value.getNeedsRedraw(opts);redraw=redraw||layerNeedsRedraw}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&
null!=_iterator2["return"])_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2;}}return redraw}},{key:"needsUpdate",value:function(){return this._needsUpdate}},{key:"setNeedsRedraw",value:function(reason){this._needsRedraw=this._needsRedraw||reason}},{key:"setNeedsUpdate",value:function(reason){this._needsUpdate=this._needsUpdate||reason}},{key:"getLayers",value:function(){var _ref2$layerIds=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layerIds,layerIds=void 0===
_ref2$layerIds?null:_ref2$layerIds;return layerIds?this.layers.filter(function(layer){return layerIds.find(function(layerId){return 0===layer.id.indexOf(layerId)})}):this.layers}},{key:"setProps",value:function(props){"debug"in props&&(this._debug=props.debug);"userData"in props&&(this.context.userData=props.userData);"layers"in props&&this.setLayers(props.layers);"onError"in props&&(this._onError=props.onError)}},{key:"setLayers",value:function(newLayers){var shouldUpdate=(1<arguments.length&&void 0!==
arguments[1]?arguments[1]:!1)||newLayers!==this.lastRenderedLayers;(0,_debug["default"])("layerManager.setLayers",this,shouldUpdate,newLayers);if(!shouldUpdate)return this;this.lastRenderedLayers=newLayers;newLayers=(0,_flatten.flatten)(newLayers,Boolean);shouldUpdate=!0;var _didIteratorError3=!1,_iteratorError3=void 0;try{for(var _iterator3=newLayers[Symbol.iterator](),_step3;!(shouldUpdate=(_step3=_iterator3.next()).done);shouldUpdate=!0)_step3.value.context=this.context}catch(err){_didIteratorError3=
!0,_iteratorError3=err}finally{try{if(!shouldUpdate&&null!=_iterator3["return"])_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3;}}this._updateLayers(this.layers,newLayers);return this}},{key:"updateLayers",value:function(){var reason=this.needsUpdate();reason&&(this.setNeedsRedraw("updating layers: ".concat(reason)),this.setLayers(this.lastRenderedLayers,!0))}},{key:"activateViewport",value:function(viewport){(0,_assert["default"])(viewport,"LayerManager: viewport not set");
var oldViewport=this.context.viewport;if(!oldViewport||!viewport.equals(oldViewport)){(0,_debug["default"])("layerManager.activateViewport",this,viewport);this.context.viewport=viewport;viewport={viewportChanged:!0};oldViewport=!0;var _didIteratorError4=!1,_iteratorError4=void 0;try{for(var _iterator4=this.layers[Symbol.iterator](),_step4;!(oldViewport=(_step4=_iterator4.next()).done);oldViewport=!0){var layer=_step4.value;layer.setChangeFlags(viewport);this._updateLayer(layer)}}catch(err){_didIteratorError4=
!0,_iteratorError4=err}finally{try{if(!oldViewport&&null!=_iterator4["return"])_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4;}}}return this}},{key:"_handleError",value:function(stage,error,layer){this._onError?this._onError(error,layer):_log["default"].error("error during ".concat(stage," of ").concat(layerName(layer)),error)()}},{key:"_updateLayers",value:function(oldLayers,newLayers){var oldLayerMap={},_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=
void 0;try{for(var _iterator5=oldLayers[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var oldLayer=_step5.value;oldLayerMap[oldLayer.id]?_log["default"].warn("Multiple old layers with same id ".concat(layerName(oldLayer)))():oldLayerMap[oldLayer.id]=oldLayer}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&null!=_iterator5["return"])_iterator5["return"]()}finally{if(_didIteratorError5)throw _iteratorError5;
}}oldLayers=[];this._updateSublayersRecursively(newLayers,oldLayerMap,oldLayers);this._finalizeOldLayers(oldLayerMap);newLayers=!1;for(oldLayerMap=0;oldLayerMap<oldLayers.length;oldLayerMap++)if(oldLayers[oldLayerMap].hasUniformTransition()){newLayers=!0;break}this._needsUpdate=newLayers;this.layers=oldLayers}},{key:"_updateSublayersRecursively",value:function(newLayers,oldLayerMap,generatedLayers){var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _iterator6=
newLayers[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var newLayer=_step6.value;newLayer.context=this.context;var oldLayer=oldLayerMap[newLayer.id];null===oldLayer&&_log["default"].warn("Multiple new layers with same id ".concat(layerName(newLayer)))();newLayers=oldLayerMap[newLayer.id]=null;try{this._debug&&oldLayer!==newLayer&&newLayer.validateProps(),oldLayer?(this._transferLayerState(oldLayer,newLayer),this._updateLayer(newLayer)):
this._initializeLayer(newLayer),generatedLayers.push(newLayer),newLayers=newLayer.isComposite&&newLayer.getSubLayers()}catch(err){this._handleError("matching",err,newLayer)}newLayers&&this._updateSublayersRecursively(newLayers,oldLayerMap,generatedLayers)}}catch(err$392){_didIteratorError6=!0,_iteratorError6=err$392}finally{try{if(!_iteratorNormalCompletion6&&null!=_iterator6["return"])_iterator6["return"]()}finally{if(_didIteratorError6)throw _iteratorError6;}}}},{key:"_finalizeOldLayers",value:function(oldLayerMap){for(var layerId in oldLayerMap){var layer=
oldLayerMap[layerId];layer&&this._finalizeLayer(layer)}}},{key:"_initializeLayer",value:function(layer){try{layer._initialize(),layer.lifecycle=_constants.LIFECYCLE.INITIALIZED}catch(err){this._handleError("initialization",err,layer)}}},{key:"_transferLayerState",value:function(oldLayer,newLayer){newLayer._transferState(oldLayer);newLayer.lifecycle=_constants.LIFECYCLE.MATCHED;newLayer!==oldLayer&&(oldLayer.lifecycle=_constants.LIFECYCLE.AWAITING_GC)}},{key:"_updateLayer",value:function(layer){try{layer._update()}catch(err){this._handleError("update",
err,layer)}}},{key:"_finalizeLayer",value:function(layer){this._needsRedraw=this._needsRedraw||"finalized ".concat(layerName(layer));layer.lifecycle=_constants.LIFECYCLE.AWAITING_FINALIZATION;try{layer._finalize(),layer.lifecycle=_constants.LIFECYCLE.FINALIZED}catch(err){this._handleError("finalization",err,layer)}}}]);return LayerManager}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$lib$layer_manager.js.map
