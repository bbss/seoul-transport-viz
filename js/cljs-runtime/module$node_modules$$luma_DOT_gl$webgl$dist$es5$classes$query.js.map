{
"version":3,
"file":"module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$query.js",
"lineCount":9,
"mappings":"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",
"sources":["node_modules/@luma_DOT_gl/webgl/dist/es5/classes/query.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$query\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _resource = _interopRequireDefault(require(\"./resource\"));\n\nvar _features = require(\"../features\");\n\nvar _gltools = require(\"@luma.gl/gltools\");\n\nvar _utils = require(\"../utils\");\n\nvar GL_QUERY_RESULT = 0x8866;\nvar GL_QUERY_RESULT_AVAILABLE = 0x8867;\nvar GL_TIME_ELAPSED_EXT = 0x88bf;\nvar GL_GPU_DISJOINT_EXT = 0x8fbb;\nvar GL_TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN = 0x8c88;\nvar GL_ANY_SAMPLES_PASSED = 0x8c2f;\nvar GL_ANY_SAMPLES_PASSED_CONSERVATIVE = 0x8d6a;\n\nvar Query = function (_Resource) {\n  (0, _inherits2[\"default\"])(Query, _Resource);\n  (0, _createClass2[\"default\"])(Query, null, [{\n    key: \"isSupported\",\n    value: function isSupported(gl) {\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n      var webgl2 = (0, _gltools.isWebGL2)(gl);\n      var hasTimerQuery = (0, _features.hasFeatures)(gl, _features.FEATURES.TIMER_QUERY);\n      var supported = webgl2 || hasTimerQuery;\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = opts[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var key = _step.value;\n\n          switch (key) {\n            case 'queries':\n              supported = supported && webgl2;\n              break;\n\n            case 'timers':\n              supported = supported && hasTimerQuery;\n              break;\n\n            default:\n              (0, _utils.assert)(false);\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n            _iterator[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return supported;\n    }\n  }]);\n\n  function Query(gl) {\n    var _this;\n\n    var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    (0, _classCallCheck2[\"default\"])(this, Query);\n    _this = (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(Query).call(this, gl, opts));\n    _this.target = null;\n    _this._queryPending = false;\n    _this._pollingPromise = null;\n    Object.seal((0, _assertThisInitialized2[\"default\"])(_this));\n    return _this;\n  }\n\n  (0, _createClass2[\"default\"])(Query, [{\n    key: \"beginTimeElapsedQuery\",\n    value: function beginTimeElapsedQuery() {\n      return this.begin(GL_TIME_ELAPSED_EXT);\n    }\n  }, {\n    key: \"beginOcclusionQuery\",\n    value: function beginOcclusionQuery() {\n      var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          _ref$conservative = _ref.conservative,\n          conservative = _ref$conservative === void 0 ? false : _ref$conservative;\n\n      return this.begin(conservative ? GL_ANY_SAMPLES_PASSED_CONSERVATIVE : GL_ANY_SAMPLES_PASSED);\n    }\n  }, {\n    key: \"beginTransformFeedbackQuery\",\n    value: function beginTransformFeedbackQuery() {\n      return this.begin(GL_TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN);\n    }\n  }, {\n    key: \"begin\",\n    value: function begin(target) {\n      if (this._queryPending) {\n        return this;\n      }\n\n      this.target = target;\n      this.gl.beginQuery(this.target, this.handle);\n      return this;\n    }\n  }, {\n    key: \"end\",\n    value: function end() {\n      if (this._queryPending) {\n        return this;\n      }\n\n      if (this.target) {\n        this.gl.endQuery(this.target);\n        this.target = null;\n        this._queryPending = true;\n      }\n\n      return this;\n    }\n  }, {\n    key: \"isResultAvailable\",\n    value: function isResultAvailable() {\n      if (!this._queryPending) {\n        return false;\n      }\n\n      var resultAvailable = this.gl.getQueryParameter(this.handle, GL_QUERY_RESULT_AVAILABLE);\n\n      if (resultAvailable) {\n        this._queryPending = false;\n      }\n\n      return resultAvailable;\n    }\n  }, {\n    key: \"isTimerDisjoint\",\n    value: function isTimerDisjoint() {\n      return this.gl.getParameter(GL_GPU_DISJOINT_EXT);\n    }\n  }, {\n    key: \"getResult\",\n    value: function getResult() {\n      return this.gl.getQueryParameter(this.handle, GL_QUERY_RESULT);\n    }\n  }, {\n    key: \"getTimerMilliseconds\",\n    value: function getTimerMilliseconds() {\n      return this.getResult() / 1e6;\n    }\n  }, {\n    key: \"createPoll\",\n    value: function createPoll() {\n      var _this2 = this;\n\n      var limit = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Number.POSITIVE_INFINITY;\n\n      if (this._pollingPromise) {\n        return this._pollingPromise;\n      }\n\n      var counter = 0;\n      this._pollingPromise = new Promise(function (resolve, reject) {\n        var poll = function poll() {\n          if (_this2.isResultAvailable()) {\n            resolve(_this2.getResult());\n            _this2._pollingPromise = null;\n          } else if (counter++ > limit) {\n            reject('Timed out');\n            _this2._pollingPromise = null;\n          } else {\n            requestAnimationFrame(poll);\n          }\n        };\n\n        requestAnimationFrame(poll);\n      });\n      return this._pollingPromise;\n    }\n  }, {\n    key: \"_createHandle\",\n    value: function _createHandle() {\n      return Query.isSupported(this.gl) ? this.gl.createQuery() : null;\n    }\n  }, {\n    key: \"_deleteHandle\",\n    value: function _deleteHandle() {\n      this.gl.deleteQuery(this.handle);\n    }\n  }]);\n  return Query;\n}(_resource[\"default\"]);\n\nexports[\"default\"] = Query;\n//# sourceMappingURL=query.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","_interopRequireDefault","Object","defineProperty","value","_classCallCheck2","_possibleConstructorReturn2","_getPrototypeOf2","_assertThisInitialized2","_createClass2","_inherits2","_resource","_features","_gltools","_utils","Query","_Resource","gl","opts","arguments","length","undefined","_this","call","target","_queryPending","_pollingPromise","seal","key","isSupported","webgl2","isWebGL2","hasTimerQuery","hasFeatures","FEATURES","TIMER_QUERY","supported","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","Symbol","iterator","_step","done","next","assert","err","beginTimeElapsedQuery","begin","GL_TIME_ELAPSED_EXT","beginOcclusionQuery","_ref$conservative","conservative","_ref","GL_ANY_SAMPLES_PASSED_CONSERVATIVE","GL_ANY_SAMPLES_PASSED","beginTransformFeedbackQuery","GL_TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN","beginQuery","handle","end","endQuery","isResultAvailable","resultAvailable","getQueryParameter","GL_QUERY_RESULT_AVAILABLE","isTimerDisjoint","getParameter","GL_GPU_DISJOINT_EXT","getResult","GL_QUERY_RESULT","getTimerMilliseconds","createPoll","_this2","limit","Number","POSITIVE_INFINITY","counter","Promise","resolve","reject","requestAnimationFrame","poll","_createHandle","createQuery","_deleteHandle","deleteQuery"]
}
