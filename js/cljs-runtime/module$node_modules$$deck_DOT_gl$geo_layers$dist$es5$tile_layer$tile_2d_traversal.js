shadow$provide.module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_layer$tile_2d_traversal=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports.getOSMTileIndices=function(viewport,maxZ,zRange){var planes=Object.values(viewport.getFrustumPlanes()).map(function(_ref){var distance=_ref.distance;return new _culling.Plane(_ref.normal.clone().negate(),distance)});planes=
new _culling.CullingVolume(planes);var unitsPerMeter=viewport.distanceScales.unitsPerMeter[2],elevationMin=zRange&&zRange[0]*unitsPerMeter||0;unitsPerMeter=zRange&&zRange[1]*unitsPerMeter||0;var minZ=60>=viewport.pitch?maxZ:0;zRange=new OSMNode(0,0,0);maxZ={viewport:viewport,cullingVolume:planes,elevationBounds:[elevationMin,unitsPerMeter],minZ:minZ,maxZ:maxZ,offset:0};zRange.update(maxZ);if(viewport.subViewports&&1<viewport.subViewports.length){for(maxZ.offset=-1;zRange.update(maxZ)&&!(--maxZ.offset<
-MAX_MAPS););for(maxZ.offset=1;zRange.update(maxZ)&&!(++maxZ.offset>MAX_MAPS););}return zRange.getSelected()};var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_culling=require("module$node_modules$$math_DOT_gl$culling$dist$es5$index"),MAX_MAPS=3,OSMNode=function(){function OSMNode(x,y,z){(0,_classCallCheck2["default"])(this,OSMNode);this.x=x;this.y=y;this.z=z}(0,
_createClass2["default"])(OSMNode,[{key:"update",value:function(params){var viewport=params.viewport,cullingVolume=params.cullingVolume,minZ=params.minZ,maxZ=params.maxZ,boundingVolume=this.getBoundingVolume(params.elevationBounds,params.offset);if(0>cullingVolume.computeVisibility(boundingVolume))return!1;if(!this.childVisible&&(cullingVolume=this.z,cullingVolume<maxZ&&cullingVolume>=minZ&&(viewport=boundingVolume.distanceTo(viewport.cameraPosition)*viewport.scale/viewport.height,cullingVolume+=
Math.floor(Math.log2(viewport))),cullingVolume>=maxZ))return this.selected=!0;this.selected=!1;maxZ=this.childVisible=!0;viewport=!1;minZ=void 0;try{for(var _iterator=this.children[Symbol.iterator](),_step;!(maxZ=(_step=_iterator.next()).done);maxZ=!0)_step.value.update(params)}catch(err){viewport=!0,minZ=err}finally{try{if(!maxZ&&null!=_iterator["return"])_iterator["return"]()}finally{if(viewport)throw minZ;}}return!0}},{key:"getSelected",value:function(){var result=0<arguments.length&&void 0!==
arguments[0]?arguments[0]:[];this.selected&&result.push(this);if(this._children){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=this._children[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0)_step2.value.getSelected(result)}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&null!=_iterator2["return"])_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2;
}}}return result}},{key:"getBoundingVolume",value:function(zRange,worldOffset){var extent=512/Math.pow(2,this.z);worldOffset=this.x*extent+512*worldOffset;var originY=512-(this.y+1)*extent;return new _culling.AxisAlignedBoundingBox([worldOffset,originY,zRange[0]],[worldOffset+extent,originY+extent,zRange[1]])}},{key:"children",get:function(){if(!this._children){var x=2*this.x,y=2*this.y,z=this.z+1;this._children=[new OSMNode(x,y,z),new OSMNode(x,y+1,z),new OSMNode(x+1,y,z),new OSMNode(x+1,y+1,z)]}return this._children}}]);
return OSMNode}()}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_layer$tile_2d_traversal.js.map
