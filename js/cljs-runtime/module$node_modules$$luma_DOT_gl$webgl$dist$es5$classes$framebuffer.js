shadow$provide.module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$framebuffer=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports.FRAMEBUFFER_ATTACHMENT_PARAMETERS=exports["default"]=void 0;var _defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_slicedToArray2=global(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),
_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_possibleConstructorReturn2=global(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),_assertThisInitialized2=global(require("module$node_modules$$babel$runtime$helpers$assertThisInitialized")),_getPrototypeOf2=global(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),_get2=global(require("module$node_modules$$babel$runtime$helpers$get")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),
_inherits2=global(require("module$node_modules$$babel$runtime$helpers$inherits")),_gltools=require("module$node_modules$$luma_DOT_gl$gltools$dist$es5$index");module=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$resource"));var _texture2d=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$texture_2d")),_renderbuffer=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$renderbuffer")),_clear2=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$clear"),
_copyAndBlit=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$copy_and_blit"),_features=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$features$index"),_webglUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$index"),_utils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$utils$index"),Framebuffer=function(_Resource){function Framebuffer$jscomp$0(gl){var opts=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2["default"])(this,
Framebuffer$jscomp$0);var _this=(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(Framebuffer$jscomp$0).call(this,gl,opts));_this.width=null;_this.height=null;_this.attachments={};_this.readBuffer=36064;_this.drawBuffers=[36064];_this.ownResources=[];_this.initialize(opts);Object.seal((0,_assertThisInitialized2["default"])(_this));return _this}(0,_inherits2["default"])(Framebuffer$jscomp$0,_Resource);(0,_createClass2["default"])(Framebuffer$jscomp$0,[{key:"MAX_COLOR_ATTACHMENTS",
get:function(){return this.gl.getParameter(this.gl.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}}],[{key:"isSupported",value:function(gl){var _ref=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},colorBufferHalfFloat=_ref.colorBufferHalfFloat,supported=!0;_ref.colorBufferFloat&&(supported=!!(gl.getExtension("EXT_color_buffer_float")||gl.getExtension("WEBGL_color_buffer_float")||gl.getExtension("OES_texture_float")));
colorBufferHalfFloat&&(supported=supported&&!(!gl.getExtension("EXT_color_buffer_float")&&!gl.getExtension("EXT_color_buffer_half_float")));return supported}},{key:"getDefaultFramebuffer",value:function(gl){gl.luma=gl.luma||{};gl.luma.defaultFramebuffer=gl.luma.defaultFramebuffer||new Framebuffer$jscomp$0(gl,{id:"default-framebuffer",handle:null,attachments:{}});return gl.luma.defaultFramebuffer}}]);(0,_createClass2["default"])(Framebuffer$jscomp$0,[{key:"initialize",value:function(_ref2){var _ref2$width=
_ref2.width;_ref2$width=void 0===_ref2$width?1:_ref2$width;var _ref2$height=_ref2.height;_ref2$height=void 0===_ref2$height?1:_ref2$height;var _ref2$attachments=_ref2.attachments;_ref2$attachments=void 0===_ref2$attachments?null:_ref2$attachments;var _ref2$color=_ref2.color;_ref2$color=void 0===_ref2$color?!0:_ref2$color;var _ref2$depth=_ref2.depth;_ref2$depth=void 0===_ref2$depth?!0:_ref2$depth;var _ref2$stencil=_ref2.stencil;_ref2$stencil=void 0===_ref2$stencil?!1:_ref2$stencil;var _ref2$check=
_ref2.check;_ref2$check=void 0===_ref2$check?!0:_ref2$check;var readBuffer=_ref2.readBuffer;_ref2=_ref2.drawBuffers;(0,_utils.assert)(0<=_ref2$width&&0<=_ref2$height,"Width and height need to be integers");this.width=_ref2$width;this.height=_ref2$height;if(_ref2$attachments)for(var attachment in _ref2$attachments)_ref2$color=_ref2$attachments[attachment],(Array.isArray(_ref2$color)?_ref2$color[0]:_ref2$color).resize({width:_ref2$width,height:_ref2$height});else _ref2$attachments=this._createDefaultAttachments(_ref2$color,
_ref2$depth,_ref2$stencil,_ref2$width,_ref2$height);this.update({clearAttachments:!0,attachments:_ref2$attachments,readBuffer:readBuffer,drawBuffers:_ref2});_ref2$attachments&&_ref2$check&&this.checkStatus()}},{key:"delete",value:function(){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=this.ownResources[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)_step.value["delete"]()}catch(err){_didIteratorError=
!0,_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&null!=_iterator["return"])_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError;}}(0,_get2["default"])((0,_getPrototypeOf2["default"])(Framebuffer$jscomp$0.prototype),"delete",this).call(this)}},{key:"update",value:function(_ref3){var _ref3$attachments=_ref3.attachments,readBuffer=_ref3.readBuffer,drawBuffers=_ref3.drawBuffers,_ref3$clearAttachment=_ref3.clearAttachments;_ref3=_ref3.resizeAttachments;this.attach(void 0===
_ref3$attachments?{}:_ref3$attachments,{clearAttachments:void 0===_ref3$clearAttachment?!1:_ref3$clearAttachment,resizeAttachments:void 0===_ref3?!0:_ref3});_ref3$attachments=this.gl;_ref3$clearAttachment=_ref3$attachments.bindFramebuffer(36160,this.handle);readBuffer&&this._setReadBuffer(readBuffer);drawBuffers&&this._setDrawBuffers(drawBuffers);_ref3$attachments.bindFramebuffer(36160,_ref3$clearAttachment||null);return this}},{key:"resize",value:function(){var _ref4=0<arguments.length&&void 0!==
arguments[0]?arguments[0]:{},width=_ref4.width;_ref4=_ref4.height;if(null===this.handle)return(0,_utils.assert)(void 0===width&&void 0===_ref4),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===width&&(width=this.gl.drawingBufferWidth);void 0===_ref4&&(_ref4=this.gl.drawingBufferHeight);width!==this.width&&_ref4!==this.height&&_gltools.log.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(width,"x").concat(_ref4))();for(var attachmentPoint in this.attachments)this.attachments[attachmentPoint].resize({width:width,
height:_ref4});this.width=width;this.height=_ref4;return this}},{key:"attach",value:function(attachments){var _this2=this,_ref5=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref5$clearAttachment=_ref5.clearAttachments;_ref5=_ref5.resizeAttachments;_ref5=void 0===_ref5?!0:_ref5;var newAttachments={};(void 0===_ref5$clearAttachment?0:_ref5$clearAttachment)&&Object.keys(this.attachments).forEach(function(key){newAttachments[key]=null});Object.assign(newAttachments,attachments);_ref5$clearAttachment=
this.gl.bindFramebuffer(36160,this.handle);for(var key$jscomp$0 in newAttachments){(0,_utils.assert)(void 0!==key$jscomp$0,"Misspelled framebuffer binding point?");var attachment=Number(key$jscomp$0),descriptor=newAttachments[attachment],object=descriptor;if(object)if(object instanceof _renderbuffer["default"])this._attachRenderbuffer({attachment:attachment,renderbuffer:object});else if(Array.isArray(descriptor)){object=(0,_slicedToArray2["default"])(descriptor,3);descriptor=object[0];var _descriptor$=
object[1];_descriptor$=void 0===_descriptor$?0:_descriptor$;object=object[2];var level=void 0===object?0:object;object=descriptor;this._attachTexture({attachment:attachment,texture:descriptor,layer:_descriptor$,level:level})}else this._attachTexture({attachment:attachment,texture:object,layer:0,level:0});else this._unattach(attachment);_ref5&&object&&object.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,_ref5$clearAttachment||null);Object.assign(this.attachments,attachments);
Object.keys(this.attachments).filter(function(key){return!_this2.attachments[key]}).forEach(function(key){delete _this2.attachments[key]})}},{key:"checkStatus",value:function(){var status=this.getStatus();if(36053!==status){var JSCompiler_temp_const=Error;status=(Framebuffer.STATUS||{})[status]||"Framebuffer error ".concat(status);throw new JSCompiler_temp_const(status);}return this}},{key:"getStatus",value:function(){var gl=this.gl,prevHandle=gl.bindFramebuffer(36160,this.handle),status=gl.checkFramebufferStatus(36160);
gl.bindFramebuffer(36160,prevHandle||null);return status}},{key:"clear",value:function(){var _ref6=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},color=_ref6.color,depth=_ref6.depth,stencil=_ref6.stencil;_ref6=_ref6.drawBuffers;_ref6=void 0===_ref6?[]:_ref6;var prevHandle=this.gl.bindFramebuffer(36160,this.handle);(color||depth||stencil)&&(0,_clear2.clear)(this.gl,{color:color,depth:depth,stencil:stencil});_ref6.forEach(function(value,drawBuffer){(0,_clear2.clearBuffer)({drawBuffer:drawBuffer,
value:value})});this.gl.bindFramebuffer(36160,prevHandle||null);return this}},{key:"readPixels",value:function(){_gltools.log.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")();return null}},{key:"readPixelsToBuffer",value:function(){_gltools.log.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")();return null}},{key:"copyToDataUrl",value:function(){_gltools.log.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")();
return null}},{key:"copyToImage",value:function(){_gltools.log.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")();return null}},{key:"copyToTexture",value:function(){_gltools.log.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")();return null}},{key:"blit",value:function(){_gltools.log.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")();return null}},{key:"invalidate",
value:function(_ref7){var _ref7$attachments=_ref7.attachments;_ref7$attachments=void 0===_ref7$attachments?[]:_ref7$attachments;var _ref7$x=_ref7.x;_ref7$x=void 0===_ref7$x?0:_ref7$x;var _ref7$y=_ref7.y;_ref7$y=void 0===_ref7$y?0:_ref7$y;var width=_ref7.width;_ref7=_ref7.height;var gl=this.gl;(0,_webglUtils.assertWebGL2Context)(gl);var prevHandle=gl.bindFramebuffer(36008,this.handle);0===_ref7$x&&0===_ref7$y&&void 0===width&&void 0===_ref7?gl.invalidateFramebuffer(36008,_ref7$attachments):gl.invalidateFramebuffer(36008,
_ref7$attachments,_ref7$x,_ref7$y,width,_ref7);gl.bindFramebuffer(36008,prevHandle);return this}},{key:"getAttachmentParameter",value:function(attachment,pname,keys){var value=this._getAttachmentParameterFallback(pname);null===value&&(this.gl.bindFramebuffer(36160,this.handle),value=this.gl.getFramebufferAttachmentParameter(36160,attachment,pname),this.gl.bindFramebuffer(36160,null));keys&&1E3<value&&(value=(0,_webglUtils.getKey)(this.gl,value));return value}},{key:"getAttachmentParameters",value:function(){var attachment=
0<arguments.length&&void 0!==arguments[0]?arguments[0]:36064,keys=1<arguments.length?arguments[1]:void 0,parameters=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[],values={},_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=parameters[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var pname=_step2.value,key=keys?(0,_webglUtils.getKey)(this.gl,
pname):pname;values[key]=this.getAttachmentParameter(attachment,pname,keys)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&null!=_iterator2["return"])_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2;}}return values}},{key:"getParameters",value:function(){for(var keys=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0,parameters={},_i=0,_attachments=Object.keys(this.attachments);_i<_attachments.length;_i++){var attachment=
Number(_attachments[_i]),key=keys?(0,_webglUtils.getKey)(this.gl,attachment):attachment;parameters[key]=this.getAttachmentParameters(attachment,keys)}return parameters}},{key:"show",value:function(){"undefined"!==typeof window&&window.open((0,_copyAndBlit.copyToDataUrl)(this),"luma-debug-texture");return this}},{key:"log",value:function(){var logLevel=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,message=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(logLevel>_gltools.log.level||
"undefined"===typeof window)return this;message=message||"Framebuffer ".concat(this.id);var image=(0,_copyAndBlit.copyToDataUrl)(this,{maxHeight:100});_gltools.log.image({logLevel:logLevel,message:message,image:image},message)();return this}},{key:"bind",value:function(){var _ref8$target=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).target;this.gl.bindFramebuffer(void 0===_ref8$target?36160:_ref8$target,this.handle);return this}},{key:"unbind",value:function(){var _ref9$target=(0<arguments.length&&
void 0!==arguments[0]?arguments[0]:{}).target;this.gl.bindFramebuffer(void 0===_ref9$target?36160:_ref9$target,null);return this}},{key:"_createDefaultAttachments",value:function(color,depth,stencil,width,height){var defaultAttachments=null;if(color){var _parameters;defaultAttachments=defaultAttachments||{};defaultAttachments[36064]=new _texture2d["default"](this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:width,height:height,mipmaps:!1,parameters:(_parameters={},(0,
_defineProperty2["default"])(_parameters,10241,9729),(0,_defineProperty2["default"])(_parameters,10240,9729),(0,_defineProperty2["default"])(_parameters,10242,33071),(0,_defineProperty2["default"])(_parameters,10243,33071),_parameters)});this.ownResources.push(defaultAttachments[36064])}depth&&stencil?(defaultAttachments=defaultAttachments||{},defaultAttachments[33306]=new _renderbuffer["default"](this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:width,height:111}),this.ownResources.push(defaultAttachments[33306])):
depth?(defaultAttachments=defaultAttachments||{},defaultAttachments[36096]=new _renderbuffer["default"](this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:width,height:height}),this.ownResources.push(defaultAttachments[36096])):stencil&&(0,_utils.assert)(!1);return defaultAttachments}},{key:"_unattach",value:function(attachment){var oldAttachment=this.attachments[attachment];oldAttachment&&(oldAttachment instanceof _renderbuffer["default"]?this.gl.framebufferRenderbuffer(36160,attachment,
36161,null):this.gl.framebufferTexture2D(36160,attachment,3553,null,0),delete this.attachments[attachment])}},{key:"_attachRenderbuffer",value:function(_ref10){var _ref10$attachment=_ref10.attachment;_ref10$attachment=void 0===_ref10$attachment?36064:_ref10$attachment;_ref10=_ref10.renderbuffer;this.gl.framebufferRenderbuffer(36160,_ref10$attachment,36161,_ref10.handle);this.attachments[_ref10$attachment]=_ref10}},{key:"_attachTexture",value:function(_ref11){var _ref11$attachment=_ref11.attachment;
_ref11$attachment=void 0===_ref11$attachment?36064:_ref11$attachment;var texture=_ref11.texture,layer=_ref11.layer;_ref11=_ref11.level;var gl=this.gl;gl.bindTexture(texture.target,texture.handle);switch(texture.target){case 35866:case 32879:gl.framebufferTextureLayer(36160,_ref11$attachment,texture.target,_ref11,layer);break;case 34067:gl.framebufferTexture2D(36160,_ref11$attachment,34069>layer?layer+34069:layer,texture.handle,_ref11);break;case 3553:gl.framebufferTexture2D(36160,_ref11$attachment,
3553,texture.handle,_ref11);break;default:(0,_utils.assert)(!1,"Illegal texture type")}gl.bindTexture(texture.target,null);this.attachments[_ref11$attachment]=texture}},{key:"_setReadBuffer",value:function(readBuffer){var gl=this.gl;(0,_gltools.isWebGL2)(gl)?gl.readBuffer(readBuffer):(0,_utils.assert)(36064===readBuffer||1029===readBuffer,"Multiple render targets not supported");this.readBuffer=readBuffer}},{key:"_setDrawBuffers",value:function(drawBuffers){var gl=this.gl;(0,_gltools.isWebGL2)(gl)?
gl.drawBuffers(drawBuffers):(gl=gl.getExtension("WEBGL.draw_buffers"))?gl.drawBuffersWEBGL(drawBuffers):(0,_utils.assert)(1===drawBuffers.length&&(36064===drawBuffers[0]||1029===drawBuffers[0]),"Multiple render targets not supported");this.drawBuffers=drawBuffers}},{key:"_getAttachmentParameterFallback",value:function(pname){var caps=(0,_features.getFeatures)(this.gl);switch(pname){case 36052:return caps.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return caps.WEBGL2?
null:8;case 33297:return caps.WEBGL2?null:5125;case 33296:return caps.WEBGL2||caps.EXT_sRGB?null:9729;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(handle){return this.gl.bindFramebuffer(36160,handle)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},
{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}}]);return Framebuffer$jscomp$0}(module["default"]);exports["default"]=Framebuffer;require=[36049,36048,33296,33298,33299,33300,33301,33302,33303];exports.FRAMEBUFFER_ATTACHMENT_PARAMETERS=require;Framebuffer.ATTACHMENT_PARAMETERS=require}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$framebuffer.js.map
