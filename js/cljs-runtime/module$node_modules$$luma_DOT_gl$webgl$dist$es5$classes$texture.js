shadow$provide.module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$texture=function(global,require,module,exports){module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=module(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_possibleConstructorReturn2=module(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),_getPrototypeOf2=
module(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),_createClass2=module(require("module$node_modules$$babel$runtime$helpers$createClass")),_inherits2=module(require("module$node_modules$$babel$runtime$helpers$inherits"));global=module(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$resource"));var _buffer=module(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$buffer")),_textureFormats=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$texture_formats"),
_gltools=require("module$node_modules$$luma_DOT_gl$gltools$dist$es5$index");module=require("module$node_modules$probe_DOT_gl$env");var _webglUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$index"),_utils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$utils$index"),NPOT_MIN_FILTERS=[9729,9728],WebGLBuffer=module.global.WebGLBuffer||function(){};require=function(_Resource){function Texture(gl,props){(0,_classCallCheck2["default"])(this,Texture);var _props$id=props.id;
_props$id=void 0===_props$id?(0,_utils.uid)("texture"):_props$id;var handle=props.handle;props=props.target;gl=(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(Texture).call(this,gl,{id:_props$id,handle:handle}));gl.target=props;gl.textureUnit=void 0;gl.loaded=!1;gl.width=void 0;gl.height=void 0;gl.depth=void 0;gl.format=void 0;gl.type=void 0;gl.dataFormat=void 0;gl.border=void 0;gl.textureUnit=void 0;gl.mipmaps=void 0;return gl}(0,_inherits2["default"])(Texture,_Resource);
(0,_createClass2["default"])(Texture,null,[{key:"isSupported",value:function(gl){var _ref=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},format=_ref.format;_ref=_ref.linearFiltering;var supported=!0;format&&(supported=(supported=supported&&(0,_textureFormats.isFormatSupported)(gl,format))&&(!_ref||(0,_textureFormats.isLinearFilteringSupported)(gl,format)));return supported}}]);(0,_createClass2["default"])(Texture,[{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,
"x").concat(this.height,")")}},{key:"initialize",value:function(){var _this2=this,props=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},data=props.data;if(data instanceof Promise)return data.then(function(resolvedImageData){return _this2.initialize(Object.assign({},props,{pixels:resolvedImageData,data:resolvedImageData}))}),this;var _props$pixels=props.pixels,_props$format=props.format;_props$format=void 0===_props$format?6408:_props$format;var _props$border=props.border;_props$border=void 0===
_props$border?0:_props$border;var _props$recreate=props.recreate;_props$recreate=void 0===_props$recreate?!1:_props$recreate;var _props$parameters=props.parameters;_props$parameters=void 0===_props$parameters?{}:_props$parameters;var _props$pixelStore=props.pixelStore;_props$pixelStore=void 0===_props$pixelStore?{}:_props$pixelStore;var _props$textureUnit=props.textureUnit;_props$textureUnit=void 0===_props$textureUnit?void 0:_props$textureUnit;var _props$mipmaps=props.mipmaps;_props$mipmaps=void 0===
_props$mipmaps?!0:_props$mipmaps;data||(data=void 0===_props$pixels?null:_props$pixels);_props$pixels=props.width;var height=props.height,dataFormat=props.dataFormat,type=props.type,_props$depth=props.depth;_props$depth=void 0===_props$depth?0:_props$depth;type=this._deduceParameters({format:_props$format,type:type,dataFormat:dataFormat,compressed:!1,data:data,width:_props$pixels,height:height});_props$pixels=type.width;height=type.height;dataFormat=type.dataFormat;type=type.type;this.width=_props$pixels;
this.height=height;this.depth=_props$depth;this.format=_props$format;this.type=type;this.dataFormat=dataFormat;this.border=_props$border;this.textureUnit=_props$textureUnit;Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle));_props$mipmaps&&this._isNPOT()&&(_gltools.log.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),_props$mipmaps=!1,this._updateForNPOT(_props$parameters));this.mipmaps=_props$mipmaps;
this.setImageData({data:data,width:_props$pixels,height:height,depth:_props$depth,format:_props$format,type:type,dataFormat:dataFormat,border:_props$border,mipmaps:_props$mipmaps,parameters:_props$pixelStore});_props$mipmaps&&this.generateMipmap();this.setParameters(_props$parameters);_props$recreate&&(this.data=data);return this}},{key:"resize",value:function(_ref2){var height=_ref2.height,width=_ref2.width;_ref2=_ref2.mipmaps;return width!==this.width||height!==this.height?this.initialize({width:width,
height:height,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:void 0===_ref2?!1:_ref2}):this}},{key:"generateMipmap",value:function(){var _this3=this,params=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(this._isNPOT())return _gltools.log.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this;this.mipmaps=!0;this.gl.bindTexture(this.target,this.handle);(0,_gltools.withParameters)(this.gl,params,function(){_this3.gl.generateMipmap(_this3.target)});
this.gl.bindTexture(this.target,null);return this}},{key:"setImageData",value:function(options){this._trackDeallocatedMemory("Texture");var _options$target=options.target,target=void 0===_options$target?this.target:_options$target;_options$target=options.pixels;var _options$level=options.level,level=void 0===_options$level?0:_options$level;_options$level=options.format;var format=void 0===_options$level?this.format:_options$level;_options$level=options.border;var border=void 0===_options$level?this.border:
_options$level;_options$level=options.offset;var offset=void 0===_options$level?0:_options$level;_options$level=options.parameters;_options$level=void 0===_options$level?{}:_options$level;var _options$data=options.data,data=void 0===_options$data?null:_options$data;_options$data=options.type;var type=void 0===_options$data?this.type:_options$data;_options$data=options.width;var width=void 0===_options$data?this.width:_options$data;_options$data=options.height;var height=void 0===_options$data?this.height:
_options$data;_options$data=options.dataFormat;var dataFormat=void 0===_options$data?this.dataFormat:_options$data;options=options.compressed;data||(data=void 0===_options$target?null:_options$target);_options$target=this._deduceParameters({format:format,type:type,dataFormat:dataFormat,compressed:void 0===options?!1:options,data:data,width:width,height:height});type=_options$target.type;dataFormat=_options$target.dataFormat;options=_options$target.compressed;width=_options$target.width;height=_options$target.height;
var gl=this.gl;gl.bindTexture(this.target,this.handle);var dataType=null;options=this._getDataType({data:data,compressed:options});data=options.data;dataType=options.dataType;(0,_gltools.withParameters)(this.gl,_options$level,function(){switch(dataType){case "null":gl.texImage2D(target,level,format,width,height,border,dataFormat,type,data);break;case "typed-array":gl.texImage2D(target,level,format,width,height,border,dataFormat,type,data,offset);break;case "buffer":(0,_webglUtils.assertWebGL2Context)(gl);
gl.bindBuffer(35052,data.handle||data);gl.texImage2D(target,level,format,width,height,border,dataFormat,type,offset);gl.bindBuffer(35052,null);break;case "browser-object":(0,_gltools.isWebGL2)(gl)?gl.texImage2D(target,level,format,width,height,border,dataFormat,type,data):gl.texImage2D(target,level,format,dataFormat,type,data);break;case "compressed":gl.compressedTexImage2D(target,level,format,width,height,border,data);break;default:(0,_utils.assert)(!1,"Unknown image data type")}});data&&data.byteLength?
this._trackAllocatedMemory(data.byteLength,"Texture"):this._trackAllocatedMemory(this.width*this.height*(_textureFormats.DATA_FORMAT_CHANNELS[this.dataFormat]||4)*(_textureFormats.TYPE_SIZES[this.type]||1),"Texture");this.loaded=!0;return this}},{key:"setSubImageData",value:function(_ref3){var _this4=this,_ref3$target=_ref3.target,target=void 0===_ref3$target?this.target:_ref3$target;_ref3$target=_ref3.pixels;_ref3$target=void 0===_ref3$target?null:_ref3$target;var _ref3$data=_ref3.data,data=void 0===
_ref3$data?null:_ref3$data;_ref3$data=_ref3.x;var x=void 0===_ref3$data?0:_ref3$data;_ref3$data=_ref3.y;var y=void 0===_ref3$data?0:_ref3$data;_ref3$data=_ref3.width;var width=void 0===_ref3$data?this.width:_ref3$data;_ref3$data=_ref3.height;var height=void 0===_ref3$data?this.height:_ref3$data;_ref3$data=_ref3.level;var level=void 0===_ref3$data?0:_ref3$data;_ref3$data=_ref3.format;var format=void 0===_ref3$data?this.format:_ref3$data;_ref3$data=_ref3.type;var type=void 0===_ref3$data?this.type:
_ref3$data;_ref3$data=_ref3.dataFormat;var dataFormat=void 0===_ref3$data?this.dataFormat:_ref3$data;_ref3$data=_ref3.compressed;var compressed=void 0===_ref3$data?!1:_ref3$data;_ref3$data=_ref3.offset;var offset=void 0===_ref3$data?0:_ref3$data;_ref3=_ref3.parameters;_ref3=void 0===_ref3?{}:_ref3;_ref3$data=this._deduceParameters({format:format,type:type,dataFormat:dataFormat,compressed:compressed,data:data,width:width,height:height});type=_ref3$data.type;dataFormat=_ref3$data.dataFormat;compressed=
_ref3$data.compressed;width=_ref3$data.width;height=_ref3$data.height;(0,_utils.assert)(0===this.depth,"texSubImage not supported for 3D textures");data||(data=_ref3$target);data&&data.data&&(_ref3$target=data,data=_ref3$target.data,width=_ref3$target.shape[0],height=_ref3$target.shape[1]);data instanceof _buffer["default"]&&(data=data.handle);this.gl.bindTexture(this.target,this.handle);(0,_gltools.withParameters)(this.gl,_ref3,function(){compressed?_this4.gl.compressedTexSubImage2D(target,level,
x,y,width,height,format,data):null===data?_this4.gl.texSubImage2D(target,level,x,y,width,height,dataFormat,type,null):ArrayBuffer.isView(data)?_this4.gl.texSubImage2D(target,level,x,y,width,height,dataFormat,type,data,offset):data instanceof WebGLBuffer?((0,_webglUtils.assertWebGL2Context)(_this4.gl),_this4.gl.bindBuffer(35052,data),_this4.gl.texSubImage2D(target,level,x,y,width,height,dataFormat,type,offset),_this4.gl.bindBuffer(35052,null)):(0,_gltools.isWebGL2)(_this4.gl)?_this4.gl.texSubImage2D(target,
level,x,y,width,height,dataFormat,type,data):_this4.gl.texSubImage2D(target,level,x,y,dataFormat,type,data)});this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(){_gltools.log.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")();return null}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}},{key:"bind",value:function(){var textureUnit=0<arguments.length&&void 0!==arguments[0]?arguments[0]:
this.textureUnit,gl=this.gl;void 0!==textureUnit&&(this.textureUnit=textureUnit,gl.activeTexture(33984+textureUnit));gl.bindTexture(this.target,this.handle);return textureUnit}},{key:"unbind",value:function(){var textureUnit=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.textureUnit,gl=this.gl;void 0!==textureUnit&&(this.textureUnit=textureUnit,gl.activeTexture(33984+textureUnit));gl.bindTexture(this.target,null);return textureUnit}},{key:"_getDataType",value:function(_ref4){var data=
_ref4.data;_ref4=_ref4.compressed;return(void 0===_ref4?0:_ref4)?{data:data,dataType:"compressed"}:null===data?{data:data,dataType:"null"}:ArrayBuffer.isView(data)?{data:data,dataType:"typed-array"}:data instanceof _buffer["default"]?{data:data.handle,dataType:"buffer"}:data instanceof WebGLBuffer?{data:data,dataType:"buffer"}:{data:data,dataType:"browser-object"}}},{key:"_deduceParameters",value:function(opts){var format=opts.format,data=opts.data,width=opts.width,height=opts.height,dataFormat=opts.dataFormat,
type=opts.type;opts=opts.compressed;var textureFormat=_textureFormats.TEXTURE_FORMATS[format];dataFormat=dataFormat||textureFormat&&textureFormat.dataFormat;type=type||textureFormat&&textureFormat.types[0];opts=opts||textureFormat&&textureFormat.compressed;height=this._deduceImageSize(data,width,height);width=height.width;height=height.height;return{dataFormat:dataFormat,type:type,compressed:opts,width:width,height:height,format:format,data:data}}},{key:"_deduceImageSize",value:function(data,width,
height){data="undefined"!==typeof ImageData&&data instanceof ImageData?{width:data.width,height:data.height}:"undefined"!==typeof HTMLImageElement&&data instanceof HTMLImageElement?{width:data.naturalWidth,height:data.naturalHeight}:"undefined"!==typeof HTMLCanvasElement&&data instanceof HTMLCanvasElement?{width:data.width,height:data.height}:"undefined"!==typeof ImageBitmap&&data instanceof ImageBitmap?{width:data.width,height:data.height}:"undefined"!==typeof HTMLVideoElement&&data instanceof HTMLVideoElement?
{width:data.videoWidth,height:data.videoHeight}:data?{width:width,height:height}:{width:0<=width?width:1,height:0<=height?height:1};(0,_utils.assert)(data,"Could not deduced texture size");(0,_utils.assert)(void 0===width||data.width===width,"Deduced texture width does not match supplied width");(0,_utils.assert)(void 0===height||data.height===height,"Deduced texture height does not match supplied height");return data}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",
value:function(){this.gl.deleteTexture(this.handle);this._trackDeallocatedMemory("Texture")}},{key:"_getParameter",value:function(pname){switch(pname){case 4096:return this.width;case 4097:return this.height;default:return this.gl.bindTexture(this.target,this.handle),pname=this.gl.getTexParameter(this.target,pname),this.gl.bindTexture(this.target,null),pname}}},{key:"_setParameter",value:function(pname,param){this.gl.bindTexture(this.target,this.handle);param=this._getNPOTParam(pname,param);switch(pname){case 33082:case 33083:this.gl.texParameterf(this.handle,
pname,param);break;case 4096:case 4097:(0,_utils.assert)(!1);break;default:this.gl.texParameteri(this.target,pname,param)}this.gl.bindTexture(this.target,null);return this}},{key:"_isNPOT",value:function(){return!(0,_gltools.isWebGL2)(this.gl)&&this.width&&this.height?!(0,_utils.isPowerOfTwo)(this.width)||!(0,_utils.isPowerOfTwo)(this.height):!1}},{key:"_updateForNPOT",value:function(parameters){void 0===parameters[this.gl.TEXTURE_MIN_FILTER]&&(parameters[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR);
void 0===parameters[this.gl.TEXTURE_WRAP_S]&&(parameters[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE);void 0===parameters[this.gl.TEXTURE_WRAP_T]&&(parameters[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(pname,param){if(this._isNPOT())switch(pname){case 10241:-1===NPOT_MIN_FILTERS.indexOf(param)&&(param=9729);break;case 10242:case 10243:33071!==param&&(param=33071)}return param}}]);return Texture}(global["default"]);exports["default"]=require}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$texture.js.map
