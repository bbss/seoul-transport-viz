{
"version":3,
"file":"module$node_modules$$loaders_DOT_gl$core$dist$es5$worker_utils$worker_pool.js",
"lineCount":6,
"mappings":"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",
"sources":["node_modules/@loaders_DOT_gl/core/dist/es5/worker-utils/worker-pool.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$loaders_DOT_gl$core$dist$es5$worker_utils$worker_pool\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _workerThread = _interopRequireDefault(require(\"./worker-thread\"));\n\nvar WorkerPool = function () {\n  function WorkerPool(_ref) {\n    var source = _ref.source,\n        _ref$name = _ref.name,\n        name = _ref$name === void 0 ? 'unnamed' : _ref$name,\n        _ref$maxConcurrency = _ref.maxConcurrency,\n        maxConcurrency = _ref$maxConcurrency === void 0 ? 1 : _ref$maxConcurrency,\n        onMessage = _ref.onMessage,\n        _ref$onDebug = _ref.onDebug,\n        onDebug = _ref$onDebug === void 0 ? function () {} : _ref$onDebug;\n    (0, _classCallCheck2[\"default\"])(this, WorkerPool);\n    this.source = source;\n    this.name = name;\n    this.maxConcurrency = maxConcurrency;\n    this.onMessage = onMessage;\n    this.onDebug = onDebug;\n    this.jobQueue = [];\n    this.idleQueue = [];\n    this.count = 0;\n    this.isDestroyed = false;\n  }\n\n  (0, _createClass2[\"default\"])(WorkerPool, [{\n    key: \"destroy\",\n    value: function destroy() {\n      this.idleQueue.forEach(function (worker) {\n        return worker.destroy();\n      });\n      this.isDestroyed = true;\n    }\n  }, {\n    key: \"process\",\n    value: function () {\n      var _process = (0, _asyncToGenerator2[\"default\"])(_regenerator[\"default\"].mark(function _callee(data, jobName) {\n        var _this = this;\n\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                return _context.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  _this.jobQueue.push({\n                    data: data,\n                    jobName: jobName,\n                    resolve: resolve,\n                    reject: reject\n                  });\n\n                  _this._startQueuedJob();\n                }));\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function process(_x, _x2) {\n        return _process.apply(this, arguments);\n      }\n\n      return process;\n    }()\n  }, {\n    key: \"_startQueuedJob\",\n    value: function _startQueuedJob() {\n      var _this2 = this;\n\n      if (!this.jobQueue.length) {\n        return;\n      }\n\n      var worker = this._getAvailableWorker();\n\n      if (!worker) {\n        return;\n      }\n\n      var job = this.jobQueue.shift();\n      this.onDebug({\n        message: 'processing',\n        worker: worker.name,\n        job: job.jobName,\n        backlog: this.jobQueue.length\n      });\n      worker.process(job.data).then(function (result) {\n        return job.resolve(result);\n      })[\"catch\"](function (error) {\n        return job.reject(error);\n      }).then(function () {\n        return _this2._onWorkerDone(worker);\n      });\n    }\n  }, {\n    key: \"_onWorkerDone\",\n    value: function _onWorkerDone(worker) {\n      if (this.isDestroyed) {\n        worker.destroy();\n      } else {\n        this.idleQueue.push(worker);\n\n        this._startQueuedJob();\n      }\n    }\n  }, {\n    key: \"_getAvailableWorker\",\n    value: function _getAvailableWorker() {\n      if (this.idleQueue.length > 0) {\n        return this.idleQueue.shift();\n      }\n\n      if (this.count < this.maxConcurrency) {\n        this.count++;\n        var name = \"\".concat(this.name.toLowerCase(), \" (#\").concat(this.count, \" of \").concat(this.maxConcurrency, \")\");\n        return new _workerThread[\"default\"]({\n          source: this.source,\n          onMessage: this.onMessage,\n          name: name\n        });\n      }\n\n      return null;\n    }\n  }]);\n  return WorkerPool;\n}();\n\nexports[\"default\"] = WorkerPool;\n//# sourceMappingURL=worker-pool.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","_interopRequireDefault","Object","defineProperty","value","_regenerator","_asyncToGenerator2","_classCallCheck2","_createClass2","_workerThread","WorkerPool","_ref","source","_ref$name","name","_ref$maxConcurrency","maxConcurrency","onMessage","_ref$onDebug","onDebug","jobQueue","idleQueue","count","isDestroyed","key","destroy","forEach","worker","_process","mark","_callee","data","jobName","_this","wrap","_callee$","_context","prev","next","abrupt","Promise","resolve","reject","push","_startQueuedJob","stop","process","_x","_x2","apply","arguments","_this2","length","_getAvailableWorker","job","shift","message","backlog","then","result","error","_onWorkerDone","concat","toLowerCase"]
}
