shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$passes$layers_pass=function(global,require,module,exports){function layerIndexResolver(){var startIndex=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,layerIndices=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},resolvers={};return function(layer,isDrawn){var indexOverride=layer.props._offset,layerId=layer.id,parentId=layer.parent&&layer.parent.id;parentId in resolvers?(indexOverride=resolvers[parentId]=resolvers[parentId]||
layerIndexResolver(layerIndices[parentId],layerIndices),layer=indexOverride(layer,isDrawn),resolvers[layerId]=indexOverride):Number.isFinite(indexOverride)?(layer=indexOverride+(layerIndices[parentId]||0),resolvers[layerId]=null):layer=startIndex;isDrawn&&layer>=startIndex&&(startIndex=layer+1);return layerIndices[layerId]=layer}}function getGLViewport(gl,_ref2){var height=gl.canvas?gl.canvas.clientHeight||gl.canvas.height:100;_ref2=_ref2.viewport;gl=(0,_core.cssToDeviceRatio)(gl);return[_ref2.x*
gl,(height-_ref2.y-_ref2.height)*gl,_ref2.width*gl,_ref2.height*gl]}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports.layerIndexResolver=layerIndexResolver;exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_possibleConstructorReturn2=global(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),
_getPrototypeOf2=global(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),_inherits2=global(require("module$node_modules$$babel$runtime$helpers$inherits"));module=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$passes$pass"));var _core=require("module$node_modules$$luma_DOT_gl$core$dist$es5$index"),_log=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$log"));require=function(_Pass){function LayersPass(){(0,_classCallCheck2["default"])(this,LayersPass);
return(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(LayersPass).apply(this,arguments))}(0,_inherits2["default"])(LayersPass,_Pass);(0,_createClass2["default"])(LayersPass,[{key:"render",value:function(props){var gl=this.gl;(0,_core.setParameters)(gl,{framebuffer:props.target});return this._drawLayers(props)}},{key:"_drawLayers",value:function(props){var viewports=props.viewports,views=props.views,onViewportActive=props.onViewportActive,_props$clearCanvas=props.clearCanvas,
gl=this.gl;if(void 0===_props$clearCanvas||_props$clearCanvas){_props$clearCanvas=gl.drawingBufferWidth;var height=gl.drawingBufferHeight;(0,_core.setParameters)(gl,{viewport:[0,0,_props$clearCanvas,height]});gl.clear(16640)}_props$clearCanvas=[];height=!0;var _didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=viewports[Symbol.iterator](),_step;!(height=(_step=_iterator.next()).done);height=!0){var viewportOrDescriptor=_step.value,viewport=viewportOrDescriptor.viewport||viewportOrDescriptor,
view=views&&views[viewport.id];onViewportActive(viewport);props.view=view;var subViewports=viewport.subViewports||[viewport];viewports=!0;var _didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=subViewports[Symbol.iterator](),_step2;!(viewports=(_step2=_iterator2.next()).done);viewports=!0){props.viewport=_step2.value;var stats=this._drawLayersInViewport(gl,props);_props$clearCanvas.push(stats)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{if(!viewports&&null!=
_iterator2["return"])_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2;}}}}catch(err$389){_didIteratorError=!0,_iteratorError=err$389}finally{try{if(!height&&null!=_iterator["return"])_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError;}}return _props$clearCanvas}},{key:"_drawLayersInViewport",value:function(gl,_ref){var layers=_ref.layers,layerFilter=_ref.layerFilter,onError=_ref.onError,viewport=_ref.viewport,view=_ref.view,_ref$pass=_ref.pass;_ref$pass=
void 0===_ref$pass?"unknown":_ref$pass;var effects=_ref.effects;_ref=_ref.moduleParameters;var glViewport=getGLViewport(gl,{viewport:viewport});if(view&&view.props.clear){var clearOpts=!0===view.props.clear?{color:!0,depth:!0}:view.props.clear;(0,_core.withParameters)(gl,{scissorTest:!0,scissor:glViewport},function(){return(0,_core.clear)(gl,clearOpts)})}view={totalCount:layers.length,visibleCount:0,compositeCount:0,pickableCount:0};(0,_core.setParameters)(gl,{viewport:glViewport});glViewport=layerIndexResolver();
for(var layerIndex=0;layerIndex<layers.length;layerIndex++){var layer=layers[layerIndex],shouldDrawLayer=this._shouldDrawLayer(layer,viewport,_ref$pass,layerFilter),layerRenderIndex=glViewport(layer,shouldDrawLayer);shouldDrawLayer&&layer.props.pickable&&view.pickableCount++;layer.isComposite&&view.compositeCount++;if(shouldDrawLayer){view.visibleCount++;shouldDrawLayer=this._getModuleParameters(layer,effects,_ref$pass,_ref);var layerParameters=this.getLayerParameters(layer,layerIndex);shouldDrawLayer.viewport=
viewport;try{layer.drawLayer({moduleParameters:shouldDrawLayer,uniforms:{layerIndex:layerRenderIndex},parameters:layerParameters})}catch(err){onError?onError(err,layer):_log["default"].error("error during drawing of ".concat(layer),err)()}}}return view}},{key:"shouldDrawLayer",value:function(layer){return!0}},{key:"getModuleParameters",value:function(layer,effects){return null}},{key:"getLayerParameters",value:function(layer,layerIndex){return layer.props.parameters}},{key:"_shouldDrawLayer",value:function(layer,
viewport,pass,layerFilter){var shouldDrawLayer=this.shouldDrawLayer(layer)&&!layer.isComposite&&layer.props.visible;shouldDrawLayer&&layerFilter&&(shouldDrawLayer=layerFilter({layer:layer,viewport:viewport,isPicking:pass.startsWith("picking"),renderPass:pass}));return shouldDrawLayer}},{key:"_getModuleParameters",value:function(layer,effects,pass,overrides){pass=Object.assign(Object.create(layer.props),{autoWrapLongitude:layer.wrapLongitude,viewport:layer.context.viewport,mousePosition:layer.context.mousePosition,
pickingActive:0,devicePixelRatio:(0,_core.cssToDeviceRatio)(this.gl)});if(effects){var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _iterator3=effects[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0)Object.assign(pass,_step3.value.getModuleParameters(layer))}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&null!=_iterator3["return"])_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3;
}}}return Object.assign(pass,this.getModuleParameters(layer,effects),overrides)}}]);return LayersPass}(module["default"]);exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$passes$layers_pass.js.map
