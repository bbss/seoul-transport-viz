shadow$provide.module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$transform=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_shadertools=require("module$node_modules$$luma_DOT_gl$shadertools$dist$es5$index"),
_bufferTransform=global(require("module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$buffer_transform")),_textureTransform=global(require("module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$texture_transform")),_gltools=require("module$node_modules$$luma_DOT_gl$gltools$dist$es5$index"),_webgl=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$index"),_model=global(require("module$node_modules$$luma_DOT_gl$engine$dist$es5$lib$model"));require=function(){function Transform(gl){var props=
1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2["default"])(this,Transform);this.gl=gl;this.model=null;this.elementCount=0;this.elementIDBuffer=this.textureTransform=this.bufferTransform=null;this._initialize(props);Object.seal(this)}(0,_createClass2["default"])(Transform,null,[{key:"isSupported",value:function(gl){return(0,_gltools.isWebGL2)(gl)}}]);(0,_createClass2["default"])(Transform,[{key:"delete",value:function(){var model=this.model,bufferTransform=this.bufferTransform,
textureTransform=this.textureTransform;if(model)model["delete"]();if(bufferTransform)bufferTransform["delete"]();if(textureTransform)textureTransform["delete"]()}},{key:"run",value:function(){var opts=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},_opts$clearRenderTarg=opts.clearRenderTarget;_opts$clearRenderTarg=void 0===_opts$clearRenderTarg?!0:_opts$clearRenderTarg;opts=this._updateDrawOptions(opts);_opts$clearRenderTarg&&opts.framebuffer&&opts.framebuffer.clear({color:!0});this.model.transform(opts)}},
{key:"swap",value:function(){var swapped=!1,resourceTransforms=[this.bufferTransform,this.textureTransform].filter(Boolean),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=resourceTransforms[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var resourceTransform=_step.value;swapped=swapped||resourceTransform.swap()}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&
null!=_iterator["return"])_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError;}}(0,_webgl.assert)(swapped,"Nothing to swap")}},{key:"getBuffer",value:function(){var varyingName=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(varyingName)}},{key:"getData",value:function(){var opts=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},resourceTransforms=[this.bufferTransform,this.textureTransform].filter(Boolean),
_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=resourceTransforms[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var data=_step2.value.getData(opts);if(data)return data}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&null!=_iterator2["return"])_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2;}}return null}},
{key:"getFramebuffer",value:function(){return this.textureTransform&&this.textureTransform.getFramebuffer()}},{key:"update",value:function(){var opts=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};"elementCount"in opts&&this.model.setVertexCount(opts.elementCount);var resourceTransforms=[this.bufferTransform,this.textureTransform].filter(Boolean),_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _iterator3=resourceTransforms[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=
(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0)_step3.value.update(opts)}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&null!=_iterator3["return"])_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3;}}}},{key:"_initialize",value:function(){var props=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},gl=this.gl;this._buildResourceTransforms(gl,props);props=this._updateModelProps(props);this.model=new _model["default"](gl,
Object.assign({},props,{fs:props.fs||(0,_shadertools.getPassthroughFS)({version:(0,_webgl.getShaderVersion)(props.vs)}),id:props.id||"transform-model",drawMode:props.drawMode||0,vertexCount:props.elementCount}));this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}},{key:"_updateModelProps",value:function(props){props=Object.assign({},props);var resourceTransforms=[this.bufferTransform,this.textureTransform].filter(Boolean),_iteratorNormalCompletion4=!0,_didIteratorError4=
!1,_iteratorError4=void 0;try{for(var _iterator4=resourceTransforms[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0)props=_step4.value.updateModelProps(props)}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&null!=_iterator4["return"])_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4;}}return props}},{key:"_buildResourceTransforms",value:function(gl,props){var JSCompiler_inline_result=
!(0,_webgl.isObjectEmpty)(props.feedbackBuffers)||!(0,_webgl.isObjectEmpty)(props.feedbackMap)||props.varyings&&0<props.varyings.length?!0:!1;JSCompiler_inline_result&&(this.bufferTransform=new _bufferTransform["default"](gl,props));JSCompiler_inline_result=!(0,_webgl.isObjectEmpty)(props._sourceTextures)||props._targetTexture||props._targetTextureVarying?!0:!1;JSCompiler_inline_result&&(this.textureTransform=new _textureTransform["default"](gl,props));(0,_webgl.assert)(this.bufferTransform||this.textureTransform,
"must provide source/feedback buffers or source/target textures")}},{key:"_updateDrawOptions",value:function(opts){opts=Object.assign({},opts);var resourceTransforms=[this.bufferTransform,this.textureTransform].filter(Boolean),_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _iterator5=resourceTransforms[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0)opts=Object.assign(opts,_step5.value.getDrawOptions(opts))}catch(err){_didIteratorError5=
!0,_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&null!=_iterator5["return"])_iterator5["return"]()}finally{if(_didIteratorError5)throw _iteratorError5;}}return opts}}]);return Transform}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$transform.js.map
