shadow$provide.module$node_modules$$deck_DOT_gl$aggregation_layers$dist$es5$utils$bin_sorter=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _slicedToArray2=global(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=
global(require("module$node_modules$$babel$runtime$helpers$createClass")),_scaleUtils=require("module$node_modules$$deck_DOT_gl$aggregation_layers$dist$es5$utils$scale_utils"),defaultGetValue=function(points){return points.length},defaultGetPoints=function(bin){return bin.points},defaultGetIndex=function(bin){return bin.index},ascending=function(a,b){return a<b?-1:a>b?1:a>=b?0:NaN},defaultProps={getValue:defaultGetValue,getPoints:defaultGetPoints,getIndex:defaultGetIndex,filterData:null};require=
function(){function BinSorter(){var bins=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],props=1<arguments.length&&void 0!==arguments[1]?arguments[1]:defaultProps;(0,_classCallCheck2["default"])(this,BinSorter);this.aggregatedBins=this.getAggregatedBins(bins,props);this._updateMinMaxValues();this.binMap=this.getBinMap()}(0,_createClass2["default"])(BinSorter,[{key:"getAggregatedBins",value:function(bins,props){var _props$getValue=props.getValue;_props$getValue=void 0===_props$getValue?defaultGetValue:
_props$getValue;var _props$getPoints=props.getPoints;_props$getPoints=void 0===_props$getPoints?defaultGetPoints:_props$getPoints;var _props$getIndex=props.getIndex;_props$getIndex=void 0===_props$getIndex?defaultGetIndex:_props$getIndex;props=props.filterData;for(var hasFilter="function"===typeof props,binCount=bins.length,aggregatedBins=[],index=0,binIndex=0;binIndex<binCount;binIndex++){var bin=bins[binIndex],points=_props$getPoints(bin),i=_props$getIndex(bin);points=hasFilter?points.filter(props):
points;bin.filteredPoints=hasFilter?points:null;bin=points.length?_props$getValue(points):null;null!==bin&&void 0!==bin&&(aggregatedBins[index]={i:Number.isFinite(i)?i:binIndex,value:bin,counts:points.length},index++)}return aggregatedBins}},{key:"_percentileToIndex",value:function(percentileRange){var len=this.sortedBins.length;if(2>len)return[0,0];percentileRange=percentileRange.map(function(n){return(0,_scaleUtils.clamp)(n,0,100)});percentileRange=(0,_slicedToArray2["default"])(percentileRange,
2);return[Math.ceil(percentileRange[0]/100*(len-1)),Math.floor(percentileRange[1]/100*(len-1))]}},{key:"getBinMap",value:function(){var binMap={},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=this.aggregatedBins[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var bin=_step.value;binMap[bin.i]=bin}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&
null!=_iterator["return"])_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError;}}return binMap}},{key:"_updateMinMaxValues",value:function(){var maxCount=0,maxValue=0,minValue=3.402823466E38,totalCount=0,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=this.aggregatedBins[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var x=_step2.value;maxCount=maxCount>x.counts?
maxCount:x.counts;maxValue=maxValue>x.value?maxValue:x.value;minValue=minValue<x.value?minValue:x.value;totalCount+=x.counts}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&null!=_iterator2["return"])_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2;}}this.maxCount=maxCount;this.maxValue=maxValue;this.minValue=minValue;this.totalCount=totalCount}},{key:"getValueRange",value:function(percentileRange){this.sortedBins||(this.sortedBins=
this.aggregatedBins.sort(function(a,b){return ascending(a.value,b.value)}));if(!this.sortedBins.length)return[];var lowerIdx=0,upperIdx=this.sortedBins.length-1;Array.isArray(percentileRange)&&(percentileRange=this._percentileToIndex(percentileRange),lowerIdx=percentileRange[0],upperIdx=percentileRange[1]);return[this.sortedBins[lowerIdx].value,this.sortedBins[upperIdx].value]}},{key:"getValueDomainByScale",value:function(scale){var _ref=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],_ref2=
(0,_slicedToArray2["default"])(_ref,2);_ref=_ref2[0];_ref=void 0===_ref?0:_ref;_ref2=_ref2[1];_ref2=void 0===_ref2?100:_ref2;this.sortedBins||(this.sortedBins=this.aggregatedBins.sort(function(a,b){return ascending(a.value,b.value)}));if(!this.sortedBins.length)return[];_ref=this._percentileToIndex([_ref,_ref2]);return this._getScaleDomain(scale,_ref)}},{key:"_getScaleDomain",value:function(scaleType,_ref3){var _ref4=(0,_slicedToArray2["default"])(_ref3,2);_ref3=_ref4[0];_ref4=_ref4[1];var bins=this.sortedBins;
switch(scaleType){case "quantize":case "linear":return[bins[_ref3].value,bins[_ref4].value];case "quantile":return(0,_scaleUtils.getQuantileDomain)(bins.slice(_ref3,_ref4+1),function(d){return d.value});case "ordinal":return(0,_scaleUtils.getOrdinalDomain)(bins,function(d){return d.value});default:return[bins[_ref3].value,bins[_ref4].value]}}}]);return BinSorter}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$aggregation_layers$dist$es5$utils$bin_sorter.js.map
