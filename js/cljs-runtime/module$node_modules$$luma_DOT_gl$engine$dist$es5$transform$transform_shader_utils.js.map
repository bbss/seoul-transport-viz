{
"version":3,
"file":"module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$transform_shader_utils.js",
"lineCount":8,
"mappings":"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",
"sources":["node_modules/@luma_DOT_gl/engine/dist/es5/transform/transform-shader-utils.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$transform_shader_utils\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.updateForTextures = updateForTextures;\nexports.getSizeUniforms = getSizeUniforms;\nexports.getVaryingType = getVaryingType;\nexports.processAttributeDefinition = processAttributeDefinition;\n\nvar _webgl = require(\"@luma.gl/webgl\");\n\nvar _shadertools = require(\"@luma.gl/shadertools\");\n\nvar SAMPLER_UNIFORM_PREFIX = 'transform_uSampler_';\nvar SIZE_UNIFORM_PREFIX = 'transform_uSize_';\nvar VS_POS_VARIABLE = 'transform_position';\n\nfunction updateForTextures(_ref) {\n  var vs = _ref.vs,\n      sourceTextureMap = _ref.sourceTextureMap,\n      targetTextureVarying = _ref.targetTextureVarying,\n      targetTexture = _ref.targetTexture;\n  var texAttributeNames = Object.keys(sourceTextureMap);\n  var sourceCount = texAttributeNames.length;\n  var targetTextureType = null;\n  var samplerTextureMap = {};\n  var updatedVs = vs;\n  var finalInject = {};\n\n  if (sourceCount > 0 || targetTextureVarying) {\n    var vsLines = updatedVs.split('\\n');\n    var updateVsLines = vsLines.slice();\n    vsLines.forEach(function (line, index, lines) {\n      if (sourceCount > 0) {\n        var updated = processAttributeDefinition(line, sourceTextureMap);\n\n        if (updated) {\n          var updatedLine = updated.updatedLine,\n              inject = updated.inject;\n          updateVsLines[index] = updatedLine;\n          finalInject = (0, _shadertools.combineInjects)([finalInject, inject]);\n          Object.assign(samplerTextureMap, updated.samplerTextureMap);\n          sourceCount--;\n        }\n      }\n\n      if (targetTextureVarying && !targetTextureType) {\n        targetTextureType = getVaryingType(line, targetTextureVarying);\n      }\n    });\n\n    if (targetTextureVarying) {\n      (0, _webgl.assert)(targetTexture);\n      var sizeName = \"\".concat(SIZE_UNIFORM_PREFIX).concat(targetTextureVarying);\n      var uniformDeclaration = \"uniform vec2 \".concat(sizeName, \";\\n\");\n      var posInstructions = \"     vec2 \".concat(VS_POS_VARIABLE, \" = transform_getPos(\").concat(sizeName, \");\\n     gl_Position = vec4(\").concat(VS_POS_VARIABLE, \", 0, 1.);\\n\");\n      var inject = {\n        'vs:#decl': uniformDeclaration,\n        'vs:#main-start': posInstructions\n      };\n      finalInject = (0, _shadertools.combineInjects)([finalInject, inject]);\n    }\n\n    updatedVs = updateVsLines.join('\\n');\n  }\n\n  return {\n    vs: updatedVs,\n    targetTextureType: targetTextureType,\n    inject: finalInject,\n    samplerTextureMap: samplerTextureMap\n  };\n}\n\nfunction getSizeUniforms(_ref2) {\n  var sourceTextureMap = _ref2.sourceTextureMap,\n      targetTextureVarying = _ref2.targetTextureVarying,\n      targetTexture = _ref2.targetTexture;\n  var uniforms = {};\n  var width;\n  var height;\n\n  if (targetTextureVarying) {\n    width = targetTexture.width;\n    height = targetTexture.height;\n    uniforms[\"\".concat(SIZE_UNIFORM_PREFIX).concat(targetTextureVarying)] = [width, height];\n  }\n\n  for (var textureName in sourceTextureMap) {\n    var _sourceTextureMap$tex = sourceTextureMap[textureName];\n    width = _sourceTextureMap$tex.width;\n    height = _sourceTextureMap$tex.height;\n    uniforms[\"\".concat(SIZE_UNIFORM_PREFIX).concat(textureName)] = [width, height];\n  }\n\n  return uniforms;\n}\n\nfunction getAttributeDefinition(line) {\n  return (0, _shadertools.getQualifierDetails)(line, ['attribute', 'in']);\n}\n\nfunction getSamplerDeclerations(textureName) {\n  var samplerName = \"\".concat(SAMPLER_UNIFORM_PREFIX).concat(textureName);\n  var sizeName = \"\".concat(SIZE_UNIFORM_PREFIX).concat(textureName);\n  var uniformDeclerations = \"  uniform sampler2D \".concat(samplerName, \";\\n  uniform vec2 \").concat(sizeName, \";\");\n  return {\n    samplerName: samplerName,\n    sizeName: sizeName,\n    uniformDeclerations: uniformDeclerations\n  };\n}\n\nfunction getVaryingType(line, varying) {\n  var qualaiferDetails = (0, _shadertools.getQualifierDetails)(line, ['varying', 'out']);\n\n  if (!qualaiferDetails) {\n    return null;\n  }\n\n  return qualaiferDetails.name === varying ? qualaiferDetails.type : null;\n}\n\nfunction processAttributeDefinition(line, textureMap) {\n  var samplerTextureMap = {};\n  var attributeData = getAttributeDefinition(line);\n\n  if (!attributeData) {\n    return null;\n  }\n\n  var type = attributeData.type,\n      name = attributeData.name;\n\n  if (name && textureMap[name]) {\n    var updatedLine = \"// \".concat(line, \" => Replaced by Transform with a sampler\");\n\n    var _getSamplerDecleratio = getSamplerDeclerations(name),\n        samplerName = _getSamplerDecleratio.samplerName,\n        sizeName = _getSamplerDecleratio.sizeName,\n        uniformDeclerations = _getSamplerDecleratio.uniformDeclerations;\n\n    var channels = (0, _shadertools.typeToChannelSuffix)(type);\n    var sampleInstruction = \"  \".concat(type, \" \").concat(name, \" = transform_getInput(\").concat(samplerName, \", \").concat(sizeName, \").\").concat(channels, \";\\n\");\n    samplerTextureMap[samplerName] = name;\n    var inject = {\n      'vs:#decl': uniformDeclerations,\n      'vs:#main-start': sampleInstruction\n    };\n    return {\n      updatedLine: updatedLine,\n      inject: inject,\n      samplerTextureMap: samplerTextureMap\n    };\n  }\n\n  return null;\n}\n//# sourceMappingURL=transform-shader-utils.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","getVaryingType","line","varying","qualaiferDetails","_shadertools","getQualifierDetails","name","type","processAttributeDefinition","textureMap","samplerTextureMap","attributeData","updatedLine","concat","samplerName","SAMPLER_UNIFORM_PREFIX","sizeName","SIZE_UNIFORM_PREFIX","uniformDeclerations","channels","typeToChannelSuffix","sampleInstruction","inject","Object","defineProperty","value","updateForTextures","_ref","vs","sourceTextureMap","targetTextureVarying","targetTexture","sourceCount","keys","texAttributeNames","length","targetTextureType","finalInject","vsLines","updatedVs","split","updateVsLines","slice","forEach","index","lines","updated","combineInjects","assign","_webgl","assert","uniformDeclaration","posInstructions","VS_POS_VARIABLE","join","getSizeUniforms","_ref2","uniforms","width","height","textureName","_sourceTextureMap$tex"]
}
