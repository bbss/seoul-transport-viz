shadow$provide.module$node_modules$$deck_DOT_gl$layers$dist$es5$text_layer$utils=function(global,require,module,exports){function nextPowOfTwo(number){return Math.pow(2,Math.ceil(Math.log2(number)))}function getTextWidth(text,mapping){for(var width=0,i=0;i<text.length;i++){var character=text[i],frameWidth=null;if(character=mapping&&mapping[character])frameWidth=character.width;width+=frameWidth}return width}function breakAll(text,maxWidth,iconMapping){for(var rows=[],rowStartCharIndex=0,rowOffsetLeft=
0,i=0;i<text.length;i++){var textWidth=getTextWidth(text[i],iconMapping);rowOffsetLeft+textWidth>maxWidth&&(rowStartCharIndex<i&&rows.push(text.substring(rowStartCharIndex,i)),rowStartCharIndex=i,rowOffsetLeft=0);rowOffsetLeft+=textWidth}rowStartCharIndex<text.length&&rows.push(text.substring(rowStartCharIndex));return{rows:rows,lastRowStartCharIndex:rowStartCharIndex,lastRowOffsetLeft:rowOffsetLeft}}function autoWrapping(text,wordBreak,maxWidth,iconMapping){if("break-all"===wordBreak)return breakAll(text,
maxWidth,iconMapping);wordBreak=[];for(var rowStartCharIndex=0,groupStartCharIndex=0,rowOffsetLeft=0,group,i=0;i<text.length;i++)if(" "===text[i]?(group=text[i],groupStartCharIndex=i+1):i+1<text.length&&" "===text[i+1]||i+1===text.length?(group=text.substring(groupStartCharIndex,i+1),groupStartCharIndex=i+1):group=null,group){var groupWidth=getTextWidth(group,iconMapping);if(rowOffsetLeft+groupWidth>maxWidth){var lastGroupStartIndex=groupStartCharIndex-group.length;rowStartCharIndex<lastGroupStartIndex&&
(wordBreak.push(text.substring(rowStartCharIndex,lastGroupStartIndex)),rowStartCharIndex=lastGroupStartIndex,rowOffsetLeft=0);groupWidth>maxWidth&&(group=breakAll(group,maxWidth,iconMapping),1<group.rows.length&&(wordBreak=wordBreak.concat(group.rows.slice(0,group.rows.length-1))),rowStartCharIndex+=group.lastRowStartCharIndex,groupWidth=group.lastRowOffsetLeft)}rowOffsetLeft+=groupWidth}rowStartCharIndex<text.length&&wordBreak.push(text.substring(rowStartCharIndex));return{rows:wordBreak,lastRowStartCharIndex:rowStartCharIndex,
lastRowOffsetLeft:rowOffsetLeft}}Object.defineProperty(exports,"__esModule",{value:!0});exports.nextPowOfTwo=nextPowOfTwo;exports.buildMapping=function(_ref){var characterSet=_ref.characterSet,getFontWidth=_ref.getFontWidth,fontHeight=_ref.fontHeight,buffer=_ref.buffer,maxCanvasWidth=_ref.maxCanvasWidth,_ref$mapping=_ref.mapping;_ref$mapping=void 0===_ref$mapping?{}:_ref$mapping;var _ref$xOffset=_ref.xOffset;_ref=_ref.yOffset;_ref=void 0===_ref?0:_ref;var row=0;_ref$xOffset=void 0===_ref$xOffset?
0:_ref$xOffset;var i=0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=characterSet[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _char=_step.value;if(!_ref$mapping[_char]){var width=getFontWidth(_char,i++);_ref$xOffset+width+2*buffer>maxCanvasWidth&&(_ref$xOffset=0,row++);_ref$mapping[_char]={x:_ref$xOffset+buffer,y:_ref+row*(fontHeight+2*buffer)+buffer,width:width,height:fontHeight};
_ref$xOffset+=width+2*buffer}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&null!=_iterator["return"])_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError;}}characterSet=fontHeight+2*buffer;return{mapping:_ref$mapping,xOffset:_ref$xOffset,yOffset:_ref+row*characterSet,canvasHeight:nextPowOfTwo(_ref+(row+1)*characterSet)}};exports.autoWrapping=autoWrapping;exports.transformParagraph=function(paragraph,lineHeight,wordBreak,maxWidth,
iconMapping){for(var JSCompiler_object_inline_leftOffsets_6576,JSCompiler_object_inline_rowWidth_6577,JSCompiler_object_inline_rowHeight_6578,result=Array(paragraph.length),autoWrappingEnabled=("break-word"===wordBreak||"break-all"===wordBreak)&&isFinite(maxWidth)&&0<maxWidth,size=[0,0],rowOffsetTop=0,lineStartIndex=0,i=0;i<=paragraph.length;i++){var _char2=paragraph[i],line=void 0;if("\n"===_char2||void 0===_char2)line=paragraph.slice(lineStartIndex,i);if(line){var rows=autoWrappingEnabled?autoWrapping(line,
wordBreak,maxWidth,iconMapping).rows:[line];line=!0;var _didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=rows[Symbol.iterator](),_step2;!(line=(_step2=_iterator2.next()).done);line=!0){var row=_step2.value;rows=iconMapping;for(var x=0,rowHeight=0,leftOffsets=Array(row.length),i$jscomp$0=0;i$jscomp$0<row.length;i$jscomp$0++){var character=row[i$jscomp$0],frame=rows[character];frame?(rowHeight||(rowHeight=frame.height),leftOffsets[i$jscomp$0]=x+frame.width/2,x+=frame.width):(_core.log.warn("Missing character: ".concat(character))(),
leftOffsets[i$jscomp$0]=x,x+=MISSING_CHAR_WIDTH)}JSCompiler_object_inline_leftOffsets_6576=leftOffsets;JSCompiler_object_inline_rowWidth_6577=x;JSCompiler_object_inline_rowHeight_6578=rowHeight;rows=JSCompiler_object_inline_rowWidth_6577;x=JSCompiler_object_inline_rowHeight_6578;rowHeight=JSCompiler_object_inline_leftOffsets_6576;i$jscomp$0=!0;var _didIteratorError3=!1,_iteratorError3=void 0;try{for(var _iterator3=rowHeight[Symbol.iterator](),_step3;!(i$jscomp$0=(_step3=_iterator3.next()).done);i$jscomp$0=
!0){var x$jscomp$0=_step3.value;result[lineStartIndex++]={x:x$jscomp$0,y:rowOffsetTop+x/2,rowWidth:rows}}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{if(!i$jscomp$0&&null!=_iterator3["return"])_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3;}}rowOffsetTop+=x*lineHeight;size[0]=autoWrappingEnabled?maxWidth:Math.max(size[0],rows)}}catch(err$394){_didIteratorError2=!0,_iteratorError2=err$394}finally{try{if(!line&&null!=_iterator2["return"])_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2;
}}}"\n"===_char2&&(result[lineStartIndex++]={x:0,y:0,rowWidth:0})}size[1]=rowOffsetTop;return{characters:result,size:size}};exports.getTextFromBuffer=function(_ref2){var value=_ref2.value,length=_ref2.length,stride=_ref2.stride,offset=_ref2.offset;_ref2=_ref2.startIndices;var bytesPerElement=value.BYTES_PER_ELEMENT;stride=stride?stride/bytesPerElement:1;offset=offset?offset/bytesPerElement:0;bytesPerElement=_ref2[length]||Math.floor((value.length-offset-bytesPerElement)/stride)+1;var texts=Array(length),
codes=value;if(1<stride||0<offset){codes=new value.constructor(bytesPerElement);for(var i=0;i<bytesPerElement;i++)codes[i]=value[i*stride+offset]}for(value=0;value<length;value++)texts[value]=String.fromCodePoint.apply(null,codes.subarray(_ref2[value],_ref2[value+1]||bytesPerElement));return{texts:texts,characterCount:bytesPerElement}};var _core=require("module$node_modules$$deck_DOT_gl$core$dist$es5$index"),MISSING_CHAR_WIDTH=32}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$layers$dist$es5$text_layer$utils.js.map
