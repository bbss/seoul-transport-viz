shadow$provide.module$node_modules$$loaders_DOT_gl$core$dist$es5$worker_utils$worker_pool=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _regenerator=global(require("module$node_modules$$babel$runtime$regenerator$index")),_asyncToGenerator2=global(require("module$node_modules$$babel$runtime$helpers$asyncToGenerator")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),
_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_workerThread=global(require("module$node_modules$$loaders_DOT_gl$core$dist$es5$worker_utils$worker_thread"));require=function(){function WorkerPool(_ref){var source=_ref.source,_ref$name=_ref.name;_ref$name=void 0===_ref$name?"unnamed":_ref$name;var _ref$maxConcurrency=_ref.maxConcurrency;_ref$maxConcurrency=void 0===_ref$maxConcurrency?1:_ref$maxConcurrency;var onMessage=_ref.onMessage;_ref=_ref.onDebug;_ref=
void 0===_ref?function(){}:_ref;(0,_classCallCheck2["default"])(this,WorkerPool);this.source=source;this.name=_ref$name;this.maxConcurrency=_ref$maxConcurrency;this.onMessage=onMessage;this.onDebug=_ref;this.jobQueue=[];this.idleQueue=[];this.count=0;this.isDestroyed=!1}(0,_createClass2["default"])(WorkerPool,[{key:"destroy",value:function(){this.idleQueue.forEach(function(worker){return worker.destroy()});this.isDestroyed=!0}},{key:"process",value:function(){var _process=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(data,
jobName){var _this=this;return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",new Promise(function(resolve,reject){_this.jobQueue.push({data:data,jobName:jobName,resolve:resolve,reject:reject});_this._startQueuedJob()}));case 1:case "end":return _context.stop()}},_callee)}));return function(_x,_x2){return _process.apply(this,arguments)}}()},{key:"_startQueuedJob",value:function(){var _this2=this;if(this.jobQueue.length){var worker=
this._getAvailableWorker();if(worker){var job=this.jobQueue.shift();this.onDebug({message:"processing",worker:worker.name,job:job.jobName,backlog:this.jobQueue.length});worker.process(job.data).then(function(result){return job.resolve(result)})["catch"](function(error){return job.reject(error)}).then(function(){return _this2._onWorkerDone(worker)})}}}},{key:"_onWorkerDone",value:function(worker){this.isDestroyed?worker.destroy():(this.idleQueue.push(worker),this._startQueuedJob())}},{key:"_getAvailableWorker",
value:function(){if(0<this.idleQueue.length)return this.idleQueue.shift();if(this.count<this.maxConcurrency){this.count++;var name="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new _workerThread["default"]({source:this.source,onMessage:this.onMessage,name:name})}return null}}]);return WorkerPool}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$loaders_DOT_gl$core$dist$es5$worker_utils$worker_pool.js.map
