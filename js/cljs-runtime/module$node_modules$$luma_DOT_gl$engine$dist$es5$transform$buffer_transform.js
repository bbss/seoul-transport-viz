shadow$provide.module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$buffer_transform=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_gltools=require("module$node_modules$$luma_DOT_gl$gltools$dist$es5$index"),
_webgl=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$index");require=function(){function BufferTransform(gl){var props=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2["default"])(this,BufferTransform);this.gl=gl;this.currentIndex=0;this.feedbackMap={};this.varyings=null;this.bindings=[];this.resources={};this._initialize(props);Object.seal(this)}(0,_createClass2["default"])(BufferTransform,[{key:"setupResources",value:function(opts){var _iteratorNormalCompletion=
!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=this.bindings[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)this._setupTransformFeedback(_step.value,opts)}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&null!=_iterator["return"])_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError;}}}},{key:"updateModelProps",value:function(){var props=0<arguments.length&&
void 0!==arguments[0]?arguments[0]:{},varyings=this.varyings;0<varyings.length&&(props=Object.assign({},props,{varyings:varyings}));return props}},{key:"getDrawOptions",value:function(){var binding=this.bindings[this.currentIndex],transformFeedback=binding.transformFeedback;return{attributes:Object.assign({},binding.sourceBuffers,(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).attributes),transformFeedback:transformFeedback}}},{key:"swap",value:function(){return this.feedbackMap?(this.currentIndex=
this._getNextIndex(),!0):!1}},{key:"update",value:function(){this._setupBuffers(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}},{key:"getBuffer",value:function(varyingName){var feedbackBuffers=this.bindings[this.currentIndex].feedbackBuffers;return(varyingName=varyingName?feedbackBuffers[varyingName]:null)?varyingName instanceof _webgl.Buffer?varyingName:varyingName.buffer:null}},{key:"getData",value:function(){var buffer=this.getBuffer((0<arguments.length&&void 0!==arguments[0]?arguments[0]:
{}).varyingName);return buffer?buffer.getData():null}},{key:"delete",value:function(){for(var name in this.resources)this.resources[name]["delete"]()}},{key:"_initialize",value:function(){var props=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(props);this.varyings=props.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers);0<this.varyings.length&&(0,_webgl.assert)((0,_gltools.isWebGL2)(this.gl))}},{key:"_getFeedbackBuffers",value:function(props){var _props$sourceBuffers=
props.sourceBuffers;_props$sourceBuffers=void 0===_props$sourceBuffers?{}:_props$sourceBuffers;var feedbackBuffers={};this.bindings[this.currentIndex]&&Object.assign(feedbackBuffers,this.bindings[this.currentIndex].feedbackBuffers);if(this.feedbackMap)for(var sourceName in this.feedbackMap){var feedbackName=this.feedbackMap[sourceName];sourceName in _props$sourceBuffers&&(feedbackBuffers[feedbackName]=sourceName)}Object.assign(feedbackBuffers,props.feedbackBuffers);for(var bufferName in feedbackBuffers)props=
feedbackBuffers[bufferName],"string"===typeof props&&(props=_props$sourceBuffers[props],feedbackBuffers[bufferName]=this._createNewBuffer(bufferName,{byteLength:props.byteLength,usage:props.usage,accessor:props.accessor}));return feedbackBuffers}},{key:"_setupBuffers",value:function(){var props=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},_props$sourceBuffers2=props.sourceBuffers;_props$sourceBuffers2=void 0===_props$sourceBuffers2?null:_props$sourceBuffers2;Object.assign(this.feedbackMap,
props.feedbackMap);props=this._getFeedbackBuffers(props);this._updateBindings({sourceBuffers:_props$sourceBuffers2,feedbackBuffers:props})}},{key:"_setupTransformFeedback",value:function(binding,_ref2){binding.transformFeedback=new _webgl.TransformFeedback(this.gl,{program:_ref2.model.program,buffers:binding.feedbackBuffers})}},{key:"_updateBindings",value:function(opts){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],opts);if(this.feedbackMap){var _this$_swapBuffers=
this._swapBuffers(this.bindings[this.currentIndex]);opts=_this$_swapBuffers.sourceBuffers;_this$_swapBuffers=_this$_swapBuffers.feedbackBuffers;var nextIndex=this._getNextIndex();this.bindings[nextIndex]=this._updateBinding(this.bindings[nextIndex],{sourceBuffers:opts,feedbackBuffers:_this$_swapBuffers})}}},{key:"_updateBinding",value:function(binding,opts){if(!binding)return{sourceBuffers:Object.assign({},opts.sourceBuffers),feedbackBuffers:Object.assign({},opts.feedbackBuffers)};Object.assign(binding.sourceBuffers,
opts.sourceBuffers);Object.assign(binding.feedbackBuffers,opts.feedbackBuffers);binding.transformFeedback&&binding.transformFeedback.setBuffers(binding.feedbackBuffers);return binding}},{key:"_swapBuffers",value:function(opts){if(!this.feedbackMap)return null;var sourceBuffers=Object.assign({},opts.sourceBuffers),feedbackBuffers=Object.assign({},opts.feedbackBuffers),srcName;for(srcName in this.feedbackMap){var dstName=this.feedbackMap[srcName];sourceBuffers[srcName]=opts.feedbackBuffers[dstName];
feedbackBuffers[dstName]=opts.sourceBuffers[srcName];(0,_webgl.assert)(feedbackBuffers[dstName]instanceof _webgl.Buffer)}return{sourceBuffers:sourceBuffers,feedbackBuffers:feedbackBuffers}}},{key:"_createNewBuffer",value:function(name,opts){opts=new _webgl.Buffer(this.gl,opts);if(this.resources[name])this.resources[name]["delete"]();return this.resources[name]=opts}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}}]);return BufferTransform}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$buffer_transform.js.map
