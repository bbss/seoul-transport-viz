shadow$provide.module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$copy_and_blit=function(global,require,module,exports){function readPixelsToArray(source){var _ref=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref$sourceX=_ref.sourceX;_ref$sourceX=void 0===_ref$sourceX?0:_ref$sourceX;var _ref$sourceY=_ref.sourceY;_ref$sourceY=void 0===_ref$sourceY?0:_ref$sourceY;var _ref$sourceFormat=_ref.sourceFormat;_ref$sourceFormat=void 0===_ref$sourceFormat?6408:_ref$sourceFormat;var _ref$sourceAttachment=
_ref.sourceAttachment,sourceAttachment=void 0===_ref$sourceAttachment?36064:_ref$sourceAttachment;_ref$sourceAttachment=_ref.target;var target=void 0===_ref$sourceAttachment?null:_ref$sourceAttachment;_ref$sourceAttachment=_ref.sourceWidth;var sourceHeight=_ref.sourceHeight;_ref=_ref.sourceType;var _getFramebuffer=getFramebuffer(source),framebuffer=_getFramebuffer.framebuffer;_getFramebuffer=_getFramebuffer.deleteFramebuffer;(0,_utils.assert)(framebuffer);var gl=framebuffer.gl,handle=framebuffer.handle,
attachments=framebuffer.attachments;_ref$sourceAttachment=_ref$sourceAttachment||framebuffer.width;sourceHeight=sourceHeight||framebuffer.height;36064===sourceAttachment&&null===handle&&(sourceAttachment=1028);(0,_utils.assert)(attachments[sourceAttachment]);_ref=_ref||attachments[sourceAttachment].type;var type=_ref;sourceAttachment=_ref$sourceAttachment;attachments=sourceHeight;target||(type=type||5121,target=(0,_typedArrayUtils.getTypedArrayFromGLType)(type,{clamped:!1}),type=(0,_formatUtils.glFormatToComponents)(_ref$sourceFormat),
target=new target(sourceAttachment*attachments*type));_ref=_ref||(0,_typedArrayUtils.getGLTypeFromTypedArray)(target);handle=gl.bindFramebuffer(36160,handle);gl.readPixels(_ref$sourceX,_ref$sourceY,_ref$sourceAttachment,sourceHeight,_ref$sourceFormat,_ref,target);gl.bindFramebuffer(36160,handle||null);if(_getFramebuffer)framebuffer["delete"]();return target}function copyToDataUrl(source){var _ref3=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref3$sourceAttachmen=_ref3.sourceAttachment;
_ref3=_ref3.targetMaxHeight;var targetMaxHeight=void 0===_ref3?Number.MAX_SAFE_INTEGER:_ref3;_ref3$sourceAttachmen=readPixelsToArray(source,{sourceAttachment:void 0===_ref3$sourceAttachmen?36064:_ref3$sourceAttachmen});_ref3=source.width;for(var height=source.height;height>targetMaxHeight;)height=(0,_webglUtils.scalePixels)({data:_ref3$sourceAttachmen,width:_ref3,height:height}),_ref3$sourceAttachmen=height.data,_ref3=height.width,height=height.height;(0,_webglUtils.flipRows)({data:_ref3$sourceAttachmen,
width:_ref3,height:height});targetMaxHeight=document.createElement("canvas");targetMaxHeight.width=_ref3;targetMaxHeight.height=height;var context=targetMaxHeight.getContext("2d");_ref3=context.createImageData(_ref3,height);_ref3.data.set(_ref3$sourceAttachmen);context.putImageData(_ref3,0,0);return targetMaxHeight.toDataURL()}function getFramebuffer(source){return source instanceof _framebuffer["default"]?{framebuffer:source,deleteFramebuffer:!1}:{framebuffer:(0,_textureUtils.toFramebuffer)(source),
deleteFramebuffer:!0}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports.readPixelsToArray=readPixelsToArray;exports.readPixelsToBuffer=function(source,_ref2){var _ref2$sourceX=_ref2.sourceX,sourceX=void 0===_ref2$sourceX?0:_ref2$sourceX;_ref2$sourceX=_ref2.sourceY;var sourceY=void 0===_ref2$sourceX?0:_ref2$sourceX;_ref2$sourceX=_ref2.sourceFormat;var sourceFormat=void 0===_ref2$sourceX?6408:_ref2$sourceX;
_ref2$sourceX=_ref2.target;_ref2$sourceX=void 0===_ref2$sourceX?null:_ref2$sourceX;var _ref2$targetByteOffse=_ref2.targetByteOffset,targetByteOffset=void 0===_ref2$targetByteOffse?0:_ref2$targetByteOffse,sourceWidth=_ref2.sourceWidth,sourceHeight=_ref2.sourceHeight,sourceType=_ref2.sourceType;_ref2=getFramebuffer(source);source=_ref2.framebuffer;_ref2=_ref2.deleteFramebuffer;(0,_utils.assert)(source);var gl=source.gl;sourceWidth=sourceWidth||source.width;sourceHeight=sourceHeight||source.height;(0,
_webglUtils.assertWebGL2Context)(gl);sourceType=sourceType||(_ref2$sourceX?_ref2$sourceX.type:5121);_ref2$sourceX||(_ref2$sourceX=(0,_formatUtils.glFormatToComponents)(sourceFormat),_ref2$targetByteOffse=(0,_formatUtils.glTypeToBytes)(sourceType),_ref2$sourceX=new _buffer["default"](gl,{byteLength:targetByteOffset+sourceWidth*sourceHeight*_ref2$sourceX*_ref2$targetByteOffse,accessor:{type:sourceType,size:_ref2$sourceX}}));_ref2$sourceX.bind({target:35051});(0,_gltools.withParameters)(gl,{framebuffer:source},
function(){gl.readPixels(sourceX,sourceY,sourceWidth,sourceHeight,sourceFormat,sourceType,targetByteOffset)});_ref2$sourceX.unbind({target:35051});if(_ref2)source["delete"]();return _ref2$sourceX};exports.copyToDataUrl=copyToDataUrl;exports.copyToImage=function(source){var _ref4=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref4$sourceAttachmen=_ref4.sourceAttachment;_ref4=_ref4.targetImage;_ref4=void 0===_ref4?null:_ref4;_ref4$sourceAttachmen=copyToDataUrl(source,{sourceAttachment:void 0===
_ref4$sourceAttachmen?36064:_ref4$sourceAttachmen});_ref4=_ref4||new Image;_ref4.src=_ref4$sourceAttachmen;return _ref4};exports.copyToTexture=function(source,target){var _ref5=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},_ref5$sourceX=_ref5.sourceX;_ref5$sourceX=void 0===_ref5$sourceX?0:_ref5$sourceX;var _ref5$sourceY=_ref5.sourceY;_ref5$sourceY=void 0===_ref5$sourceY?0:_ref5$sourceY;var targetX=_ref5.targetX,targetY=_ref5.targetY,targetZ=_ref5.targetZ,_ref5$targetMipmaplev=_ref5.targetMipmaplevel;
_ref5$targetMipmaplev=void 0===_ref5$targetMipmaplev?0:_ref5$targetMipmaplev;var _ref5$targetInternalF=_ref5.targetInternalFormat;_ref5$targetInternalF=void 0===_ref5$targetInternalF?6408:_ref5$targetInternalF;var width=_ref5.width;_ref5=_ref5.height;var _getFramebuffer3=getFramebuffer(source),framebuffer=_getFramebuffer3.framebuffer;_getFramebuffer3=_getFramebuffer3.deleteFramebuffer;(0,_utils.assert)(framebuffer);var gl=framebuffer.gl,handle=framebuffer.handle,isSubCopy="undefined"!==typeof targetX||
"undefined"!==typeof targetY||"undefined"!==typeof targetZ;targetX=targetX||0;targetY=targetY||0;targetZ=targetZ||0;handle=gl.bindFramebuffer(36160,handle);(0,_utils.assert)(target);var texture=null;target instanceof _texture["default"]&&(texture=target,width=Number.isFinite(width)?width:texture.width,_ref5=Number.isFinite(_ref5)?_ref5:texture.height,texture.bind(0),target=texture.target);if(isSubCopy)switch(target){case 3553:case 34067:gl.copyTexSubImage2D(target,_ref5$targetMipmaplev,targetX,targetY,
_ref5$sourceX,_ref5$sourceY,width,_ref5);break;case 35866:case 32879:gl.copyTexSubImage3D(target,_ref5$targetMipmaplev,targetX,targetY,targetZ,_ref5$sourceX,_ref5$sourceY,width,_ref5)}else gl.copyTexImage2D(target,_ref5$targetMipmaplev,_ref5$targetInternalF,_ref5$sourceX,_ref5$sourceY,width,_ref5,0);texture&&texture.unbind();gl.bindFramebuffer(36160,handle||null);if(_getFramebuffer3)framebuffer["delete"]();return texture};exports.blit=function(source,target){var _ref6=2<arguments.length&&void 0!==
arguments[2]?arguments[2]:{},_ref6$sourceAttachmen=_ref6.sourceAttachment;_ref6$sourceAttachmen=void 0===_ref6$sourceAttachmen?36064:_ref6$sourceAttachmen;var _ref6$sourceX=_ref6.sourceX0;_ref6$sourceX=void 0===_ref6$sourceX?0:_ref6$sourceX;var _ref6$sourceY=_ref6.sourceY0;_ref6$sourceY=void 0===_ref6$sourceY?0:_ref6$sourceY;var sourceX1=_ref6.sourceX1,sourceY1=_ref6.sourceY1,_ref6$targetX=_ref6.targetX0;_ref6$targetX=void 0===_ref6$targetX?0:_ref6$targetX;var _ref6$targetY=_ref6.targetY0;_ref6$targetY=
void 0===_ref6$targetY?0:_ref6$targetY;var targetX1=_ref6.targetX1,targetY1=_ref6.targetY1,_ref6$color=_ref6.color;_ref6$color=void 0===_ref6$color?!0:_ref6$color;var _ref6$depth=_ref6.depth;_ref6$depth=void 0===_ref6$depth?!1:_ref6$depth;var _ref6$stencil=_ref6.stencil,stencil=void 0===_ref6$stencil?!1:_ref6$stencil;_ref6$stencil=_ref6.mask;_ref6$stencil=void 0===_ref6$stencil?0:_ref6$stencil;_ref6=_ref6.filter;_ref6=void 0===_ref6?9728:_ref6;var _getFramebuffer4=getFramebuffer(source),srcFramebuffer=
_getFramebuffer4.framebuffer;_getFramebuffer4=_getFramebuffer4.deleteFramebuffer;var _getFramebuffer5=getFramebuffer(target),dstFramebuffer=_getFramebuffer5.framebuffer;_getFramebuffer5=_getFramebuffer5.deleteFramebuffer;(0,_utils.assert)(srcFramebuffer);(0,_utils.assert)(dstFramebuffer);var gl=dstFramebuffer.gl,handle=dstFramebuffer.handle,width=dstFramebuffer.width,height=dstFramebuffer.height,readBuffer=dstFramebuffer.readBuffer;(0,_webglUtils.assertWebGL2Context)(gl);srcFramebuffer.handle||36064!==
_ref6$sourceAttachmen||(_ref6$sourceAttachmen=1028);_ref6$color&&(_ref6$stencil|=16384);_ref6$depth&&(_ref6$stencil|=256);stencil&&(_ref6$stencil|=1024);(_getFramebuffer4||_getFramebuffer5)&&_ref6$stencil&1280&&(_ref6$stencil=16384,_gltools.log.warn("Blitting from or into a Texture object, forcing mask to GL.COLOR_BUFFER_BIT")());(0,_utils.assert)(_ref6$stencil);sourceX1=void 0===sourceX1?srcFramebuffer.width:sourceX1;sourceY1=void 0===sourceY1?srcFramebuffer.height:sourceY1;targetX1=void 0===targetX1?
width:targetX1;targetY1=void 0===targetY1?height:targetY1;_ref6$color=gl.bindFramebuffer(36009,handle);_ref6$depth=gl.bindFramebuffer(36008,srcFramebuffer.handle);gl.readBuffer(_ref6$sourceAttachmen);gl.blitFramebuffer(_ref6$sourceX,_ref6$sourceY,sourceX1,sourceY1,_ref6$targetX,_ref6$targetY,targetX1,targetY1,_ref6$stencil,_ref6);gl.readBuffer(readBuffer);gl.bindFramebuffer(36008,_ref6$depth||null);gl.bindFramebuffer(36009,_ref6$color||null);if(_getFramebuffer4)srcFramebuffer["delete"]();if(_getFramebuffer5)dstFramebuffer["delete"]();
return dstFramebuffer};var _buffer=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$buffer")),_framebuffer=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$framebuffer")),_texture=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$texture")),_gltools=require("module$node_modules$$luma_DOT_gl$gltools$dist$es5$index"),_webglUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$index"),_typedArrayUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$typed_array_utils"),
_formatUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$format_utils"),_textureUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$texture_utils"),_utils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$utils$index")}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$copy_and_blit.js.map
