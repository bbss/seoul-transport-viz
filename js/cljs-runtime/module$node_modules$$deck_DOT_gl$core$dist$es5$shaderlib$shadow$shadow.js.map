{
"version":3,
"file":"module$node_modules$$deck_DOT_gl$core$dist$es5$shaderlib$shadow$shadow.js",
"lineCount":13,
"mappings":"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",
"sources":["node_modules/@deck_DOT_gl/core/dist/es5/shaderlib/shadow/shadow.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$deck_DOT_gl$core$dist$es5$shaderlib$shadow$shadow\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _constants = require(\"../../lib/constants\");\n\nvar _project = _interopRequireDefault(require(\"../project/project\"));\n\nvar _math = require(\"math.gl\");\n\nvar _memoize = _interopRequireDefault(require(\"../../utils/memoize\"));\n\nvar _webMercator = require(\"@math.gl/web-mercator\");\n\nvar vs = \"\\nconst int max_lights = 2;\\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\\nuniform vec4 shadow_uProjectCenters[max_lights];\\nuniform bool shadow_uDrawShadowMap;\\nuniform bool shadow_uUseShadowMap;\\nuniform int shadow_uLightId;\\nuniform float shadow_uLightCount;\\n\\nvarying vec3 shadow_vPosition[max_lights];\\n\\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\\n  if (shadow_uDrawShadowMap) {\\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\\n  }\\n  if (shadow_uUseShadowMap) {\\n    for (int i = 0; i < max_lights; i++) {\\n      if(i < int(shadow_uLightCount)) {\\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\\n      }\\n    }\\n  }\\n  return gl_Position;\\n}\\n\";\nvar fs = \"\\nconst int max_lights = 2;\\nuniform bool shadow_uDrawShadowMap;\\nuniform bool shadow_uUseShadowMap;\\nuniform sampler2D shadow_uShadowMap0;\\nuniform sampler2D shadow_uShadowMap1;\\nuniform vec4 shadow_uColor;\\nuniform float shadow_uLightCount;\\n\\nvarying vec3 shadow_vPosition[max_lights];\\n\\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\\n\\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\\n\\n  float z = dot(rgbaDepth, bitUnpackShift);\\n  return smoothstep(0.001, 0.01, position.z - z);\\n}\\n\\nvec4 shadow_filterShadowColor(vec4 color) {\\n  if (shadow_uDrawShadowMap) {\\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\\n    return rgbaDepth;\\n  }\\n  if (shadow_uUseShadowMap) {\\n    float shadowAlpha = 0.0;\\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\\n    if(shadow_uLightCount > 1.0) {\\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\\n    }\\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\\n\\n    return vec4(\\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\\n      blendedAlpha\\n    );\\n  }\\n  return color;\\n}\\n\";\nvar getMemoizedViewportCenterPosition = (0, _memoize[\"default\"])(getViewportCenterPosition);\nvar getMemoizedViewProjectionMatrices = (0, _memoize[\"default\"])(getViewProjectionMatrices);\nvar DEFAULT_SHADOW_COLOR = [0, 0, 0, 1.0];\nvar VECTOR_TO_POINT_MATRIX = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0];\n\nfunction screenToCommonSpace(xyz, pixelUnprojectionMatrix) {\n  var _xyz = (0, _slicedToArray2[\"default\"])(xyz, 3),\n      x = _xyz[0],\n      y = _xyz[1],\n      z = _xyz[2];\n\n  var coord = (0, _webMercator.pixelsToWorld)([x, y, z], pixelUnprojectionMatrix);\n\n  if (Number.isFinite(z)) {\n    return coord;\n  }\n\n  return [coord[0], coord[1], 0];\n}\n\nfunction getViewportCenterPosition(_ref) {\n  var viewport = _ref.viewport,\n      center = _ref.center;\n  return new _math.Matrix4(viewport.viewProjectionMatrix).invert().transform(center);\n}\n\nfunction getViewProjectionMatrices(_ref2) {\n  var viewport = _ref2.viewport,\n      shadowMatrices = _ref2.shadowMatrices;\n  var projectionMatrices = [];\n  var pixelUnprojectionMatrix = viewport.pixelUnprojectionMatrix;\n  var farZ = viewport.isGeospatial ? undefined : 1;\n  var corners = [[0, 0, farZ], [viewport.width, 0, farZ], [0, viewport.height, farZ], [viewport.width, viewport.height, farZ], [0, 0, -1], [viewport.width, 0, -1], [0, viewport.height, -1], [viewport.width, viewport.height, -1]].map(function (pixel) {\n    return screenToCommonSpace(pixel, pixelUnprojectionMatrix);\n  });\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    var _loop = function _loop() {\n      var shadowMatrix = _step.value;\n      var viewMatrix = shadowMatrix.clone().translate(new _math.Vector3(viewport.center).negate());\n      var positions = corners.map(function (corner) {\n        return viewMatrix.transform(corner);\n      });\n      var projectionMatrix = new _math.Matrix4().ortho({\n        left: Math.min.apply(Math, (0, _toConsumableArray2[\"default\"])(positions.map(function (position) {\n          return position[0];\n        }))),\n        right: Math.max.apply(Math, (0, _toConsumableArray2[\"default\"])(positions.map(function (position) {\n          return position[0];\n        }))),\n        bottom: Math.min.apply(Math, (0, _toConsumableArray2[\"default\"])(positions.map(function (position) {\n          return position[1];\n        }))),\n        top: Math.max.apply(Math, (0, _toConsumableArray2[\"default\"])(positions.map(function (position) {\n          return position[1];\n        }))),\n        near: Math.min.apply(Math, (0, _toConsumableArray2[\"default\"])(positions.map(function (position) {\n          return -position[2];\n        }))),\n        far: Math.max.apply(Math, (0, _toConsumableArray2[\"default\"])(positions.map(function (position) {\n          return -position[2];\n        })))\n      });\n      projectionMatrices.push(projectionMatrix.multiplyRight(shadowMatrix));\n    };\n\n    for (var _iterator = shadowMatrices[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      _loop();\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n        _iterator[\"return\"]();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  return projectionMatrices;\n}\n\nfunction createShadowUniforms() {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var uniforms = {\n    shadow_uDrawShadowMap: Boolean(opts.drawToShadowMap),\n    shadow_uUseShadowMap: opts.shadowMaps ? opts.shadowMaps.length > 0 : false,\n    shadow_uColor: opts.shadowColor || DEFAULT_SHADOW_COLOR,\n    shadow_uLightId: opts.shadowLightId || 0,\n    shadow_uLightCount: opts.shadowMatrices.length\n  };\n  var center = getMemoizedViewportCenterPosition({\n    viewport: opts.viewport,\n    center: context.project_uCenter\n  });\n  var projectCenters = [];\n  var viewProjectionMatrices = getMemoizedViewProjectionMatrices({\n    shadowMatrices: opts.shadowMatrices,\n    viewport: opts.viewport\n  }).slice();\n\n  for (var i = 0; i < opts.shadowMatrices.length; i++) {\n    var viewProjectionMatrix = viewProjectionMatrices[i];\n    var viewProjectionMatrixCentered = viewProjectionMatrix.clone().translate(new _math.Vector3(opts.viewport.center).negate());\n\n    if (context.project_uCoordinateSystem === _constants.COORDINATE_SYSTEM.LNGLAT && context.project_uProjectionMode === _constants.PROJECTION_MODE.WEB_MERCATOR) {\n      viewProjectionMatrices[i] = viewProjectionMatrixCentered;\n      projectCenters[i] = center;\n    } else {\n      viewProjectionMatrices[i] = viewProjectionMatrix.clone().multiplyRight(VECTOR_TO_POINT_MATRIX);\n      projectCenters[i] = viewProjectionMatrixCentered.transform(center);\n    }\n  }\n\n  for (var _i = 0; _i < viewProjectionMatrices.length; _i++) {\n    uniforms[\"shadow_uViewProjectionMatrices[\".concat(_i, \"]\")] = viewProjectionMatrices[_i];\n    uniforms[\"shadow_uProjectCenters[\".concat(_i, \"]\")] = projectCenters[_i];\n\n    if (opts.shadowMaps && opts.shadowMaps.length > 0) {\n      uniforms[\"shadow_uShadowMap\".concat(_i)] = opts.shadowMaps[_i];\n    } else {\n      uniforms[\"shadow_uShadowMap\".concat(_i)] = opts.dummyShadowMap;\n    }\n  }\n\n  return uniforms;\n}\n\nvar _default = {\n  name: 'shadow',\n  dependencies: [_project[\"default\"]],\n  vs: vs,\n  fs: fs,\n  inject: {\n    'vs:DECKGL_FILTER_GL_POSITION': \"\\n    position = shadow_setVertexPosition(geometry.position);\\n    \",\n    'fs:DECKGL_FILTER_COLOR': \"\\n    color = shadow_filterShadowColor(color);\\n    \"\n  },\n  getUniforms: function getUniforms() {\n    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    if (opts.drawToShadowMap || opts.shadowMaps && opts.shadowMaps.length > 0) {\n      var shadowUniforms = {};\n      var _opts$shadowEnabled = opts.shadowEnabled,\n          shadowEnabled = _opts$shadowEnabled === void 0 ? true : _opts$shadowEnabled;\n\n      if (shadowEnabled && opts.shadowMatrices && opts.shadowMatrices.length > 0) {\n        Object.assign(shadowUniforms, createShadowUniforms(opts, context));\n      } else {\n        Object.assign(shadowUniforms, {\n          shadow_uDrawShadowMap: false,\n          shadow_uUseShadowMap: false\n        });\n      }\n\n      return shadowUniforms;\n    }\n\n    return {};\n  }\n};\nexports[\"default\"] = _default;\n//# sourceMappingURL=shadow.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","createShadowUniforms","opts","arguments","length","undefined","context","uniforms","shadow_uDrawShadowMap","drawToShadowMap","shadow_uUseShadowMap","shadowMaps","shadow_uColor","shadowColor","DEFAULT_SHADOW_COLOR","shadow_uLightId","shadowLightId","shadow_uLightCount","shadowMatrices","center","getMemoizedViewportCenterPosition","viewport","project_uCenter","projectCenters","viewProjectionMatrices","getMemoizedViewProjectionMatrices","slice","i","viewProjectionMatrix","viewProjectionMatrixCentered","clone","translate","negate","_math","Vector3","project_uCoordinateSystem","_constants","COORDINATE_SYSTEM","LNGLAT","project_uProjectionMode","PROJECTION_MODE","WEB_MERCATOR","multiplyRight","VECTOR_TO_POINT_MATRIX","transform","_i","concat","dummyShadowMap","_interopRequireDefault","Object","defineProperty","value","_toConsumableArray2","_slicedToArray2","_project","_memoize","_webMercator","getViewportCenterPosition","_ref","invert","Matrix4","getViewProjectionMatrices","_ref2","projectionMatrices","pixelUnprojectionMatrix","farZ","isGeospatial","corners","width","height","map","pixel","_xyz","x","y","z","coord","pixelsToWorld","Number","isFinite","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_loop","shadowMatrix","_step","viewMatrix","positions","corner","projectionMatrix","ortho","left","Math","min","apply","position","right","max","bottom","top","near","far","push","_iterator","Symbol","iterator","done","next","err","_default","name","dependencies","vs","fs","inject","getUniforms","shadowUniforms","_opts$shadowEnabled","shadowEnabled","assign"]
}
