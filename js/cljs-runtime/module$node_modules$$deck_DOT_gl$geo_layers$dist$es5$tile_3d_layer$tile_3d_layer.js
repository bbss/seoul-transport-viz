shadow$provide.module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_3d_layer$tile_3d_layer=function(global,require,module,exports){function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=
null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,
"__esModule",{value:!0});exports["default"]=void 0;var _regenerator=global(require("module$node_modules$$babel$runtime$regenerator$index")),_defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_asyncToGenerator2=global(require("module$node_modules$$babel$runtime$helpers$asyncToGenerator")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),
_possibleConstructorReturn2=global(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),_getPrototypeOf2=global(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),_inherits2=global(require("module$node_modules$$babel$runtime$helpers$inherits"));global=require("module$node_modules$math_DOT_gl$dist$es5$index");var _core=require("module$node_modules$$luma_DOT_gl$core$dist$es5$index"),_core2=require("module$node_modules$$deck_DOT_gl$core$dist$es5$index"),
_layers=require("module$node_modules$$deck_DOT_gl$layers$dist$es5$index"),_meshLayers=require("module$node_modules$$deck_DOT_gl$mesh_layers$dist$es5$index"),_core3=require("module$node_modules$$loaders_DOT_gl$core$dist$es5$index"),_tiles=require("module$node_modules$$loaders_DOT_gl$tiles$dist$es5$index");require=require("module$node_modules$$loaders_DOT_gl$3d_tiles$dist$es5$index");var scratchOffset=new global.Vector3;require={getPointColor:[0,0,0],pointSize:1,data:null,loadOptions:{},loader:require.Tiles3DLoader,
onTilesetLoad:function(tileset3d){},onTileLoad:function(tileHeader){},onTileUnload:function(tileHeader){},onTileError:function(tile,message,url){}};global=function(_CompositeLayer){function Tile3DLayer(){(0,_classCallCheck2["default"])(this,Tile3DLayer);return(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(Tile3DLayer).apply(this,arguments))}(0,_inherits2["default"])(Tile3DLayer,_CompositeLayer);(0,_createClass2["default"])(Tile3DLayer,[{key:"initializeState",value:function(){"onTileLoadFail"in
this.props&&_core2.log.removed("onTileLoadFail","onTileError")();this.state={layerMap:{},tileset3d:null}}},{key:"shouldUpdateState",value:function(_ref){return _ref.changeFlags.somethingChanged}},{key:"updateState",value:function(_ref2){var props=_ref2.props,oldProps=_ref2.oldProps;_ref2=_ref2.changeFlags;props.data&&props.data!==oldProps.data&&this._loadTileset(props.data);_ref2.viewportChanged&&this._updateTileset(this.state.tileset3d)}},{key:"getPickingInfo",value:function(_ref3){var info=_ref3.info,
sourceLayer=_ref3.sourceLayer;_ref3=this.state.layerMap;if(sourceLayer=sourceLayer&&sourceLayer.id)sourceLayer=sourceLayer.substring(this.id.length+1),sourceLayer=sourceLayer.substring(sourceLayer.indexOf("-")+1),info.object=_ref3[sourceLayer]&&_ref3[sourceLayer].tile;return info}},{key:"_loadTileset",value:function(){var _loadTileset2=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(tilesetUrl){var _this$props,loader,loadOptions,options,preloadOptions,tilesetJson,tileset3d;
return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:_this$props=this.props;loader=_this$props.loader;loadOptions=_this$props.loadOptions;options=_objectSpread({},loadOptions);if(!loader.preload){_context.next=7;break}_context.next=5;return loader.preload(tilesetUrl,loadOptions);case 5:preloadOptions=_context.sent,Object.assign(options,preloadOptions);case 7:return _context.next=9,(0,_core3.load)(tilesetUrl,loader,options);case 9:tilesetJson=_context.sent,
tileset3d=new _tiles.Tileset3D(tilesetJson,_objectSpread({onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileLoadFail:this.props.onTileError},options)),this.setState({tileset3d:tileset3d,layerMap:{}}),this._updateTileset(tileset3d),this.props.onTilesetLoad(tileset3d);case 14:case "end":return _context.stop()}},_callee,this)}));return function(_x){return _loadTileset2.apply(this,arguments)}}()},{key:"_onTileLoad",value:function(tileHeader){this.props.onTileLoad(tileHeader);
this._updateTileset(this.state.tileset3d);this.setNeedsUpdate()}},{key:"_onTileUnload",value:function(tileHeader){delete this.state.layerMap[tileHeader.id];this.props.onTileUnload(tileHeader)}},{key:"_updateTileset",value:function(tileset3d){var _this$context=this.context,viewport=_this$context.viewport;_this$context.timeline&&viewport&&tileset3d&&(tileset3d=tileset3d.update(viewport),this.state.frameNumber!==tileset3d&&this.setState({frameNumber:tileset3d}))}},{key:"_create3DTileLayer",value:function(tileHeader){if(!tileHeader.content)return null;
switch(tileHeader.type){case _tiles.TILE_TYPE.POINTCLOUD:return this._createPointCloudTileLayer(tileHeader);case _tiles.TILE_TYPE.SCENEGRAPH:return this._create3DModelTileLayer(tileHeader);case _tiles.TILE_TYPE.MESH:return this._createSimpleMeshLayer(tileHeader);default:throw Error("Tile3DLayer: Failed to render layer of type ".concat(tileHeader.content.type));}}},{key:"_createPointCloudTileLayer",value:function(tileHeader){var _tileHeader$content=tileHeader.content,attributes=_tileHeader$content.attributes,
pointCount=_tileHeader$content.pointCount,constantRGBA=_tileHeader$content.constantRGBA,cartographicOrigin=_tileHeader$content.cartographicOrigin;_tileHeader$content=_tileHeader$content.modelMatrix;var positions=attributes.positions,normals=attributes.normals;attributes=attributes.colors;if(!positions)return null;var _this$props2=this.props,pointSize=_this$props2.pointSize;_this$props2=_this$props2.getPointColor;return new (this.getSubLayerClass("pointcloud",_layers.PointCloudLayer))({pointSize:pointSize},
this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(tileHeader.id),data:{header:{vertexCount:pointCount},attributes:{POSITION:positions,NORMAL:normals,COLOR_0:attributes}},coordinateSystem:_core2.COORDINATE_SYSTEM.METER_OFFSETS,coordinateOrigin:cartographicOrigin,modelMatrix:_tileHeader$content,getColor:constantRGBA||_this$props2})}},{key:"_create3DModelTileLayer",value:function(tileHeader){var _tileHeader$content2=tileHeader.content,gltf=_tileHeader$content2.gltf,
instances=_tileHeader$content2.instances,cartographicOrigin=_tileHeader$content2.cartographicOrigin;_tileHeader$content2=_tileHeader$content2.modelMatrix;return new (this.getSubLayerClass("scenegraph",_meshLayers.ScenegraphLayer))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(tileHeader.id),data:instances||[{}],scenegraph:gltf,coordinateSystem:_core2.COORDINATE_SYSTEM.METER_OFFSETS,coordinateOrigin:cartographicOrigin,modelMatrix:_tileHeader$content2,
getTransformMatrix:function(instance){return instance.modelMatrix},getPosition:function(instance){return[0,0,0]}})}},{key:"_createSimpleMeshLayer",value:function(tileHeader){var content=tileHeader.content,attributes=content.attributes,modelMatrix=content.modelMatrix,cartographicOrigin=content.cartographicOrigin;content=content.texture;for(var normals=attributes.normals,texCoords=attributes.texCoords,positions=new Float32Array(attributes.positions.value.length),i=0;i<positions.length;i+=3)scratchOffset.copy(attributes.positions.value.subarray(i,
i+3)),positions.set(scratchOffset,i);attributes=new _core.Geometry({drawMode:4,attributes:{positions:positions,normals:normals,texCoords:texCoords}});return new (this.getSubLayerClass("mesh",_meshLayers.SimpleMeshLayer))(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(tileHeader.id),mesh:attributes,data:[{}],getPosition:[0,0,0],getColor:[255,255,255],texture:content,modelMatrix:modelMatrix,coordinateOrigin:cartographicOrigin,coordinateSystem:_core2.COORDINATE_SYSTEM.METER_OFFSETS})}},
{key:"renderLayers",value:function(){var _this=this,_this$state=this.state,tileset3d=_this$state.tileset3d,layerMap=_this$state.layerMap;return tileset3d?tileset3d.tiles.map(function(tile){var layer=layerMap[tile.id]&&layerMap[tile.id].layer;if(tile.selected)return layer||(layer=_this._create3DTileLayer(tile),layerMap[tile.id]={layer:layer,tile:tile}),layer&&layer.props&&!layer.props.visible&&(layer=layer.clone({visible:!0}),layerMap[tile.id].layer=layer),layer;layer&&layer.props&&layer.props.visible&&
(layer=layer.clone({visible:!1}),layerMap[tile.id].layer=layer);return layer}).filter(Boolean):null}}]);return Tile3DLayer}(_core2.CompositeLayer);exports["default"]=global;global.layerName="Tile3DLayer";global.defaultProps=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_3d_layer$tile_3d_layer.js.map
